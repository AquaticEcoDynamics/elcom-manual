[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "ELCOM Manual",
    "section": "",
    "text": "Welcome\nThis is a draft of the ELCOM manual. It is being written using Quarto and will be published as a Quarto book.\nThe ELCOM manual is a work in progress. It is being written by the ELCOM development team and is intended to be a comprehensive guide to using ELCOM for hydrodynamic and thermodynamic modeling of stratified water bodies. The manual will cover the following topics:\n\nIntroduction to ELCOM\nSetting up an ELCOM simulation\nRunning an ELCOM simulation\nPost-processing ELCOM simulation results",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "01-intro.html",
    "href": "01-intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "1.1 The ELCOM model\nELCOM (Estuary and Lake Computer Model) is a numerical modeling tool that applies hydrodynamic and thermodynamic models to simulate the temporal behavior of stratified water bodies with environmental forcing.\nThe hydrodynamic simulation method solves the unsteady, viscous Navier-Stokes equations for incompressible flow using the hydrostatic assumption for pressure. Modeled and simulated processes include baroclinic and barotropic responses, rotational effects, tidal forcing, wind stresses, surface thermal forcing, inflows, outflows, and transport of salt, heat and passive scalars.\nThrough coupling with the CAEDYM (Computational Aquatic Ecosystem DYnamics Model) water quality module, ELCOM can be used to simulate three-dimensional transport and interactions of flow physics, biology and chemistry.\nThe hydrodynamic algorithms in ELCOM are based on the Euler-Lagrange method for advection of momentum with a conjugate-gradient solution for the free-surface height (Casulli and Cheng, 1992). Passive and active scalars (i.e., tracers, salinity and temperature) are advected using a conservative ULTIMATE QUICKEST discretization (Leonard 1991).",
    "crumbs": [
      "Overview",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "01-intro.html#implementation-language",
    "href": "01-intro.html#implementation-language",
    "title": "1  Introduction",
    "section": "1.2 Implementation language",
    "text": "1.2 Implementation language\nELCOM is implemented in Fortran 90 (with F95 extensions) so that three-dimensional space can be mapped into a single vector for fast operation using array-processing techniques.\nOnly the computational cells that contain water are represented in the single vector so that memory usage is minimized. This allows Fortran 90 compiler parallelization and vectorization without platform-specific modification of the code. A future extension of ELCOM will include dynamic pressure effects to account for nonlinear dynamics of internal waves that may be lost due to the hydrostatic approximation.",
    "crumbs": [
      "Overview",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "01-intro.html#outline-of-a-simulation-run",
    "href": "01-intro.html#outline-of-a-simulation-run",
    "title": "1  Introduction",
    "section": "1.3 Outline of a simulation run",
    "text": "1.3 Outline of a simulation run\nSetting up and running an ELCOM simulation requires the following steps:\n\nPrepare bathymetry.dat file that provides topography and grid information (see Section 11.2),\nPrepare bc.dat file that designates sets of cells for applying boundary conditions (see Section 11.3),\nPrepare levee.dat file that designates sets of cells for levee boundary conditions (see Section 11.11),\nPrepare update.dat file that designates sets of cells for update boundary conditions (see Section 11.12),\nRun the pre-processor to produce sparsedata.unf and usedata.unf files,\nConfigure the simulation run_elcom file (see Section 12.7),\nSpecify output in a datablock file (*.db) for designating data output operations (see Section 12.9.3),\nPrepare temporal boundary condition files (*.dat) for data applied to the boundary condition cells (see Section 12.8.2),\nPrepare initial conditions files (see Section 12.4),\nRun the executable, directing the screen output to a file (see Section 12.10),\nPost-process data (see Section 12.10.1).",
    "crumbs": [
      "Overview",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "01-intro.html#conventions-and-definitions",
    "href": "01-intro.html#conventions-and-definitions",
    "title": "1  Introduction",
    "section": "1.4 Conventions and definitions",
    "text": "1.4 Conventions and definitions\nIn this document, a number of conventions will be used. For clarity, the computational domain will generally be referred to as a “lake”. However, the simulation method is designed for applicability to estuaries and coastal ocean environments.\n\n\n\n\n\n\n\nTerm\nDefinition\n\n\n\n\nx,y,z space\nFull Cartesian space which covers all of the bathymetry\n\n\ni,j,k space\nDiscrete integer space of computational cells which covers all bathymetry\n\n\nland\nA computational cell that cannot contain water\n\n\nopen\nA cell used for an open boundary condition\n\n\ninterior\nA cell that may contain water\n\n\nx_rows\nNumber of grid cells in the x direction\n\n\ny_columns\nNumber of grid cells in the y direction\n\n\nz_layers\nNumber of grid cells in the vertical (z) direction\n\n\nland_value\nNumber used in the bathymetry file to represent land cells\n\n\nopen_value\nNumber used in the bathymetry file to represent open boundary cells\n\n\ndx, dy, dz\nGrid spacing in x, y, z directions (can be uniform or non-uniform, in meters)",
    "crumbs": [
      "Overview",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "sci-intro.html",
    "href": "sci-intro.html",
    "title": "2  Introduction",
    "section": "",
    "text": "2.1 Overview\nELCOM (Estuary, Lake and Coastal Ocean Model) is a three-dimensional hydrodynamics model for lakes and reservoirs, and is used to predict the variation of water temperature and salinity in space and time. The model forms the three-dimensional hydrodynamics driver to the CAEDYM water quality model.\nHeat exchange through the water’s surface is governed by standard bulk transfer models found in the literature (e.g., (Amorocho and Devries 1980; Imberger and Patterson 1981; Jacquet 1983)). The energy transfer across the free surface is separated into nonpenetrative components of long-wave radiation, sensible heat transfer, and evaporative heat loss, complemented by penetrative shortwave radiation. Nonpenetrative effects are introduced as sources of temperature in the surface-mixed layer, whereas penetrative effects are introduced as source terms in one or more grid layers on the basis of an exponential decay and an extinction coefficient (Beer’s law).\nELCOM computes a model time step in a staged approach consisting of\nThe fundamental numerical scheme is adapted from the TRIM approach of (Casulli and Cheng 1992) with modifications for accuracy, scalar conservation, numerical diffusion, and implementation of a mixed-layer turbulence closure. The solution grid uses varying width orthoganal cells. The grid stencil is the Arakawa C-grid: Velocities are defined on cell faces with the free-surface height and scalar concentrations on cell centers. The free-surface height in each column of grid cells moves vertically through grid layers as required by the free-surface evolution equation. Replacement of the standard vertical turbulent diffusion equation with a mixed-layer model eliminates the tridiagonal matrix inversion for each horizontal velocity component and transported scalar required for each grid water column in the original TRIM scheme. This provides computational efficiency and allows sharper gradients to be maintained with coarse grid resolution.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "sci-intro.html#overview",
    "href": "sci-intro.html#overview",
    "title": "2  Introduction",
    "section": "",
    "text": "introduction of surface heating/ cooling in the surface layer\nmixing of scalar concentrations and momentum using a mixed-layer model\nintroduction of wind energy as a momentum source in the wind-mixed layer\nsolution of the free-surface evolution and velocity field\nhorizontal diffusion of momentum\nadvection of scalars, and\nhorizontal diffusion of scalars",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "sci-goveqns.html",
    "href": "sci-goveqns.html",
    "title": "3  Governing Hydrodynamic Equations and Models",
    "section": "",
    "text": "The governing equations and fundamental models used for three-dimensional transport and surface thermodynamics in ELCOM are summarized below. The transport equations are the unsteady Reynolds-averaged Navier-Stokes (RANS) and scalar transport equations using the Boussinesq approximation and neglecting the non-hydrostatic pressure terms. The free surface evolution is governed by an evolution equation developed by a vertical integration of the continuity equation applied to the Reynolds-averaged kinematic boundary condition.\nThe equations in the table are:\nTransport of Momentum: \\[\n\\frac{\\partial U_\\alpha}{\\partial t}+U_j\\frac{\\partial U_\\alpha}{\\partial x_j}=-g\\left\\{ \\frac{\\partial \\eta}{\\partial x_\\alpha} + \\frac{1}{\\rho_0}\\frac{\\partial}{\\partial x_a} \\int_z^\\eta \\rho^\\prime dz \\right\\}+\\frac{\\partial}{\\partial x_1} \\left\\{ \\nu_1\\frac{\\partial U_\\alpha}{\\partial x_1}\\right\\}+\\frac{\\partial}{\\partial x_2} \\left\\{ \\nu_2\\frac{\\partial U_\\alpha}{\\partial x_2}\\right\\}+\\frac{\\partial}{\\partial x_3} \\left\\{ \\nu_3\\frac{\\partial U_\\alpha}{\\partial x_3}\\right\\}-\\epsilon_{\\alpha\\beta}fU_\\beta\n\\tag{3.1}\\]\nContinuity: \\[\n\\frac{\\partial U_j}{\\partial x_j}=0\n\\tag{3.2}\\]\nMomentum Boundary Conditions - Free Surface: \\[\n\\frac{\\partial U_\\alpha}{\\partial x_3}=0\n\\tag{3.3}\\]\nMomentum Boundary Conditions - Bottom and Sides: \\[\nU_i=0\n\\tag{3.4}\\]\nTransport of Scalars: \\[\n\\frac{\\partial C}{\\partial t}+\\frac{\\partial }{\\partial x_j}(CU_j)=\\frac{\\partial}{\\partial x_1} \\left\\{ \\kappa_1\\frac{\\partial C}{\\partial x_1}\\right\\}+\\frac{\\partial}{\\partial x_2} \\left\\{ \\kappa_2\\frac{\\partial C}{\\partial x_2}\\right\\}+\\frac{\\partial}{\\partial x_3} \\left\\{ \\kappa_3\\frac{\\partial C}{\\partial x_3}\\right\\}+S_c\n\\tag{3.5}\\]\nScalar Boundary Conditions: \\[\n\\frac{\\partial C_\\alpha}{\\partial x_j}=0\n\\tag{3.6}\\]\nFree-Surface Evolution: \\[\n\\frac{\\partial \\eta}{\\partial t}=-\\frac{\\partial }{\\partial x_\\alpha}\\int_0^\\eta u_\\alpha dz\n\\tag{3.7}\\]\nFree-Surface wind shear: \\[\n\\left ( u_* \\right )^2_\\alpha=C_{10}\\frac{\\rho_{air}}{\\rho_{water}} \\left( W_\\beta W_\\beta\\right)^{1/2}W_\\alpha\n\\tag{3.8}\\]\nMomentum input by wind: \\[\n\\frac{\\partial U_\\alpha}{\\partial t}=\\frac{(U_*)^2_\\alpha}{h}\n\\tag{3.9}\\]\n: Summary of Governing Hydrodynamic equations used in ELCOM. {#tbl-goveqns}\nThe unsteady RANS equations are developed by filtering the unsteady Navier-Stokes equations over a time period that is long relative to sub-grid scale processes, but small relative to the unsteady grid-scale processes that are of interest. In an unsteady RANS numerical method the time scale of the averaging is the time step used in advancement of the evolution equations. Thus, the maximum time step for a given grid resolution is fundamentally limited by the grid scale physics, regardless of the numerical method. This is an important point that is lost when “unconditionally stable” numerical methods are discussed: the stability of the method at a large time step is irrelevant if the size of the time step implies a temporal averaging scale that encompasses grid-scale motions.\nIn most numerical approaches, the sub-time scale nonlinear terms \\(\\overline{u_i^\\prime u_j^\\prime}\\) are represented by an eddy viscosity \\(\\nu_{jk}\\) defined in a tensor form as:\n\\[\n\\nu_{jk}\\frac{\\partial u_i}{\\partial x_k}=\\delta_{jk}\\nu\\frac{\\partial u_i}{\\partial x_k}-\\overline{u_i^\\prime u_j^\\prime}\n\\]\nwhere \\(\\delta\\) is the molecular viscosity, \\(u_i^\\prime\\) are the sub-time-scale velocity fluctuations, and the overbar indicates the Reynolds-averaging filter. The off-diagonal eddy-viscosity terms are generally set to zero and the molecular viscosity is ignored so that we obtain:\n\\[\n\\nu_1\\frac{\\partial u_i}{\\partial x_1}=\\overline{u_i^\\prime u_1^\\prime};\\quad \\nu_2\\frac{\\partial u_i}{\\partial x_2}=\\overline{u_i^\\prime u_2^\\prime};\\quad \\nu_3\\frac{\\partial u_i}{\\partial x_3}=\\overline{u_i^\\prime u_3^\\prime}\n\\]\nIn ELCOM, eddy-viscosity is used to represent the horizontal turbulence closure. In the vertical direction, ELCOM can apply either a vertical eddy viscosity or a mixed-layer model discussed in Chapter 7.\nThe free-surface evolution is governed by vertical integration of the continuity equation for incompressible flow from the bottom (b) of the water column to the free surface (h) applied to the kinematic boundary condition (e.g. Kowalik and Murty 1993). To derive the Reynolds-averaged free-surface evolution the Reynolds-averaging filter must be applied to the kinematic boundary condition, resulting in\n\\[\n\\frac{\\partial \\eta}{\\partial t}=U_3-U_\\alpha \\frac{\\partial \\eta}{\\partial x_\\alpha}-\\frac{\\partial}{\\partial x_\\alpha}(\\overline{u_\\alpha^\\prime h^\\prime})\n\\]\nNote that the sub-time scale correlation term \\((\\overline{u_\\alpha^\\prime h^\\prime})\\) has not been discussed in the literature as the Reynolds-averaging filter has not been rigorously applied to boundary conditions; the equivalent term in large-eddy simulation is discussed in (Hodges and Street 1999). The modeling of this term remains an unexplored area of free-surface flows; thus we are forced to assume that it is either small or only of local importance. In the former case it is readily neglected. In the latter case, the present use of implicit discretization of the free-surface solution is numerically diffusive at high barotropic CFL conditions, so local barotropic effects are not well-resolved. Thus, neglecting the subtime-scale nonlinear effects is justified by our focus on basin-scale baroclinic motions. However, we can speculate that the nonlinear correlation \\((\\overline{u_\\alpha h_\\alpha})\\) might be both large and non-local where nonlinear sub-basin-scale surface waves enter shallow or restricted waters. The neglect of this term is predicated on the assumption that sub-time scale nonlinear effects do not significantly effect the local mean free-surface height. In general, this is a good assumption for the resolution typically achieved in simulations of lakes and estuaries, and will be used herein. The free surface boundary condition is an approximate form of the dynamic boundary condition that neglects: dynamic pressure, local horizontal variation of the wind, updrafts, downdrafts and surface tension. This is appropriate for lake simulations using the hydrostatic approximation.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Governing Hydrodynamic Equations and Models</span>"
    ]
  },
  {
    "objectID": "sci-timestep.html",
    "href": "sci-timestep.html",
    "title": "4  Timestep limitations",
    "section": "",
    "text": "Both TRIM and ELCOM are unconditionally stable for purely barotropic flows; that is, they will produce stable numerical results for any size of time step. However, for stratified flows, both methods use explicit discretization of the baroclinic terms in the momentum equation leading to a time step constraint based on the internal wave Courant-Friedrichs-Lewy condition (\\(CFL\\)) such that\n\\[\n(g^\\prime D)^{1/2}\\frac{\\Delta t}{\\Delta x}&lt;\\sqrt{2}\n\\]\nis required. The left-hand side is defined as the baroclinic \\(CFL\\) number (\\(CFL_b\\)), where \\(g^\\prime\\) is the reduced gravity due to stratification, the effective depth is \\(D\\), \\(\\sqrt{g^\\prime D}\\) is an approximation of the wave speed of an internal wave. This baroclinic stability condition is generally the most restrictive condition in a density-stratified flow. The importance of the internal wave speed can be seen in a simple scaling analysis: Typical lake stratifications provide a modified gravity of \\(g^\\prime \\sim O (10^{-2})\\) m s\\(^{-2}\\) while lake depths \\(D\\) are \\(O(10)\\) m to \\(O(10^2)\\) m. Internal waves propagate at \\(C \\sim \\sqrt{g^\\prime D}\\), giving wave speeds of \\(O(1)\\) m s\\(^{-1}\\). Maximum horizontal water velocities in a lake are typically \\(O(10^{-1})\\) m s\\(^{-1}\\), and the desired horizontal grid size is \\(O (10^{2})\\) m.\nThe maximum allowable time step for a limiting \\(CFL\\) condition is:\n\\[\n\\Delta t &lt; \\frac{CFL\\Delta x}{U}\n\\]\nIf \\(U\\) is taken as the horizontal water velocity, the maximum allowable time step for a limiting \\(CFL\\) of one is \\(O(10^{3})\\) s. If \\(U\\) is taken as the internal wave speed, the maximum allowable time step for a limiting \\(CFL\\) of one is \\(O (10^{2})\\) s. Thus, in the horizontal direction, the internal wave speed rather than the flow velocity controls the maximum allowable time step and high \\(CFL\\) capability in the horizontal direction is generally unnecessary. However, in the vertical direction, there is a definite advantage to a numerical scheme that is stable for \\(CFL &gt; 1\\). Practical vertical grid resolutions are typically \\(O(10^{-1})\\) m to \\(O(10)\\) m depending on the lake morphology and available computational power. Internal wave motions can produce vertical velocities of \\(O(10^{-2})\\) m s\\(^{-1}\\), so fine grid resolutions with a \\(CFL\\) limit of one can result in an unacceptable time step limitations of \\(O(10)\\) s.\nScalar transport in ELCOM uses an explicit approach has an advective Courant-Friedrichs-Lewy condition (\\(CFL_{a}\\)) such that \\(u \\frac{\\Delta t}{\\delta x} &lt; 1\\) is required. This condition does not effect the time step of the momentum solution (\\(\\Delta t\\)), but instead is used to compute sub-time step (\\(\\Delta t\\)) for the scalar transport solution. The implicit scheme of (Gross et al. 1998) does not have \\(CFL\\) limitation for vertical velocity and is therefore preferable where fine grid resolution is used in the vertical direction and high vertical \\(CFL\\) values are expected. At coarse vertical grid resolutions (low vertical \\(CFL\\) values) the present explicit approach should prove more computationally efficient.\nA final stability constraint for semi-implicit schemes with explicit horizontal diffusion (e.g. TRIM and ELCOM) is the viscous stability condition (derived for homogenous flows in (Casulli and Cheng 1992))\n\\[\n\\Delta t \\leq \\frac{\\Delta x^2 \\Delta y^2}{2\\nu (\\Delta x^2 + \\Delta y^2)}\n\\]\nThis is typically at least an order of magnitude less restrictive than the baroclinic stability condition.\nA constraint that becomes important when using large time step in a geophysical model is whether the velocity field can be considered Lipschitz at the grid and time scales applied: i.e. is the field sufficiently smooth for a numerical approximation (Iserles 1996). In (Smolarkiewicz and Pudykiewicz 1992) the numerical Lipschitz constant \\(B\\) is defined with the condition that it must be less than unity:\n\\[\nB=\\left | \\left | \\frac{\\partial \\nu}{dx} \\right | \\right |\\Delta t &lt; 1\n\\]\nThis was demonstrated to be a necessary condition in a multi-time-level semi-Lagrangian method to prevent trajectories from intersecting as they are traced back in time and space. While the present Euler-Lagrange method tracks trajectories back only in space, the above Lipschitz condition heuristically applies as a fundamental statement of the necessary behavior of the velocity field to allow reasonable approximation by a numerical model. As demonstrated in (Smolarkiewicz and Pudykiewicz 1992), a numerical method may remain stable at a high B, but the results will not be accurate. This places a fundamental limit on the allowable time step that may be reasonably used in a model. The importance of this point is that the maximum time step that can be used may be a function of the physics, rather than the stability of the numerical method.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Timestep limitations</span>"
    ]
  },
  {
    "objectID": "sci-method.html",
    "href": "sci-method.html",
    "title": "5  Numerical Method",
    "section": "",
    "text": "5.1 Introduction\nThe governing equations are discretized on a Cartesian solution grid in a staggered formulation where single velocity components are defined on each face and scalars are defined at the cell centers. In discrete equations, the cell faces are represented by subscripts such as \\(i+1/2\\), while the centers are represented with integer \\((i,j,k)\\) values. The notation of Casulli and Cheng (1992) is used in the following description. For the discrete form of equations, we will use subscripts to represent the position in discrete \\((i,j,k)\\) space. Let \\(U_{i,j}^{n+1}\\) represent the water column vector of time \\(n+1\\) velocity values at position \\((i,j)\\), that exist in the time \\(n*\\) solution space for all \\(k\\) that satisfy\n\\[\nb_{i,j}\\leq\\left|\\sum_{m=1}^{k_{max}}\\Delta z_{i,j,m}^n\\right| \\leq \\eta_{i,j}\n\\tag{5.1}\\]\nwhere \\(b_{i,j}\\) is the height of the bottom of the domain at point \\((i,j)\\), \\(\\eta_{i,j}\\) is the height of the free surface, and \\(k_{max}\\) is the maximum number of grid cells in the vertical direction. Similar definitions are applied for other vector quantities in this manual.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#semi-implicit-formulation-for-momentum",
    "href": "sci-method.html#semi-implicit-formulation-for-momentum",
    "title": "5  Numerical Method",
    "section": "5.2 Semi-implicit Formulation for Momentum",
    "text": "5.2 Semi-implicit Formulation for Momentum\nThe fundamental semi-implicit evolution of the velocity field can be discretized on the \\(\\eta*\\) solution space in a manner similar to the TRIM approach as:\n\\[\nU_{i+1/2,j}^{n+1}=A_{i+1/2,j}^{n}G_{i+1/2,j}^{n}-g\\frac{\\delta t}{\\delta x} \\left [\\theta_1 \\left (\\eta_{i+1,j}^{n+1}-\\eta_{i,j}^{n+1} \\right ) + (1-\\theta_1) \\left (\\eta_{i,j}^{n+1}-\\eta_{i+1,j}^{n+1} \\right ) \\right ]\n\\tag{5.2}\\]\n\\[\nV_{i,j+1/2}^{n+1}=A_{i,j+1/2}^{n}G_{i,j+1/2}^{n}-g\\frac{\\delta t}{\\delta y} \\left [\\theta_1 \\left (\\eta_{i,j+1}^{n+1}-\\eta_{i,j}^{n+1} \\right ) + (1-\\theta_1) \\left (\\eta_{i,j}^{n+1}-\\eta_{i,j+1}^{n+1} \\right ) \\right ]\n\\tag{5.3}\\]\nwhere \\(G\\) is an explicit source term vector, \\(\\theta_{1}\\) is the “implicitness” of the free surface (the generalized implicitness option for \\(0.5 &lt; \\theta_{1} &lt; 1.0\\) is not coded in ELCOM version 2). The default semi-implicit scheme in ELCOM is a backwards-Euler discretization (i.e. \\(\\theta_{1} =1\\)) of the free surface evolution that is formally 1st order accurate in time.\nIt has been demonstrated (Casulli and Cattani 1994) that the backwards Euler method for solution of the hydrostatic momentum equations can be extended to the general two-level scheme of Equation 5.2 and Equation 5.3 that is formally second-order accurate (when \\(\\theta_1=1\\)). However, in coarse grid modeling, this increase in numerical accuracy does not always result in an increase in model skill. In general, many lake and estuary simulations are conducted where the barotropic mode will be solved with CFL conditions that may range from 5 to 10 or greater. Under these conditions, semi-implicit discretizations may be stable, but the “fidelity” of the representation of the flow physics is a function of the type of flow under consideration. The character of the truncation error is critical to understanding the performance of the method. With the 1st order method, the lead error term is 2nd order and results in damping of waves on the free surface. With the 2nd order method, the leading error term is dispersive and results in numerical waves on the free surface which propagate across the domain; typically causing a linear barotropic wave to evolve into a steep-fronted bore, causing high velocities in localized areas as the surface wave is affected by topography. Thus, the first order method results in good representation of the shape of the free surface and the local barotropic velocities, but shows excessive damping of the inertial response of the free surface. In contrast, the second order method maintains the energy in the surface wave form with minimal numerical dissipation, but has a poor representation of the wave form. In a hydrostatic solution, the dispersive waves cause spurious local forcing throughout the water column and are detrimental to the skill of the solution. In contrast, the excessive damping of the surface wave causes a decrease in the large scale motions associated with the barotropic response when the wind relaxes, i.e. the “ringing” of the barotropic mode is damped. In general, a strongly forced system is better modeled with the backwards Euler scheme as the wave energy beyond two or three periods is often irrelevant to the first-order physics.\nUsing any two-level implicit discretization (Casulli and Cheng 1992), or any explicit discretization technique, the A matrix can be represented as:\n\\[\nA=\\begin{bmatrix}\nb_n+\\gamma_k & c_n & 0 & 0 & 0\\\\\na_{n-1} & b_{n-1} & c_{n-1} & 0 & 0 \\\\\n0 & a_{n-2} & b_{n-2} & c_{n-2} & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\vdots & \\vdots  \\\\\n0 & 0 & a_{2} & b_{2} & c_{2}  \\\\\n0 & 0 & 0 &a_{1} & b_{1}+\\gamma_1\n\\end{bmatrix}\n\\tag{5.4}\\]\nThe \\(\\gamma\\) terms in \\(A\\) are set by boundary conditions, while the \\(a\\), \\(b\\) and \\(c\\) terms are:\n\\[\nb_k=-a_k+\\Delta z_k - c_k\n\\tag{5.5}\\]\n\\[\na_k=-\\theta_2\\left.\\frac{\\nu_3\\Delta t}{\\Delta z}  \\right |_{k+1/2}\n\\tag{5.6}\\]\n\\[\nc_k=-\\theta_2\\left.\\frac{\\nu_3\\Delta t}{\\Delta z}  \\right |_{k-1/2}\n\\tag{5.7}\\]\nThe \\(\\theta_2\\) coefficient is determined by the choice of numerical discretization techniques. For \\(\\theta_2=1\\) the vertical viscous term is discretized using a backwards Euler technique. For the mixed-layer model used in ELCOM \\(\\theta_2=0\\) and the discretization is explicit with \\(A\\) zero for all terms off the main diagonal.\nThe source terms \\(G\\) in Equation 5.2 and Equation 5.3 can be represented as:\n\\[\nG_{i+1/2,j}=L(\\tilde U_{i+1/2,j})-\\Delta t \\left \\{ B_{i+1/2,j}^n + D_x(\\tilde U)_{i+1/2,j} + D_y(\\tilde U)_{i+1/2,j} - f\\tilde V_{i+1/2,j} \\right \\}\n\\tag{5.8}\\]\n\\[\nG_{i,j+1/2}=L(\\tilde V_{i,j+1/2})-\\Delta t \\left \\{ B_{i,j+1/2}^n + D_x(\\tilde V)_{i,j+1/2} + D_y(\\tilde V)_{i,j+1/2} - f\\tilde U_{i,j+1/2} \\right \\}\n\\tag{5.9}\\]\nThe \\(L()\\) operator represents advective discretization, \\(B()\\) represents baroclinic discretization, \\(D()\\) represents horizontal turbulent diffusion discretization. In ELCOM vertical diffusion is computed using a vertical mixing model. The mixing model is represented as an operator such that:\n\\[\n\\tilde U_{i,j,k} = M(U_{i,j,k}^n)\n\\tag{5.10}\\]\nThe mixing operator \\(M()\\) is described in detail in Chapter 7.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#horizontal-diffusion-discretization",
    "href": "sci-method.html#horizontal-diffusion-discretization",
    "title": "5  Numerical Method",
    "section": "5.3 Horizontal Diffusion Discretization",
    "text": "5.3 Horizontal Diffusion Discretization\nWhile the original TRIM approach (Casulli and Cheng 1992) applied the discretization of the horizontal diffusive terms at the pathline origin, the additional complexity was not found to provide any significant advantage in the accuracy of the present method. Therefore, the horizontal diffusion terms (\\(D_{x}\\), \\(D_{y}\\)) from Equation 5.8 and Equation 5.9 are discretized using a second-order stencil such that\n\\[\nD_x(\\phi_{i,j,k}^n)=\\frac{\\nu}{\\Delta x^2}(\\phi_{i+1,j,k}^n-2\\phi_{i,j,k}^n+\\phi_{i-1,j,k}^n)\n\\tag{5.11}\\]",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#baroclinic-discretization",
    "href": "sci-method.html#baroclinic-discretization",
    "title": "5  Numerical Method",
    "section": "5.4 Baroclinic Discretization",
    "text": "5.4 Baroclinic Discretization\nThe baroclinic term B in the x direction is discretized as:\n\\[\nB_{i+1/2,j,k}^n=\\frac{g}{\\rho_0 \\Delta x}\\left \\{\\sum_{m=k}^F\\rho_{i+1,j,m}^\\prime - \\sum_{m=k}^F\\rho_{i,j,m}^\\prime \\right \\}\n\\tag{5.12}\\]\nwhere \\(k = F\\) is the cell containing the free surface. Similar expressions for diffusion and baroclinic terms are obtained for the \\(y\\) direction. The elimination of the vertical diffusion terms in the transport of momentum and scalars equations allows the present scheme to dispense with the tridiagonal matrix inversion for each horizontal velocity component and transported scalar required for each \\((i,j)\\) water column in the TRIM scheme.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#free-surface-discretization",
    "href": "sci-method.html#free-surface-discretization",
    "title": "5  Numerical Method",
    "section": "5.5 Free Surface Discretization",
    "text": "5.5 Free Surface Discretization\nThe free surface evolution equation can be discretized as:\n\\[\n\\eta_{i,j}^{n+1}=\n\\begin{array}{l}\n\\eta_{i,j}^n-\\theta_1 \\left [ \\frac{\\Delta t}{\\Delta x}\\delta_x \\{(\\Delta Z^n)^T U^{n+1}\\}- \\frac{\\Delta t}{\\Delta y}\\delta_y \\{(\\Delta Z^n)^T V^{n+1}\\}\n\\right ] \\\\\n-(1-\\theta_1) \\left [ \\frac{\\Delta t}{\\Delta x}\\delta_x \\{(\\Delta Z^n)^T U^{n}\\}- \\frac{\\Delta t}{\\Delta y}\\delta_y \\{(\\Delta Z^n)^T V^{n}\\}\\right ]\n\\end{array}\n\\tag{5.13}\\]\nwhere \\(\\Delta Z\\) is a vector of the vertical grid spacing, and the operators \\(\\delta_x\\) and \\(\\delta_y\\) indicate discrete differences, e.g.\n\\[\n\\delta_x(\\phi)=\\phi_{i+1/2}-\\phi_{i-1/2}\n\\tag{5.14}\\]\nSubstitution of Equation 5.2 and Equation 5.3 into Equation 5.13 provides a pentadiagonal system of equations for the time \\(n+1\\) free surface height that is readily solved using a conjugate gradient method. The approach adopted for conjugate gradient solution in ELCOM is similar to TRIM, as detailed in Casulli and Cheng (1992).",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#advective-discretization",
    "href": "sci-method.html#advective-discretization",
    "title": "5  Numerical Method",
    "section": "5.6 Advective Discretization",
    "text": "5.6 Advective Discretization\nOne of the difficulties of numerical modelling at geophysical scales is the wide range of flow conditions that may be present. In particular, internal waves may intermittently produce strong vertical motions over relatively small regions. Where resolution of internal waves is deemed important, the choice of numerical method is driven by the need for accuracy and stability in a small portion of the overall flow field. While many explicit spatial discretization methods are stable for \\(CFL &lt; O(1)\\), their accuracy in 3D computations for \\(CFL &gt; O(0.5)\\) is generally poor when the flow direction is not aligned with the grid.\nThe drawback of the quadratic method is that it is computationally expensive. However, for low \\(CFL\\) regions (\\(CFL &lt; 0.1\\)), the solution of a quadratic semi-Lagrangian method is dominated by terms in the same seven-point upwind stencil that is obtained by using quadratic upwind discretization. This similarity can be exploited to reduce the computational requirement in regions of low \\(CFL\\) without significantly reducing the accuracy of the overall solution method. The concept of applying different schemes in different regions can be generalized into the concept of a “hybrid” numerical method. A general hybrid method is one where different solution schemes are applied in different flow regions based upon a criteria measured in the flow field. For our purposes, the criteria is the \\(CFL\\), and we apply one discretization technique for low \\(CFL\\), and a different technique for high \\(CFL\\).\nThe present hybrid method has been tested to two levels, using quadratic semi-Lagrangian discretization for regions where (\\(0 &lt; CFL &lt; 2\\)). The upper limit cutoff is the maximum CFL that can be computed using a quadratic SL method without requiring the additional computational expense of adjusting the stencil region. As a practical matter, the accuracy of computations for \\(CFL &gt; 2\\) is questionable, so the upper limit is not an unreasonable requirement. For regions with \\(CFL &gt; 2\\), the method applies linear semi-Lagrangian discretization (i.e. the approach used in TRIM) to minimize the computational effort of repositioning the stencil.\n\n5.6.1 Linear semi-Lagrangian methods\nFor a stratified flow, semi-Lagrangian methods are desirable in that they are both accurate and stable in the regime where \\(0.1 &lt; CFL &lt; 1\\). As a further advantage, they retain their stability in higher CFL regimes, although their accuracy suffers at high \\(CFL\\) values unless the flow streamlines are well resolved by the grid. However, in stratified flows, the ability to provide stable solutions for \\(CFL &gt; 1\\) in the horizontal direction is of secondary importance in the selection of a numerical method. The maximum time step is generally limited by either (1) the baroclinic wave propagation speed in the region of strongest stratification, or (2) the maximum acceptable numerical diffusion in scalar transport. The former requires wave \\(CFL &lt; 1\\) for stability, while the latter limitation is a matter of grid resolution and the length of time over which model results are required.\nThe semi-Lagrangian form of advection is obtained by finding the approximate point in continuous space (the “Lagrange” point) which would be advected to a discrete point (\\(i,j,k\\)) by the velocity field (\\(U,V,W\\)) over the time step \\(\\Delta t\\). That is, the particle position (\\(i,j,k\\)) is numerically marched back along the streamlines represented by the velocity field \\(U,V,W\\). The \\(U,V,W\\) field may be obtained from single or multiple time levels, depending upon the accuracy and computational complexity desired. A detailed review of semi-Lagrangian techniques is found in Staniforth and Cote (1991). In a linear, single-time level semi-Lagrangian method, the Lagrange point is found using\n\\[\n\\delta_x=-U\\Delta t\n\\tag{5.15}\\]\n\\[\n\\delta_y=-V\\Delta t\n\\tag{5.16}\\]\n\\[\n\\delta_z=-W\\Delta t\n\\tag{5.17}\\]\nThe value of a variable \\(\\phi\\) at the Lagrange point is found using a trilinear upwind interpolation:\n\\[\n\\phi_L=\n\\begin{array}{l}\n\\frac{\\delta_x}{\\Delta_x}\\frac{\\delta_y}{\\Delta_y}\\frac{\\delta_z}{\\Delta_z}\\phi_{i-1,j-1,k-1}\n\\\\\n+\\left ( 1-\\frac{\\delta_x}{\\Delta_x}\\right )\\frac{\\delta_y}{\\Delta_y}\\frac{\\delta_z}{\\Delta_z}\\phi_{i,j-1,k-1}\n\\\\\n+\\frac{\\delta_x}{\\Delta_x}\\left ( 1-\\frac{\\delta_y}{\\Delta_y}\\right )\\frac{\\delta_z}{\\Delta_z}\\phi_{i-1,j,k-1}\n\\\\\n+\\frac{\\delta_x}{\\Delta_x}\\frac{\\delta_y}{\\Delta_y}\\left ( 1-\\frac{\\delta_z}{\\Delta_z}\\right )\\phi_{i-1,j-1,k}\n\\\\\n+\\frac{\\delta_x}{\\Delta_x}\\left ( 1-\\frac{\\delta_y}{\\Delta_y}\\right )\\left ( 1-\\frac{\\delta_z}{\\Delta_z}\\right )\\phi_{i-1,j,k}\n\\\\\n+\\left ( 1-\\frac{\\delta_x}{\\Delta_x}\\right )\\frac{\\delta_y}{\\Delta_y}\\left ( 1-\\frac{\\delta_z}{\\Delta_z}\\right )\\phi_{i,j-1,k}\n\\\\\n+\\left ( 1-\\frac{\\delta_x}{\\Delta_x}\\right )\\left ( 1-\\frac{\\delta_y}{\\Delta_y}\\right )\\frac{\\delta_z}{\\Delta_z}\\phi_{i,j,k-1}\n\\\\\n+\\left ( 1-\\frac{\\delta_x}{\\Delta_x}\\right )\\left ( 1-\\frac{\\delta_y}{\\Delta_y}\\right ) \\left ( 1-\\frac{\\delta_z}{\\Delta_z}\\right )\\phi_{i,j,k}\n\\end{array}\n\\tag{5.18}\\]\nThe above constitutes an eight-point stencil for a semi-Lagrangian method with linear interpolation. As the flow field approaches a uniform 1D flow, the linear semi-Lagrangian technique reduces to a linear upwind method for \\(CFL &lt; 1\\). Indeed, it is perhaps easier to think of the semi-Lagrangian method as a 3D linear upwind stencil that is successively repositioned for high \\(CFL\\) conditions. It follows that linear semi-Lagrange method exhibits the unacceptable levels of numerical diffusion that are characteristic of linear upwind methods. This can be ameliorated by using a quadratic method for interpolation of values at the Lagrange point.\n\n\n5.6.2 Quadratic semi-Lagrangian methods\nThe quadratic semi-Lagrange method extends the 8-point upwind stencil with trilinear interpolation (used in TRIM) to a 27-point upwind stencil using quadratic Lagrange polynomial interpolation. In the notation of Casulli and Cheng (1992), the operator interpolates the velocity field (on the x face) to the position \\((i+1/2-a,j-b,k-d)\\), where \\(a\\), \\(b\\) and \\(d\\) are real numbers that represent displacements from the \\((i+1/2,j,k)\\) position. This is an estimate of the origination of the pathline of a particle moving through the time \\(n\\) velocity field that ends at the position \\((i+1/2,j,k)\\) after time \\(\\Delta t\\). A similar notation is used for the \\(y\\) faces at \\(j+1/2\\). It is convenient to denote the pathline origination point by a superscript \\((p)\\) so that the advective operators \\(L()\\) in Equation 5.2 and Equation 5.3:\n\\[\nL(\\tilde U_{i+1/2,j,k})=\\tilde U_{i+1/2-a,j-b,k-d}=\\tilde U^{(p)}\n\\tag{5.19}\\]\nThe process of computing the pathline origin in 2D for bilinear interpolation is discussed in Casulli and Cheng (1992) and is illustrated in Figure 5.1 for 2D quadratic Lagrange interpolation. For Lagrange interpolation on non-uniform grids it is convenient to consider the physical space coordinates (\\(x\\), \\(y\\), \\(z\\)) that correspond to the (\\(i\\),\\(j\\),\\(k\\)) computational indices. Three-dimensional quadratic Lagrange interpolation to find the value of \\(U^{(p)}\\) at any point (\\(x^{(p)}\\), \\(y^{(p)}\\), \\(z^{(p)}\\)) is computed in three steps illustrated in Figure 5.2 requiring 9 vertical interpolations of the form\n\\[\n\\hat U_{i+\\gamma,j+\\zeta}=l_{i+\\gamma,j+\\zeta}^0 U_{i+\\gamma,j+\\zeta,k}+l_{i+\\gamma,j+\\zeta}^1 U_{i+\\gamma,j+\\zeta,k\\pm1}+l_{i+\\gamma,j+\\zeta}^2 U_{i+\\gamma,j+\\zeta,k\\pm2}\n\\tag{5.20}\\]\nwhere the \\((i,j)\\) subscripts denote the position of the vertical line to be interpolated, while \\(\\gamma\\) and \\(\\zeta\\) are \\(\\pm\\{0,1,2\\}\\), with the sign determined by the upwind direction of the stencil (as is the sign for the \\(k\\) increment in the \\(U\\) position subscripts). The Lagrange polynomial coefficients for each \\((i,j)\\) line are computed from the standard Lagrange coefficient formula (e.g. Al-Khafaji and Tooley 1986):\n\\[\nl^m=\\prod_{\\substack{\\zeta=0 \\\\ \\zeta \\neq m}}^2 \\frac{z^{(p)}-z_{k\\pm\\zeta}}{z_{k\\pm m}-z_{k\\pm\\zeta}}\n\\tag{5.21}\\]\nwhere \\(z^{(p)}\\) is the vertical coordinate of the interpolated point and the sign is determined to obtain an upwind stencil. The vertical interpolations are followed by 3 horizontal interpolations in the \\(y\\) direction of the form\n\\[\n\\overline U_{i+\\gamma}=l^0_{i+\\gamma,j}\\hat U_{i+\\gamma,j}+l^1_{i+\\gamma,j\\pm1}\\hat U_{i+\\gamma,j\\pm1}+l^2_{i+\\gamma,j\\pm2}\\hat U_{i+\\gamma,j\\pm2}\n\\tag{5.22}\\]\nFinally, a single interpolation in the \\(x\\) direction is applied as\n\\[\nU^{(p)}=l^0\\overline U_i+l^1\\overline U_{i\\pm1}+l^2\\overline U_{i\\pm2}\n\\tag{5.23}\\]\nThe Lagrange coefficients in Equation 5.22 and Equation 5.23 are computed using Equation 5.21 with \\(y\\) or \\(x\\) substituted for \\(z\\) as appropriate. The quadratic stencil used for the Euler-Lagrange interpolation is advantageous as it reduces artificial damping of internal waves that occurs with an 8-node linear stencil; thus improving the ability of the method to resolve the free motions of a stratified basin. While this improvement is necessary for modeling stratified lakes, it is probably of lesser importance in estuarine modeling where forced motions dominate the flow physics. The extra computational requirements of the quadratic stencil are somewhat ameliorated by the ability to compute source terms for flows in the range \\(1 &lt; CFL &lt; 2\\) without repositioning the stencil.\n\n\n\n\n\n\nFigure 5.1: Two-dimensional illustration of Euler-Lagrange streamline computation using quadratic Lagrange interpolation. Velocity vector \\(A\\), with components \\(U_{A}\\) and \\(V_{A}\\), is used to track particle path from position (\\(i,j\\)) back to the base of vector \\(B\\) using the momentum sub-time step \\(dt\\). Velocity vector \\(B\\) is computed from the nine grid nodes upwind of the velocity vector at position \\((i,j)\\). Vector \\(B\\) is used to track the particle path back to the base of velocity vector \\(C\\), which is again interpolated from the surrounding nine grid nodes. This is repeated \\(n\\) times where \\(n \\, dt = \\Delta t\\). If a vector base position is not contained within the nine upwind grid nodes, the upwind stencil must be repositioned. In the present code, linear interpolation is used for the rare instances when repositioning is necessary. The final vector is the result of the Euler-Lagrange operator in Equation 5.8, i.e. \\(L(U_{i,j}) = U_{(i-a,j-b)}\\). The number of sub-time steps (\\(n\\)) may be set arbitrarily, with high values providing greater accuracy and higher computational cost. Note that \\(n=1\\) everywhere corresponds to quadratic upwind discretization and has poor accuracy characteristics unless the \\(CFL_{a} \\ll 1\\). As a general rule, the minimum \\(n\\) is set as a local function of the grid and flow field such that \\(U\\frac{dt}{\\Delta x} &lt; 1\\).\n\n\n\n\n\n\n\n\n\nFigure 5.2: Schematic of three-dimensional quadratic Lagrange interpolation with successive interpolations in the \\(k\\), \\(j\\), then \\(i\\) directions. For clarity, this illustration shows interpolation for a uniform grid, however the method can be applied to non-uniform grids without any further adaptation.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#scalar-transport",
    "href": "sci-method.html#scalar-transport",
    "title": "5  Numerical Method",
    "section": "5.7 Scalar Transport",
    "text": "5.7 Scalar Transport\nScalar transport is (arguably) the most critical piece of the hydrodynamic numerical algorithm for strongly stratified flows. If the scalar transport is not sufficiently accurate, we cannot obtain correct evolution of the density field and internal wave motions. In ELCOM, a conservative third-order scalar transport method is applied. Use of conservative methods has been found critical to stratified lake and estuary models as the distribution of density feeds back into the momentum equation through the baroclinic term. Non-conservation results in loss of momentum in baroclinic forcing such that internal waves are dissipated too rapidly and strong gradients that drive underflows may simply cease to exist. Using non-conservative methods, loss of mass and deterioration of sharp gradients at salinity and temperature fronts degrades the skill of the model.\nA three-stage numerical algorithm for transport of a scalar concentration \\(C\\) can be defined as:\n\\[\n\\tilde C = M(C^n)+S^{(C)}\n\\tag{5.24}\\]\n\\[\nC^* = \\tilde C -\\Delta t\\frac{\\partial}{\\partial x_j}(\\tilde C U_j)\n\\tag{5.25}\\]\n\\[\nC^{n+1}=C^* -\\Delta t\\frac{\\partial}{\\partial x_\\alpha}\\left ( \\kappa \\frac{\\partial C^*}{\\partial x_\\alpha} \\right )+O(\\Delta t)^2\n\\tag{5.26}\\]\nAs with the momentum mixing and source terms, the mixing operator in Equation 5.24 represents vertical mixing by the Reynolds stress term and is discussed in detail in a subsequent section on the vertical mixing model. The \\(S^{(C)}\\) in Equation 5.24 represents scalar sources (e.g. heat transfer across the free surface into the wind-mixed layer). Equation 5.25 is advection of the scalar field by the resolved flow field, and Equation 5.26 is horizontal diffusion by turbulent motions. For clarity in the above and the following, advection, i.e. Equation 5.25, is defined over time step \\(\\Delta t\\). However, when \\(\\max(CFL_{a}) &gt; 1\\), the sub-time step \\(\\delta t\\) is used, where \\(m\\delta t = \\Delta t\\) and Equation 5.25 is iterated \\(m\\) times. In the following derivations, substitution of \\(\\delta t\\) for \\(\\Delta t\\) and \\(n+m\\Delta t\\) for \\(n+1\\) makes the equations reflect the sub-time step iteration process.\nIn differential notation, a conservative form of the transport equation is:\n\\[\n\\frac{\\partial}{\\partial t}\\int_\\Omega C \\, d\\Omega+\\int_{A_x}CU \\, dA_x+\\int_{A_y}CV \\, dA_y+\\int_{A_z}CW \\, dA_z=S^{(C)}\n\\tag{5.27}\\]\nwhere \\(\\Omega\\) is a control volume and \\(A_{x}\\), \\(A_{y}\\), \\(A_{z}\\) are surface areas of the control volume faces. For clarity in the discrete form, it will be useful to omit the \\((i,j,k)\\) subscript notation for any centered variable so that \\(C_{i,j,k}\\) is written simply as \\(C\\), and \\(C_{i,j+1/2,k}\\) is written as \\(C_{j+1/2}\\). The discrete advected scalar concentration field (\\(C^*\\)) written as a flux-conservative advection over the \\(n*\\) set of cells is:\n\\[\nC^*=\\tilde C \\frac{\\Delta Z^n}{\\Delta Z^{n+1}}-\\frac{\\Delta t}{\\Delta X\\Delta Y\\Delta Z^{n+1}}\\{\\delta_x{Q}+\\delta_y{Q}+\\delta_z{Q} \\}\n\\tag{5.28}\\]\nwhere operators of the form \\(\\delta_x\\) are defined in Equation 5.15. \\(Q\\) is the scalar flux through the cell faces, defined on the \\(n*\\) cell set for the \\(i+1/2\\) face as:\n\\[\nQ_{i+1/2}=\\left ( \\Delta y\\Delta Z^{n+1}U^{n+1/2}\\tilde C\\right )_{i+1/2}\n\\tag{5.29}\\]\nSimilar definitions apply on the \\(j+1/2\\) and \\(k+1/2\\) faces. There is no flux through the uppermost face of the cell containing the free surface, so \\(Q_{i,j,F+1/2} = 0\\), where \\(k=F\\) is the cell containing the free surface. It follows that \\(\\Delta Z^{n+1}_{i,j,F}-\\Delta Z^{n}_{i,j,F}=\\Delta tW^{n+1}_{i,j,F+1/2}\\) and \\(C_{i,j,F+1/2}=C_{i,j,F}\\). For any cell \\((i,j,F)\\) in the \\(n*\\) set:\n\\[\nC_{i,j,F+1/2}=C_{i,j,F} = \\frac{\\Delta t}{\\Delta z^{n+1}} \\delta_z(W^{n+1}_{i,j,F+1/2} C_{i,j,F+1/2})\n\\]\nThus, for all cells in the \\(n*\\) set (including free surface cells):\n\\[\nC^*=\\tilde C - \\frac{\\Delta t}{\\Delta x} \\delta_x(U^{n+1}\\tilde C)- \\frac{\\Delta t}{\\Delta y} \\delta_y(V^{n+1}\\tilde C)- \\frac{\\Delta t}{\\Delta z^{n+1}} \\delta_z(W^{n+1}\\tilde C)\n\\tag{5.30}\\]\nSince the scalar concentrations are updated at the cell centers, it is necessary to define a method of interpolation for cell face values such as \\(\\delta_x(UC)\\). The ULTIMATE flux-limiting filter applied with third-order QUICKEST interpolation (Leonard 1991) performs particularly well in maintaining monotonic scalar fields while limiting numerical diffusion. Implementation in 2D and demonstration of its effectiveness in estuarine flows has been documented by Lin and Falconer (1997). The conservative ULTIMATE QUICKEST method is limited to \\(CFL_{a} &lt; 1\\) in all coordinate directions. The present semi-implicit scheme remains stable at higher CFL (providing \\(CFL_{b}\\) does not exceed unity), so the ULTIMATE QUICKEST algorithm must be computed successively over sub-time steps such that the maximum \\(CFL_{a}\\) is less than one in each sub-time step. In practice, coarse resolution models of strongly stratified basins will have the defining time step limitation based on the baroclinic mode in the momentum solution and \\(CFL_{a} &gt; 1\\) may never occur.\nThe recent evaluation of transport schemes by Gross et al. (1998) did not directly examine the ULTIMATE limiter applied to a QUICKEST approach; however, their results did show that effective results for a 2D model of South San Francisco Bay could be obtained with either the QUICKEST approach or Roe’s superbee limiter applied to a Lax-Wendroff method. As Lax-Wendroff is a second-order discretization, it is likely that the ULTIMATE limiter applied to third-order QUICKEST would have been at least as effective as the schemes they tested. The present use of an explicit discretization approach contrasts with the vertical-implicit approach taken in the recent adaptation of TRIM by Gross et al. (1998). The advantage of the latter is that it is stable for scalar transport solutions at \\(CFL &gt; 1\\), whereas the present method requires sub-time step iterations of the scalar transport routines when high CFL’s are encountered. Thus the approach of Gross et al. (1998) is preferable for a fine vertical grid resolution while the present method should prove more computationally efficient at coarse grid resolution.\n\n5.7.1 Scalar horizontal diffusion\nThe horizontal diffusion terms in Equation 3.5 are discretized to obtain the time ‘\\(n+1\\)’ scalar field over the solution space ‘\\(n*\\)’:\n\\[\nC_{i,j,k}^{n+1}=\\tilde C_{i,j,k} + D_x(\\tilde C_{i,j,k})+ D_y(\\tilde C_{i,j,k})\n\\tag{5.31}\\]\nwhere \\(D_{x}\\) and \\(D_{y}\\) are finite-difference operators for the second derivative. As with the velocity solution, any time \\(n+1\\) locations that are not in the time \\(n*\\) solution space are updated using the concentration of neighbour cells.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#sidewall-and-bottom-boundary-conditions",
    "href": "sci-method.html#sidewall-and-bottom-boundary-conditions",
    "title": "5  Numerical Method",
    "section": "5.8 Sidewall and Bottom Boundary Conditions",
    "text": "5.8 Sidewall and Bottom Boundary Conditions\nThe momentum introduced into a lake by wind forcing is dissipated in the boundary layers of the lake and turbulent processes in the interior. In 2D depth-averaged models the Chezy-Manning bottom stress formulation has been applied to account for the dissipation in the entire water column. This is particularly useful in providing a method of calibrating depth-averaged coastal/estuarine models to reproduce a given set of tidal data. In a 3D model with stratification, detailed field data for calibrating a bottom friction coefficient is generally not available. Furthermore, without the transfer of basin-scale internal-wave energy to subgrid-scale waves, it is questionable as to whether any boundary condition model in the literature can capture actual boundary dynamics and predict the correct location and timing of dissipation and vertical fluxes. Sidewall boundary conditions (i.e. vertical solid boundaries) are often modeled as free-slip to effect simpler implementation in a numerical method (Casulli and Cheng 1992). However, the lack of sidewall drag prevents vertical vorticity from being produced at boundaries. As lakes typically have regions of steep slopes and longshore currents (due to Kelvin waves), the neglect of sidewall drag may not be a suitable simplification in modeling basin-scale motions.\nThere remains much work to be done in developing appropriate bottom and sidewall boundary conditions in coarse grid models. ELCOM provides three basic forms of boundary conditions: (1) no-slip, (2) free-slip, and (3) specified stress.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-method.html#wind-momentum-model",
    "href": "sci-method.html#wind-momentum-model",
    "title": "5  Numerical Method",
    "section": "5.9 Wind Momentum Model",
    "text": "5.9 Wind Momentum Model\nThe momentum input of the wind is typically modeled (e.g. Casulli and Cheng 1992) using a stress boundary condition at the free surface:\n\\[\n\\nu \\left.  \\frac{\\partial u}{\\partial x} \\right |_{z=\\eta}=u_*^2\n\\tag{5.32}\\]\nwhere \\(\\nu\\) is an eddy viscosity and \\(u_{*}^{2}\\) is the wind stress. This boundary condition requires solution of vertical viscosity/diffusion terms of the form\n\\[\n\\frac{\\partial}{\\partial x_3}\\left \\{ \\nu \\frac{\\partial U_\\alpha}{\\partial x_3} \\right \\}; \\quad \\frac{\\partial}{\\partial x_3}\\left \\{ \\kappa \\frac{\\partial C}{\\partial x_3} \\right \\}\n\\tag{5.33}\\]\nin place of the Reynolds stress terms in the momentum and scalar transport equations, terms that are modeled in ELCOM using the 3D mixed-layer model. As demonstrated by Glorioso and Davies (1995), the formulation chosen for eddy viscosity has a dramatic influence on the development of pressure-driven upwind flows in a wind-forced homogenous system. Using an eddy-viscosity/diffusivity approach in a stratified system, the depth, downwind velocity, and velocity shear in the wind-mixed layer are functions of the values used for eddy viscosity and diffusivity above the thermocline. The resulting prediction of mixed-layer depth using a coarse vertical grid resolution is generally unsatisfactory. Even at fine resolutions, the capability of \\(k\\)-\\(\\epsilon\\) and algebraic stress models may be suspect on the basis of the 1D results of Martin (1985). As the purpose of the eddy-viscosity term is to model the introduction of momentum into the wind-mixed layer, we can substitute a model for predicting the wind-mixed layer depth and a model for the distribution of momentum over the depth. The wind-mixed layer is the mixed layer that includes the free surface, with depth (\\(h\\)) of the wind-mixed layer computed in a discrete form as:\n\\[\nh_{i,j}=\\sum_{m=k_a(i,j,k_\\eta)}^{k_b(i,j,k_\\eta)}\\Delta Z_{i,j,m}\n\\tag{5.34}\\]\nwhere \\(k_{a}\\) and \\(k_{b}\\) are the lower and upper grid cell indices of the discrete wind-mixed layer in the water column \\((i,j)\\) that has free surface grid cell \\(k_{\\eta}\\). To first order, we can approximate the introduction of wind momentum as a uniform distribution over the mixed layer (Imberger and Patterson 1990):\n\\[\n\\left. \\frac{dU}{dt} \\right|_{i,j,k} =  \\frac{\\left.{u_*^2} \\right|_{i,j,k}}{\\left.{h} \\right|_{i,j}};\\quad \\eta-h&lt;\\sum_{m=1}^k\\Delta z_m&lt;\\eta\n\\tag{5.35}\\]\nwhere \\(\\eta\\) is the free surface height in water column \\((i,j)\\). Equation 5.35 is applied separately in the \\(x\\) and \\(y\\) directions to provide a direct increase in the velocity field in the wind-mixed layer before solution of the Navier-Stokes equations.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Numerical Method</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html",
    "href": "sci-thermo.html",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "",
    "text": "6.1 Introduction\nThe surface exchanges include heating due to short wave radiation penetration into the lake and the fluxes at the surface due to evaporation, sensible heat (i.e. convection of heat from the water surface to the atmosphere) and long wave radiation.\nShort wave radiation (280nm to 2800nm) is usually measured directly. Long wave radiation (greater than 2800nm) emitted from clouds and atmospheric water vapour can be measured directly or calculated from cloud cover, air temperature and humidity. The reflection coefficient, or albedo, of short wave radiation varies from lake to lake and depends on the angle of the sun, the lake colour and the surface wave state.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#surface-energy-fluxes",
    "href": "sci-thermo.html#surface-energy-fluxes",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.2 Surface Energy Fluxes",
    "text": "6.2 Surface Energy Fluxes\n\n6.2.1 Solar (shortwave) radiation flux\nShortwave radiation can be divided into four components. ELCOM 2.2 assumes the following percentages for each component\n\nPhotosynthetically Active Radiation (PAR) 45%\nNear Infrared (NIR) 41%\nUltra Violet A (UVA) 3.5%\nUltra Violet B (UVB) 0.5%\n\nThe distance the radiation penetrates into the water column is dependent on the extinction component for each band-width. ELCOM allows users to set the extinction coefficient for each band in the run_elcom.dat file but has the following default values\n\nPhotosynthetically Active Radiation (PAR) \\(0.25 \\; m^{-1}\\)\nNear Infrared (NIR) \\(1 \\; m^{-1}\\)\nUltra Violet A (UVA) \\(1 \\; m^{-1}\\)\nUltra Violet B (UVB) \\(2.5 \\; m^{-1}\\)\n\nIf water quality is being simulated via CAEDYM then the PAR extinction coefficient is calculated by CAEDYM.\nThe depth of penetration of short wave radiation depends on the net short wave radiation that penetrates the water surface and the extinction coefficient. The equations given in TVA (eq 2.48 and 2.37) and Jacquet (eq A5.2) for the net solar radiation penetrating the water can be written as:\n\\[\nQ_{sw}=Q_{sw(total)}(1-r_{a}^{(sw)})\n\\tag{6.1}\\]\nwhere \\(Q_{sw(total)}\\) is the short wave radiation that reaches the surface of the water, \\(Q_{sw}\\) is the net short wave radiation penetrating the water surface, and \\(r_{a}^{(sw)}\\) is the shortwave albedo of the water surface given by:\n\\[\nr_{a}^{(sw)}=\n\\begin{cases}\n\\overline{R}_a^{(sw)}+a_{(sw)}\\sin\\left ( \\frac{2\\pi d}{D}-\\frac{\\pi}{2} \\right ) & \\text{Sth Hemisphere} \\\\\n\\overline{R}_a^{(sw)} & \\text{Equator} \\\\\n\\overline{R}_a^{(sw)}+a_{(sw)}\\sin\\left ( \\frac{2\\pi d}{D}+\\frac{\\pi}{2} \\right ) & \\text{Nth Hemisphere}\n\\end{cases}\n\\tag{6.2}\\]\nand \\(\\overline{R}_a^{(sw)} = 0.08\\), \\(a_{(sw)}= 0.02\\), \\(D\\) is the standard number of days in a year (\\(=365\\)) and \\(d\\) is the day number in the year.\nShort-wave radiation in each band penetrates according to the Beer-Lambert law, such that\n\\[\nQ(z)=Q_{sw}e^{-\\eta_a z}\n\\tag{6.3}\\]\nwhere \\(z\\) is the depth below the water surface and \\(\\eta_a\\) is the attenuation coefficient for each band.\nThus, the shortwave energy per unit area entering layer \\(k\\) through its upper face is\n\\[\n\\Delta Q_k = Q_k-Q_{k-1}\n\\tag{6.4}\\]\nor\n\\[\n\\Delta Q_k = Q_k(1-e^{\\eta_a\\Delta Z_k})\n\\tag{6.5}\\]\nFor heating purposes, it is assumed that all of the \\(\\Delta Q\\)’s are converted to heat.\nIf there is excess short wave energy at the bottom of a column of water ELCOM reflects a portion of the energy back into the domain (currently 90% in Version 2.2). This energy is allowed to propagate back up through the water column according to the Beer-Lambert law.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#long-wave-energy-flux",
    "href": "sci-thermo.html#long-wave-energy-flux",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.3 Long Wave Energy Flux",
    "text": "6.3 Long Wave Energy Flux\nLongwave radiation is calculated by one of three methods, depending on the input data. Three input measures are allowed: incident long wave radiation, net long wave radiation, and cloud cover.\n\n6.3.1 Incident long wave radiation\nUsing incident long wave radiation requires accounting for albedo and long wave radiation emitted from the water surface. The long wave radiation penetrating the water surface is then\n\\[\nQ_{lw}=(1-r_a^{(lw)})Q_{lw(incident)}\n\\tag{6.6}\\]\nwhere \\(r_a^{(lw)}\\) is the albedo for long wave radiation, which is taken as a constant = 0.03 (Henderson-Sellers 1986).\nLong wave radiation emitted from the water surface is given by (Tennessee Valley Authority 1972, eqn 3.5)\n\\[\nQ_{lw(emitted)}=\\epsilon_w \\sigma T_w^4\n\\tag{6.7}\\]\nwhere \\(\\epsilon_w\\) is the emissivity of the water surface (=0.96), \\(\\sigma\\) is the Stefan-Boltzmann constant (\\(\\sigma =5.6697 \\times 10^{-8} \\; W \\, m^{-2} \\, K^{-4}\\)), and \\(T_w\\) is the absolute temperature of the water surface (i.e. the temperature of the surface layer).\nThe net longwave radiation energy density deposited into the surface layer for the period \\(\\Delta t\\) is therefore\n\\[\nQ_{lw}=(1-r_a^{(lw)})Q_{lw(incident)}-\\epsilon_w \\sigma T_w^4\n\\tag{6.8}\\]\n\n\n6.3.2 Net long wave radiation\nUsing net long wave radiation requires accounting for albedo at the water surface. The long wave radiation energy density deposited into the surface layer for the period \\(\\Delta t\\) is therefore\n\\[\nQ_{lw}=(1-r_a^{(lw)})Q_{lw(nett)}\n\\tag{6.9}\\]\n\n\n6.3.3 Cloud cover\nLong wave radiation can also be estimated from atmospheric conditions, using cloud cover fraction (\\(0 \\le C \\le 1\\)). The net long wave radiation energy density incident on the water surface can be estimated as\n\\[\nQ_{lw(rad)}=(1-r_a^{(lw)})Q_{lw(air)}\n\\tag{6.10}\\]\nwhere (Tennessee Valley Authority 1972, eqn 3.14; Fischer et al. 1979, eqn 6.21)\n\\[\nQ_{lw(air)}=(1+0.17C^2)\\epsilon_a(T_a) \\sigma T_a^4\n\\tag{6.11}\\]\nthe subscript \\(a\\) referring to properties of the air. Swinbank (1963) showed that\n\\[\n\\epsilon_a(T_a) = C_\\epsilon T_a^2\n\\tag{6.12}\\]\nwhere \\(C_\\epsilon = 9.37 \\times 10^{-6} \\; K^{-2}\\). As previously, the long wave emitted is\n\\[\nQ_{lw(emitted)}=\\epsilon_w \\sigma T_w^4\n\\tag{6.13}\\]\nThe net long wave radiation is therefore\n\\[\nQ_{lw}=(1-r_a^{(lw)})(1+0.17C^2)\\epsilon_a(T_a) \\sigma T_a^4-\\epsilon_w \\sigma T_w^4\n\\tag{6.14}\\]",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#sensible-heat-flux",
    "href": "sci-thermo.html#sensible-heat-flux",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.4 Sensible Heat Flux",
    "text": "6.4 Sensible Heat Flux\nThe sensible heat loss from the surface of the lake for the period \\(\\Delta t\\) may be written as (Fischer et al. 1979, eqn 6.19)\n\\[\nQ_{sh}=C_s \\rho_a C_P U_a (T_a-T_s)\\Delta t\n\\tag{6.15}\\]\nwhere \\(C_S\\) is the sensible heat transfer coefficient for wind speed at 10 m reference height above the water surface (\\(= 1.3 \\times 10^{-3}\\)), \\(\\rho_a\\) the density of air in kg m\\(^{-3}\\), \\(C_P\\) the specific heat of air at constant pressure (\\(= 1003 \\; J \\, kg^{-1} \\, K^{-1}\\)), \\(U_{a}\\) is the wind speed at the ‘standard’ reference height of 10 m in m s\\(^{-1}\\), with temperatures either both in Celsius or both in Kelvin.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#latent-heat-flux",
    "href": "sci-thermo.html#latent-heat-flux",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.5 Latent Heat Flux",
    "text": "6.5 Latent Heat Flux\nThe evaporative heat flux is given by (Fischer et al. 1979, eqn 6.20)\n\\[\nQ_{lh}=\\min \\left ( 0,\\frac{0.622}{P}C_L \\rho_a L_E U_a (e_a-e_s(T_s)) \\Delta t \\right )\n\\tag{6.16}\\]\nwhere \\(P\\) is the atmospheric pressure in pascals, \\(C_{L}\\) is the latent heat transfer coefficient (\\(= 1.3 \\times 10^{-3}\\)) for wind speed at the reference height of 10 m, \\(\\rho_{a}\\) the density of air in kg m\\(^{-3}\\), \\(L_{E}\\) the latent heat of evaporation of water (\\(= 2.453 \\times 10^{6} \\; J \\, kg^{-1}\\)), \\(U_{a}\\) is the wind speed in m s\\(^{-1}\\) at the reference height of 10 m, \\(e_{a}\\) the vapour pressure of the air, and \\(e_{s}\\) the saturation vapour pressure at the water surface temperature \\(T_{S}\\); both vapour pressures are measured in pascals. The condition that \\(Q_{lh} \\le 0\\), is so that no condensation effects are considered.\nThe saturated vapour pressure \\(e_{s}\\) is calculated via the Magnus-Tetens formula (Tennessee Valley Authority 1972, eqn 4.1):\n\\[\ne_s(T_s)=100 \\exp\\left [ 2.3026 \\left (\\frac{7.5T_s}{T_s+237.3}+0.758 \\right ) \\right]\n\\tag{6.17}\\]\nwhere \\(T_{s}\\) is in degrees Celsius and \\(e_{s}\\) is in pascals.\nThus, the total non-penetrative energy density deposited in the surface layer during the period \\(\\Delta t\\) is given by\n\\[\nQ_{non-pen}=Q_{lw}+Q_{sh}+Q_{lh}\n\\tag{6.18}\\]",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#surface-mass-fluxes",
    "href": "sci-thermo.html#surface-mass-fluxes",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.6 Surface Mass Fluxes",
    "text": "6.6 Surface Mass Fluxes\n\n6.6.1 Latent heat mass flux density\nThe change in mass in the surface layer cells (layer number \\(N\\)) due to latent heat flux is calculated as\n\\[\n\\Delta M_N^{lh}=\\frac{-Q_{lh}d_X d_Y}{L_V}\n\\tag{6.19}\\]\nwhere \\(d_{X}\\) and \\(d_{Y}\\) are the grid size of the surface layer cell and \\(L_{V}\\) is the latent heat of vaporisation for water.\n\n\n6.6.2 Rainfall\nIt is assumed that the temperature of the rain is the same as that of the surface cell. The salinity and water quality are set to zero. The change in surface layer mass is\n\\[\n\\Delta M_N^{rain}=\\rho_{rain} d_X d_Y r \\Delta t\n\\tag{6.20}\\]\nwhere \\(r\\) is the rainfall in m s\\(^{-1}\\).",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-thermo.html#atmospheric-stability-and-surface-exchange",
    "href": "sci-thermo.html#atmospheric-stability-and-surface-exchange",
    "title": "6  Surface Thermodynamics and Mass Fluxes",
    "section": "6.7 Atmospheric Stability and Surface Exchange",
    "text": "6.7 Atmospheric Stability and Surface Exchange\nOne factor known to cause variability in the heat and momentum transfer described above is air column stability and water roughness (Imberger and Patterson 1990). This has the effect of altering the exchange coefficients \\(C_{S}\\), \\(C_{L}\\) and \\(C_{D}\\).\nIf the meteorological sensors are located within the internal boundary layer over the surface of the lake, and data is collected at sub-daily intervals, it is appropriate to consider the effect of air column stability on surface exchange. ELCOM uses the iterative procedure of Hicks (1975) to compute these values, as described in Imberger and Patterson (1990) (p329). The user is referred to these references for more information.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Surface Thermodynamics and Mass Fluxes</span>"
    ]
  },
  {
    "objectID": "sci-mixing.html",
    "href": "sci-mixing.html",
    "title": "7  Mixing Model",
    "section": "",
    "text": "7.1 Introduction\nELCOM models the vertical Reynolds stress terms (and thus the turbulent fluxes) in momentum and transport equations with a 3D mixed-layer approach derived from the mixing energy budgets developed for 1D lake modeling (Imberger and Patterson 1981, 1990; Spigel, Imberger, and Rayner 1986). Whereas 1D mixed-layer models are typically Lagrangian, regridding the vertical domain to match the number of mixed regions in the water column, the present 3D method uses an Eulerian fixed-grid framework as Lagrangian 3D methods typically obtain highly skewed grid cells when horizontal gradients in mixing occur. The present model applies a separate 1D mixed-layer model to each water column to provide vertical turbulent transport, whereas 3D transport of TKE is used to provide the dynamic effect of 3D motions on the TKE available for vertical mixing.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Mixing Model</span>"
    ]
  },
  {
    "objectID": "sci-mixing.html#energy-terms-in-the-mixed-layer-model",
    "href": "sci-mixing.html#energy-terms-in-the-mixed-layer-model",
    "title": "7  Mixing Model",
    "section": "7.2 Energy Terms in the Mixed Layer Model",
    "text": "7.2 Energy Terms in the Mixed Layer Model\nTo understand the present mixed-layer approach, it is useful to qualitatively define some of the energy fluxes. First, we can characterize four energy terms:\n\nThe TKE available for mixing, \\(TKE_A\\)\nThe TKE required for mixing, \\(E_{req}\\)\nThe TKE dissipated, \\(E_{\\epsilon}\\) and\nThe residual mixing energy, \\(E_M\\).\n\nOf these, only the last, which is effectively the sum of the others at the end of the mixing algorithm, is considered a transported variable. Second, it is useful to characterize two types of mixing events in a stratified fluid:\n\nConvective mixing of unstable density gradients that decreases the potential energy of the fluid and releases TKE\nMixing of stable density gradients that dissipates TKE and increases potential energy.\n\nThe former is one of the TKE sources for mixing (\\(TKE_A\\)), whereas the latter is exactly the local energy required to mix (\\(E_{req}\\)). These two density gradient terms are computed from the vertical buoyancy scale, with the magnitude of a negative value providing the convective contribution to \\(TKE_A\\) and a positive value providing \\(E_{req}\\). The distinction between the positive and negative forms of the buoyancy scale is critical to the model, as an unstable density gradient will always create \\(TKE_A\\), whereas a stable gradient (\\(E_{req} &gt; 0\\)) will consume \\(TKE_A\\) only when \\(TKE_A \\ge E_{req}\\). Finally, we need a definition for a ‘mixed layer’; this is taken to be a set of vertically contiguous grid cells that share the same density, scalar concentrations, and grid-scale velocity. According to this definition, the discrete version of a linear stratification with seven grid cells shown in Figure 7.1(a) is a system with seven mixed layers, whereas the system in Figure 7.1(c) has the same number of vertical grid cells but only four mixed layers. Note that in this mixed-layer model, the layers do not have a dynamical existence outside the mixing algorithm and do not carry forward from time step to time step. That is, when the mixing routine is called, the layers are computed from the present density structure and mixing energy without explicit reference to any prior layer structure.\n\n\n\n\n\n\nFigure 7.1: Development of a mixed layer due to surface cooling and unstable stratification. (a) Stable stratification at start of time step; (b) surface cooling creates unstable density profile; (c) unstable grid cells have been mixed.\n\n\n\nThe present approach is considerably simpler than many 1D models (e.g. Spigel, Imberger, and Rayner 1986) in that differential equations coupling layer thickness, entrainment rates, and heat transfer through the surface are not used. The fundamental presumption of our modeling approach is that the vertical grid resolution for practical 3D lake models is too coarse to adequately compute the solution of differential equations for mixed-layer evolution or heat transfer with gradient boundary conditions. Indeed, the need to model with coarse vertical grid resolution was the impetus for abandoning the vertical eddy-diffusion differential equations generally used for mixing. The surface thermodynamics in ELCOM enter the system as discrete changes to the temperature structure in the upper grid cells rather than as boundary conditions on transport or mixing equations. At the beginning of a time step, nonpenetrative heat flux (e.g., long-wave radiation, convective heat transfer) is added to the uppermost grid cell while solar radiation is added to the water column using exponential decay over depth. The heat transfer changes the density stratification, either providing \\(TKE_A\\) (unstable density gradients produced by net cooling) or increasing \\(E_{req}\\) (stable stratification produced by net warming). Once the new density field is calculated, the mixing process is modeled on a layer-by-layer basis through each \\((i, j)\\) water column by comparing the available mixing energy (\\(TKE_A\\)) from convective overturns, shear production, wind stirring, and TKE storage (\\(E_{M}\\)) to the potential energy increase (\\(E_{req}\\)) required to mix a grid cell up into the mixed layer above itself. This mixing process is explained in the following section.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Mixing Model</span>"
    ]
  },
  {
    "objectID": "sci-mixing.html#a-mixing-timestep",
    "href": "sci-mixing.html#a-mixing-timestep",
    "title": "7  Mixing Model",
    "section": "7.3 A Mixing Timestep",
    "text": "7.3 A Mixing Timestep\nA mixing model timestep for each column of water can be broken down into the following steps:\n\nCalculate wind energy input, \\(E_{wind}\\)\nIf the TBBL boundary condition is being used calculate bottom energy input, \\(E_{drag}\\)\nFor each column cycle from surface cell to bottom cell\nCalculate generation of TKE by shear, \\(E_{shear}\\)\nCalculate energy required for mixing, \\(E_{req}\\)\nCalculate total energy available if two cells were totally mixed, \\(TKE_{mixed}\\)\nCalculate time estimate for total mixing \\(T_{TKE}\\)\nIf unstable calculate time estimate based on convective overturn \\(T_{conv}\\)\nCalculate mixing fraction \\(\\eta_{f}\\)\nIf there is enough energy then mix cells\nEnd of cycle from surface cell to bottom cell\nDissipate excess mixing energy\n\n\n7.3.1 Wind Energy\nWind generation of TKE is parameterised as\n\\[\nE_{wind} =  \\frac{1}{2} C_n^{3} \\, dt \\, u_{*}^{3}\n\\tag{7.1}\\]\nwhere \\(u_{*}\\) is the wind shear velocity given by\n\\[\nu_{*} = \\sqrt{\\frac{C_D^{wind}\\rho_{air}}{\\rho_0}}U_{wind}\n\\tag{7.2}\\]\nand the mixing coefficient \\(C_n\\) is set to 1.33. The wind energy for each column is added to the available TKE of the surface cell.\n\\[\nTKE_{surf}=TKE_{surf}+E_{wind}\n\\tag{7.3}\\]\n\n\n7.3.2 Bottom Energy\nIf the DEFAULT_BC is set to TBBL then TKE is also generated due to drag on the bottom. This energy is parameterised as\n\\[\nE_{drag} = C_{b}(|u_{bot}|+|v_{bot}|)^{3/2} \\, dt\n\\tag{7.4}\\]\nthe mixing coefficient \\(C_b\\) is set to 2.2. The bottom energy for each column is added to the available TKE of the bottom cell.\n\\[\nTKE_{bot}=TKE_{bot}+E_{drag}\n\\tag{7.5}\\]\n\n\n7.3.3 Begin Cycle from Surface to Bottom\nOnce the external energy sources have been added to the surface and bottom cells the main mixing routine is called. This routine loops from the surface cell to the bottom cell and generates the mixing layers for the column.\nThe loop first sets the surface cell (\\(k_{surf}\\)) to a mixed layer and attempts to mix the cell \\(k_{surf}-1\\) into this mixed layer. If there is enough energy to mix the cells and \\(\\Delta t\\) is large enough for the cell to be fully mixed (\\(\\eta_f = 1\\)) then the cells are mixed, \\(k_{surf}-1\\) is added to the mixed layer and then we attempt to mix \\(k_{surf}-2\\) with the mixed layer. If there is not enough energy for mixing to occur or \\(\\eta_f &lt; 1\\) then the mixed layer is closed, (\\(k_{surf} - 1\\)) is set to a mixed layer and energy budgets are computed for \\(k_{surf}-2\\). If there is enough energy for mixing to occur but the mixing fraction is \\(&lt;1\\) then partial mixing occurs.\n\n\n7.3.4 Shear Energy\nShear generation of TKE is parameterised as\n\\[\nE_{shear}=\\frac{1}{2}C_{S}S^{2}dz_l\n\\tag{7.6}\\]\nthe mixing coefficient \\(C_s\\) is set to 0.15 and \\(S\\) is the shear defined as\n\\[\nS^{2}=(U_{ml}-U_{l})^{2}+(V_{ml}-V_{l})^{2}\n\\tag{7.7}\\]\nsubscripts \\(ml\\) refer to values in the mixed layer and subscripts \\(l\\) refer to the cell directly below the mixed layer, i.e. the cell that we are checking to see if it will become part of the mixed layer. Shear energy is stored in the cell that is being mixed into the mixed layer.\n\n\n7.3.5 Potential Energy\nThe energy required to mix the current cell into the mixed layer is given by\n\\[\nE_{req}=-g^\\prime \\, dz_{l} \\, dz_{ml}\n\\tag{7.8}\\]\nwhere the reduced gravity term is given by\n\\[\ng^\\prime=\\frac{1}{2}g(\\rho_{ml}-\\rho_{l})\\frac{(dz_{ml} \\, dz_{l})}{\\rho_{ml}(dz_{ml}+dz_{l})\\rho_{l}}\n\\tag{7.9}\\]\n\\(dz_{ml}\\) is the mixed layer depth given by the sum of all the \\(dz\\) of cells in the mixed layer.\n\n\n7.3.6 Total Available TKE Energy\nTo determine a timescale for the mixing we first determine the total amount of energy if the cell of interest is completely mixed into the mixing layer. If the density profile is unstable then energy generated from convective overturns is added. The total \\(TKE\\) is then\n\\[\nTKE_{mixed}=\n\\begin{cases}\nTKE_{ml}+TKE_{l}+E_{shear} & \\text{if } E_{req}\\ge 0 \\\\\nTKE_{ml}+TKE_{l}+E_{shear}-C_{C}E_{req} & \\text{if } E_{req}&lt; 0\n\\end{cases}\n\\tag{7.10}\\]\nthe mixing coefficient \\(C_c\\) is set to 0.2. The \\(TKE\\) of the mixed layer (\\(TKE_{ml}\\)) and the cell (\\(TKE_{l}\\)) include energy from wind stirring and bottom drag as detailed above.\n\n\n7.3.7 Timescale for Mixing due to Turbulence\nTo try and limit the time step dependence on mixing we introduce a timescale for the mixing to occur. If this timescale is larger than the timestep used then partial mixing occurs. The time scale due to turbulent mixing is given by\n\\[\nT_{turb}=C_{TT} \\, dz_{l}\\sqrt{\\frac{C_{s}(dz_{ml}+dz_{l})}{2 \\, TKE_{mixed}}}\n\\tag{7.11}\\]\nthe coefficient \\(C_{TT}\\) is set to 50.0.\n\n\n7.3.8 Timescale for Mixing due to Convective Overturn\nIf the density profile is unstable then we introduce a timescale for overturning.\n\\[\nT_{conv}=C_{TC} \\, dz_{l}\\sqrt{\\frac{dz_{l}}{g^\\prime}}\n\\tag{7.12}\\]\nIf the time scale for overturning is shorter than the timescale for mixing due to turbulence then we use this timescale to calculate our mixing fraction.\n\n\n7.3.9 Calculate Mixing Fraction\nThe mixing fraction is simply the timestep \\(\\Delta t\\) divided by the shorter of the two timescales. The mixing fraction is limited to 1.0.\n\\[\n\\eta_{f}=\\min\\left(\\frac{\\Delta t}{\\min(T_{TKE},T_{conv})},1.0 \\right)\n\\tag{7.13}\\]\n\n\n7.3.10 Energy Budget\nBefore any mixing takes place the mixing routine checks to see if there is sufficient \\(TKE\\) available to overcome the potential energy. If \\(TKE_{mixed} \\ge \\eta_f E_{req}\\) the mixing takes place using the calculated mixing fraction. If \\(TKE_{mixed}&lt;E_{req}\\) no mixing occurs, the available \\(TKE\\) is dissipated completely and the mixed layer is closed. For complete mixing any excess \\(TKE\\) (i.e. \\(TKE_{mixed}-E_{req}\\)) is stored in the mixed layer and is included in the energy budget for the next layer. For partial mixing excess \\(TKE\\) is stored proportionally by volume in the mixed layer and the cell being mixed.\n\n\n7.3.11 Mixing of Cell into Mixed Layer\nThe mixing of cells depends on whether the cells are fully or partially mixed. If \\(\\eta_{f} = 1\\) all scalar and velocity values within the mixed layer are equal. Scalar concentrations are mixed by volume such that\n\\[\nC_{ml}^{\\prime}=\\frac{C_{ml} \\, dz_{ml}+C_l \\, dz_l}{dz_{ml}+dz_l}\n\\tag{7.14}\\]\nwhere \\(C_{ml}\\) is the scalar concentration of the mixed layer and \\(C_l\\) is the scalar concentration of the cell being mixed. The prime indicates the value after mixing.\nVelocities are mixed by mass such that\n\\[\nU_{ml}^{\\prime}=\\frac{\\rho_{ml}U_{ml} \\, dz_{ml}+\\rho_{l}U_l \\, dz_l}{\\rho_{ml} \\, dz_{ml}+\\rho_{l} \\, dz_l}\n\\tag{7.15}\\]\nFor partial mixing only the cell being mixed and the cell at the bottom of the mixed layer are modified.\n\\[\nC_k=\n\\begin{cases}\nC_{ml} & k=k_l+2:k_{ml-top} \\\\\n(1-\\eta_f )C_{ml}+\\eta_f \\frac{C_{ml} \\, dz_{k}+C_l \\, dz_l}{dz_{k}+dz_l} & k=k_l+1 \\\\\n(1-\\eta_f )C_{l}+\\eta_f\\frac{C_{ml} \\, dz_{k+1}+C_l \\, dz_l}{dz_{k+1}+dz_l} & k=k_l\n\\end{cases}\n\\tag{7.16}\\]\nwhere \\(C_k\\) is the concentration of layer \\(k\\) in the column, \\(k_l\\) refers to the layer of the cell being mixed and \\(k_{ml-top}\\) is the layer of the top of the mixed layer. An analogous expression to Equation 7.15 is used for partial mixing of velocity.\n\n\n7.3.12 End of Cycle\nOnce the bottom cell is reached the cycle is concluded.\n\n\n7.3.13 Dissipation of Energy\nAfter the mixing of cells has concluded excess energy is dissipated according to\n\\[\nTKE=TKE-\\frac{1}{2}C_{\\epsilon} \\Delta t \\left (\\frac{TKE}{dz} \\right )^{3/2}\n\\tag{7.17}\\]\nwhere the dissipation coefficient \\(C_{\\epsilon}\\) is set to 1.15. Any \\(TKE\\) left after dissipation is then transported by the scalar transport routine before becoming available for mixing in the following timestep.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Mixing Model</span>"
    ]
  },
  {
    "objectID": "sci-mixing.html#ri-derivation",
    "href": "sci-mixing.html#ri-derivation",
    "title": "7  Mixing Model",
    "section": "7.4 Ri Derivation",
    "text": "7.4 Ri Derivation\nWe are attempting to mix a cell below the mixed layer (of thickness \\(\\Delta z_l\\)) into the mixed layer (of thickness \\(\\Delta z_{ml}\\)).\nMixing fraction \\(F_m\\) is defined as the fraction of the lower cell that is to be mixed into the mixed layer.\nThe combined potential energy of the mixed layer and the cell to be mixed before mixing is given by\n\\[\nPE=g\\rho_l \\Delta z_l \\frac{\\Delta z_l}{2}+g\\rho_{ml} \\Delta z_{ml} \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\tag{7.18}\\]\nThe combined potential energy of the mixed layer and the cell to be mixed after mixing is given by\n\\[\nPE^*=g\\rho_l^* \\Delta z_l \\frac{\\Delta z_l}{2}+g\\rho_{ml}^* \\Delta z_{ml} \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\]\nwhere the \\(*\\) superscripts indicate values after mixing. If we note that\n\\[\n\\rho_{ml}^*= \\frac{\\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\rho_{l}}{\\Delta z_{ml}+F_m\\Delta z_{l}}\n\\]\nand\n\\[\n\\rho_{l}^*= (1-F_m)\\rho_{l}+F_m\\rho_{ml}^*\n\\]\n\\[\n\\rho_{l}^*= (1-F_m)\\rho_{l}+\\frac{F_m\\Delta z_{ml}\\rho_{ml}+F_m^2\\Delta z_{l}\\rho_{l}}{\\Delta z_{ml}+F_m\\Delta z_{l}}\n\\]\nThen\n\\[\nPE^*=g\\left[ (1-F_m)\\rho_{l}+\\frac{F_m\\Delta z_{ml}\\rho_{ml}+F_m^2\\Delta z_{l}\\rho_{l}}{\\Delta z_{ml}+F_m\\Delta z_{l}} \\right] \\Delta z_l \\frac{\\Delta z_{l}}{2}+g\\left[  \\frac{\\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\rho_{l}}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\right] \\Delta z_{ml} \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\left[ (1-F_m)\\rho_{l}(\\Delta z_{ml}+F_m\\Delta z_{l})+F_m\\Delta z_{ml}\\rho_{ml}+F_m^2\\Delta z_{l}\\rho_{l} \\right] \\Delta z_l \\frac{\\Delta z_{l}}{2}\n\\\\\n+\\left[  \\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\rho_{l}\\right] \\Delta z_{ml} \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\end{array}\n\\right]\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\left[ (\\rho_{l}-F_m\\rho_{l})(\\Delta z_{ml}+F_m\\Delta z_{l})+F_m\\Delta z_{ml}\\rho_{ml}+F_m^2\\Delta z_{l}\\rho_{l} \\right] \\Delta z_l \\frac{\\Delta z_{l}}{2}\n\\\\\n+\\left[  \\Delta z_{ml}\\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\Delta z_{ml}\\rho_{l}\\right]  \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\end{array}\n\\right]\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\left[ \\rho_{l}\\Delta z_{ml}-F_m\\rho_{l}\\Delta z_{ml}+\\rho_{l}F_m\\Delta z_{l}-F_m^2\\rho_{l}\\Delta z_{l}+F_m\\Delta z_{ml}\\rho_{ml}+F_m^2\\Delta z_{l}\\rho_{l} \\right] \\Delta z_l \\frac{\\Delta z_{l}}{2}\n\\\\\n+\\left[  \\Delta z_{ml}\\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\Delta z_{ml}\\rho_{l}\\right]  \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\end{array}\n\\right]\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\left[ \\rho_{l}\\Delta z_{ml}-F_m\\rho_{l}\\Delta z_{ml}+\\rho_{l}F_m\\Delta z_{l}+F_m\\Delta z_{ml}\\rho_{ml} \\right] \\Delta z_l \\frac{\\Delta z_{l}}{2}\n\\\\\n+\\left[  \\Delta z_{ml}\\Delta z_{ml}\\rho_{ml}+F_m\\Delta z_{l}\\Delta z_{ml}\\rho_{l}\\right]  \\left ( \\Delta z_l+\\frac{\\Delta z_{ml}}{2} \\right )\n\\end{array}\n\\right]\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\frac{1}{2}\\rho_{l}\\Delta z_{l}^2\\Delta z_{ml}\n-\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}^2\\Delta z_{ml}\n+\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}^3\n+\\frac{1}{2}F_m\\rho_{ml}\\Delta z_{l}^2\\Delta z_{ml}\n\\\\\n+\\rho_{ml}\\Delta z_l\\Delta z_{ml}^2\n+\\frac{1}{2}\\rho_{ml}\\Delta z_{ml}^3\n+F_m\\rho_{l}\\Delta z_{l}^2\\Delta z_{ml}\n+\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}\\Delta z_{ml}^2\n\\end{array}\n\\right]\n\\]\n\\[\nPE^*=\n\\frac{g}{\\Delta z_{ml}+F_m\\Delta z_{l}}\\left[\n\\begin{array}{l}\n\\frac{1}{2}\\rho_{l}\\Delta z_{l}^2\\Delta z_{ml}\n+\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}^2\\Delta z_{ml}\n+\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}^3\n+\\frac{1}{2}F_m\\rho_{ml}\\Delta z_{l}^2\\Delta z_{ml}\n\\\\\n+\\rho_{ml}\\Delta z_l\\Delta z_{ml}^2\n+\\frac{1}{2}\\rho_{ml}\\Delta z_{ml}^3\n+\\frac{1}{2}F_m\\rho_{l}\\Delta z_{l}\\Delta z_{ml}^2\n\\end{array}\n\\right]\n\\]",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Mixing Model</span>"
    ]
  },
  {
    "objectID": "sci-filter.html",
    "href": "sci-filter.html",
    "title": "8  Numerical Diffusion Filter",
    "section": "",
    "text": "This chapter describes a technique for maintaining vertical density stratification over seasonal timescales. The technique involves estimating the numerical diffusion of mass occurring in each time-step and applying a compensating correction to the density field. Since advection does not change background potential energy, \\(E_b\\) (Winters et al. 1995), it follows that changes in \\(E_b\\) during advection must be entirely due to numerical diffusion (in the absence of inflows/outflows). As ELCOM employs an operator splitting solution of the scalar transport equation, \\(E_b\\) can be calculated before and after advection to quantify numerical diffusion of mass. This method has two shortcomings: 1) The measure is global, thus it does not provide a spatial distribution of diffusion. 2) The current implementation does not allow inflows/outflows that affect \\(E_b\\). The first drawback is inherent in the methodology and can only be addressed in an approximate manner, while the second drawback could be exactly removed by quantifying the buoyancy flux of inflows/outflows. In this chapter we concentrate on the first problem by developing a method to approximately redistribute \\(E_b\\) for domains with no inflows/outflows. The problems associated with inflows/outflows remain a subject for further research. The contribution of this chapter is a methodology for using \\(E_b\\) to reconstruct a density field that minimizes numerical diffusion. Mathematically, we desire a correction technique that satisfies:\n\\[\n\\frac{\\{E_b^+\\} - E_b^-}{E_b^-} &lt; \\epsilon_B\n\\tag{8.1}\\]\nat each time-step. \\(E_b^-\\) and \\(E_b^+\\) are the background potential energy before and after the transport calculation respectively. The curly braces above and hereinafter represent the application of a correction technique. The threshold \\(\\epsilon_B\\) is based on the capabilities of the method and represents the minimum expected reduction in numerical diffusion. In a numerical simulation of a lake, density stratification varies smoothly and monotonically with depth and, to first order, can be characterized as two weakly stratified regions (an epilimnion and a hypolimnion), separated by a strongly stratified metalimnion. The observed effect of numerical diffusion is thickening of the metalimnion. Thus, the cumulative effect is similar to vertical diffusion from the metalimnion. To first order, mitigating numerical diffusion is achieved through an anti-diffusion vertical mass flux, which is applied herein using a sharpening filter acting vertically on the density profile in each water column.\nThe sharpening filter was previously developed to enhance field instrument response (Fozdar, Parker, and Imberger 1985). It is a three point recursive filter based on the inverse Z-transform of a linear response to a Heaviside step function, and is represented as follows:\n\\[\n\\{S_k\\} = \\frac{1-a^\\prime}{1-a}(S_k-S_{k-1})+a^\\prime \\{S_{k-1}\\}\n\\tag{8.2}\\]\nwhere \\(a= e^{-\\Delta z / l}\\), \\(a^\\prime= e^{-\\Delta z / l^\\prime}\\), \\(\\Delta z\\) is the vertical grid spacing, \\(l\\) and \\(l^\\prime\\) are sharpening and smoothing length scales respectively, \\(k\\) is a grid cell index, \\(S_k\\) is a series value before application of the filter, \\(\\{S_k\\}\\) is a series value after application of the filter. To simulate the bi-directionality of diffusion in one dimension the filter is applied both upwards and downwards.\nOne problem with the original sharpening filter is gradient amplification at boundaries, which creates artificial minima and maxima. Where such extrema are unstable density gradients, they must be mixed in a hydrostatic model. Where such extrema are stable density gradients, they increase the TKE required for mixing. The cumulative effects are maximum and minimum values of density beyond the original values, and distortion of mixing dynamics. To correct this effect, an endpoint limiter and gradient preservation are applied after filtering. The gradient before filtering is calculated for both the top and bottom of each water column. After filtering, top and bottom gradients are restored to pre-filter values. After gradient correction any new extrema are restored to pre-filtering values. Applying this endpoint gradient preservation and extrema limiter adversely affects mass conservation and raises the minimum practical threshold, \\(\\epsilon_B\\). Since changes per time-step are extremely small, a simple mass correction is applied to evenly remove the change in mass incurred by the filtering. The change in mass due to filtering is divided by the number of cells containing less than average mass. That change in mass per cell is then subtracted from cells containing less than average mass. By applying mass correction before the extrema limiting, no new extrema are created, and the mass redistribution has the effect of further sharpening the overall stratification.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Numerical Diffusion Filter</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html",
    "href": "sci-underflow.html",
    "title": "9  Underflow Model",
    "section": "",
    "text": "9.1 Introduction\nThe underflow model in ELCOM is based on the numerical approach proposed by Bradford and Katapodes (1999) with finite-volume spatial discretization, conservation equations advanced by a predictor-corrector algorithm and Roe (1981) approximate Riemann solver for fluxes through cell faces. The conservation equations of Bradford and Katapodes (1999) have been modified to use salinity and temperature instead of turbidity, and terms have been added to model 1) effects of the earth’s rotation, 2) gradients in ambient fluid salinity and 3) momentum of the background circulation. The entrainment relationship has been changed to the formulation of Dallimore, Imberger, and Ishikawa (2001), developed from a parameterisation of the turbulent kinetic energy equation. The general grid transformations of Bradford and Katapodes (1999) are replaced with a simple Cartesian-grid approach for compatibility with the Cartesian grid in ELCOM.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html#governing-equations",
    "href": "sci-underflow.html#governing-equations",
    "title": "9  Underflow Model",
    "section": "9.2 Governing Equations",
    "text": "9.2 Governing Equations\nThe underflow model governing equations are the vertically-integrated equations of volume, momentum and salinity based on derivations of Ellison and Turner (1959). Assuming unity values for the shape factors while including the ambient fluid properties, the conservation equations of volume, x momentum, y momentum and salinity are respectively given by\n\\[\n\\frac{\\partial(H)}{\\partial t}+\\frac{\\partial(UH)}{\\partial x}+\\frac{\\partial(VH)}{\\partial y}=E\\sqrt{U^2+V^2}\n\\tag{9.1}\\]\n\\[\n\\frac{\\partial(UH)}{\\partial t}+\\frac{\\partial(U^2H)}{\\partial x}+\\frac{\\partial(UVH)}{\\partial y}=fVH-C_DU\\sqrt{U^2+V^2}- \\frac{1}{2}\\frac{\\partial(g'H^2)}{\\partial x}-g'HS_x+U_{amb}E\\sqrt{U^2+V^2}\n\\tag{9.2}\\]\n\\[\n\\frac{\\partial(VH)}{\\partial t}+\\frac{\\partial(UVH)}{\\partial x}+\\frac{\\partial(V^2H)}{\\partial y}=-fUH-C_DV\\sqrt{U^2+V^2}- \\frac{1}{2}\\frac{\\partial(g'H^2)}{\\partial y}-g'HS_y+V_{amb}E\\sqrt{U^2+V^2}\n\\tag{9.3}\\]\n\\[\n\\frac{\\partial(SH)}{\\partial t}+\\frac{\\partial(SUH)}{\\partial x}+\\frac{\\partial(SVH)}{\\partial y}=S_{amb}E\\sqrt{U^2+V^2}\n\\tag{9.4}\\]\nwhere \\(H\\) is the height of the underflow; \\(U\\) and \\(V\\) are vertically averaged velocities in the \\(x\\) and \\(y\\) directions; \\(S\\) is the vertically averaged salinity; \\(g'\\) is the reduced gravity term \\(= g(\\rho-\\rho_{amb})/\\rho_{amb}\\), \\(f\\) is the Coriolis parameter; \\(C_D\\) is the bottom drag coefficient; \\(E\\) is the entrainment coefficient and \\(S_x\\) and \\(S_y\\) are the bottom slopes in the \\(x\\) and \\(y\\) directions. The subscripts \\(amb\\) refer to the ambient value of the variable. Ambient values used by the underflow model are obtained from the salinity and velocity at the bottom boundary cells of the 3D model, and are used to model entrainment through the last terms in the momentum and salinity equations.\nThe entrainment coefficient (\\(E\\)) in the governing equations is given by the entrainment law of Dallimore, Imberger, and Ishikawa (2001). The equation has been altered to account for the ambient flow and is given by\n\\[\nE=\\frac{C_KC_D^{3/2}+C_s\\left(\\frac{\\Delta u}{\\sqrt{U^2+V^2}}\\right)^{3/2}}{Ri+ 10\\left(C_KC_D^{3/2}+C_s\\left(\\frac{\\Delta u}{\\sqrt{U^2+V^2}}\\right)^{3/2}\\right)}\n\\tag{9.5}\\]\nwhere\n\\[\n\\Delta u =\\sqrt{(U^2-U_{amb}^2)+(V^2-V_{amb}^2)}\n\\tag{9.6}\\]\nand \\(Ri\\) is the bulk Richardson number given by\n\\[\nRi=\\frac{g'H}{U^2+V^2}\n\\tag{9.7}\\]\nThe parameterisation constants \\(C_K\\) and \\(C_S\\) account for the bottom production and shear production terms respectively.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html#model-implementation",
    "href": "sci-underflow.html#model-implementation",
    "title": "9  Underflow Model",
    "section": "9.3 Model Implementation",
    "text": "9.3 Model Implementation\nThe model is implemented using a finite-volume method. The predictor-corrector scheme (explicit prediction and implicit correction) as outlined by Bradford and Katapodes (1999) is used to obtain second-order temporal accuracy. The predictor solution is obtained from the primitive form of the governing equations. Following Bradford and Katapodes (1999), the primitive forms of governing equations are used for computational efficiency and can be written as:\n\\[\n\\frac{\\partial H}{\\partial t}+U\\frac{\\partial H}{\\partial x}+H\\frac{\\partial U}{\\partial x}+V\\frac{\\partial H}{\\partial y} +H\\frac{\\partial V}{\\partial y}=E\\sqrt{U^2+V^2}\n\\tag{9.8}\\]\n\\[\n\\frac{\\partial U}{\\partial t}+g'\\frac{\\partial H}{\\partial x}+U\\frac{\\partial U}{\\partial x}+\\frac{1}{2}H\\frac{\\partial g'}{\\partial x}\n+V\\frac{\\partial U}{\\partial y}=\\frac{1}{H}\\left(U_{amb}E\\sqrt{U^2+V^2}-C_DU\\sqrt{U^2+V^2} \\right)+fVH-gS_x\n\\tag{9.9}\\]\n\\[\n\\frac{\\partial V}{\\partial t}+g'\\frac{\\partial H}{\\partial y}+V\\frac{\\partial V}{\\partial y}+\\frac{1}{2}H\\frac{\\partial g'}{\\partial y}\n+U\\frac{\\partial V}{\\partial x}=\\frac{1}{H}\\left(V_{amb}E\\sqrt{U^2+V^2}-C_DV\\sqrt{U^2+V^2} \\right)-fUH-gS_y\n\\tag{9.10}\\]\n\\[\n\\frac{\\partial S}{\\partial t}+U\\frac{\\partial S}{\\partial x}+V\\frac{\\partial S}{\\partial y}=\\frac{1}{H}(S-S_{amb})E\\sqrt{U^2+V^2}\n\\tag{9.11}\\]\nAn approximate (predictor) solution for the conservation of volume at time \\(t+\\Delta t/2\\) in cell \\(i\\), is given by\n\\[\nH_{i,j}^{n+1/2}=H_{i,j}^{n}-\\frac{\\Delta t}{2}\n\\left[\nU\\frac{\\overline{\\Delta H_x}}{\\Delta x}\n+V\\frac{\\overline{\\Delta H_y}}{\\Delta y}\n+H\\frac{\\overline{\\Delta U_x + \\Delta U_y}}{\\Delta x}\n-E\\sqrt{U^2+V^2}\n\\right]_{i,j}^n\n\\tag{9.12}\\]\nwhere superscripts represent the time step and subscripts represent the center of a grid cell in the horizontal underflow model grid. Note that \\(n+1/2\\) represents the computational time of the predictor step. Similar expressions (not shown for brevity) can be written for predictor conservation equations of salinity and momentum. Overbars in Equation 9.12 denote average gradients at the cell center computed from gradients across the cell faces in the \\(x\\) and \\(y\\) directions. For example\n\\[\n\\overline{\\Delta H_x}=\\text{avg}(H_{i,j}-H_{i-1,j},H_{i+1,j}-H_{i,j})=\\text{avg}(a,b)\n\\tag{9.13}\\]\nwhere the averaging function used in the underflow model is the \\(\\beta\\) family of averages given by\n\\[\n\\overline{\\Delta H_x}=\n\\begin{cases}\n\\text{sign}(a)\\min(\\max(|a|,|b|),\\beta \\min(|a|,|b|)) & ab&gt;0 \\\\\n0 & ab\\le0\n\\end{cases}\n\\tag{9.14}\\]\nFor all simulations, \\(\\beta\\) is equal to two, which corresponds to a Superbee averaging function.\nThe corrector solution is a coupled, implicit solution of a discrete form of the conservative governing equations using the predictor-step fluxes. For example, the conservation of volume equation can be written as\n\\[\n\\Delta x\\Delta y \\frac{H^{n+1}-H^{n}}{dt}=F_F^{n+1/2}\\Delta y+F_B^{n+1/2}\\Delta y+F_R^{n+1/2}\\Delta x+F_L^{n+1/2}\\Delta x+E\\sqrt{U^{(n+1/2)^2}+V^{(n+1/2)^2}}\n\\tag{9.15}\\]\nwhere \\(F_F\\), \\(F_R\\), \\(F_B\\) and \\(F_L\\) are the volume fluxes through the front, right, back and left cell faces respectively. Here the nomenclature is consistent with the ELCOM code, where the front is the cell face in the positive \\(x\\) direction, back is in negative \\(x\\), right is positive \\(y\\), and left is negative \\(y\\). The fluxes are defined as positive in the direction of increasing computational coordinates.\nThe fluxes at each cell face are calculated using the approximate Riemann solver developed by Roe (1981). These fluxes are given by\n\\[\nF_{F(i,j)}=F_{B(i+1,j)}=\\frac{1}{2}\\left(f_{F(i,j)}^{n+1/2} + f_{B(i+1,j)}^{n+1/2} - \\hat{R}|\\hat{\\Lambda}||\\Delta \\hat{V}|\\right)\n\\tag{9.16}\\]\nwhere the \\(f_{F(i,j)}\\) and \\(f_{B(i+1,j)}\\) refer to the estimated fluxes at the front face of cell \\((i,j)\\) and the back face of \\((i+1,j)\\) respectively. The third term on the right hand side is the Riemann flux term. The estimated fluxes at the front of cell \\((i,j)\\) are determined from the extrapolation of the primitive variables at the centre of the cell to the front face of the cell. For example the height at the front face of cell \\((i,j)\\) is given by\n\\[\nH_{F(i,j)}^{n+1/2}=H_{(i,j)}^{n+1/2}+\\frac{1}{2}\\overline{\\Delta H_x}_{i,j}^n\n\\tag{9.17}\\]\nand the estimated volume flux at the front face of cell \\((i,j)\\) is given by\n\\[\nf_{F(i,j)}^{n+1/2} =H_{F(i,j)}^{n+1/2}U_{F(i,j)}^{n+1/2}\n\\tag{9.18}\\]\nSimilar expressions can be written for the other faces and fluxes.\nIn matrix form the Riemann flux terms are detailed further in Dallimore, Imberger, and Ishikawa (2001) and Bradford and Katapodes (1999).\nTwo boundary conditions are used in the underflow model, solid wall and inflow. Inflows are implemented using ghost cells located outside the computational domain. The specified flow rate, salinity and underflow height are placed within the ghost cell for each timestep. Within the ghost cell all gradient terms are set to 0. The fluxes through the interface between the ghost cell and the interior cell are calculated using the Riemann solver as described above. Solid wall boundaries are cell faces where the fluxes are set to zero.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html#front-tracking",
    "href": "sci-underflow.html#front-tracking",
    "title": "9  Underflow Model",
    "section": "9.4 Front Tracking",
    "text": "9.4 Front Tracking\nFollowing Bradford and Katapodes (1999) a front-tracking scheme is used to eliminate artificial propagation of the density front resulting from discretization. Cells in the underflow model are defined as being ‘underflow’, ‘ambient’ or ‘frontal’. ‘Underflow’ cells are cells that are filled by the underflow; ‘ambient’ cells contain ambient water without underflow water, while ‘frontal’ cells are the boundary cells between the underflow and the ambient fluid that contain both types of water. In a frontal cell, fluxes are only calculated for faces that are bounded by an underflow cell. The front propagation distance in the \\(x\\) direction, \\(X_f\\), from time \\(n\\) to \\(n+1\\) within a frontal cell is given by\n\\[\nX_{f}^{n+1} =X_{f}^{n}+U_f^{n+1}\\Delta t\n\\tag{9.19}\\]\nwhere \\(U_f\\) is the front velocity. An analogous formula is used for the frontal distance in the \\(y\\) direction. If \\(X_f^{n+1}\\) is greater than the grid dimension (\\(\\Delta x\\)) then the cell is changed to an underflow cell and any adjacent ambient cell becomes a new frontal cell. While the concept is straightforward in one dimension, in 2D a cell may be a frontal cell with respect to both the \\(x\\) and \\(y\\) coordinate directions. This is simply a bookkeeping problem for the model, that is handled by designating any cell with both ambient and underflow water as a ‘frontal’ cell then checking whether one or two faces are involved in frontal propagation. At the end of each timestep, any ambient cell that has frontal cells on both \\(x\\) or both \\(y\\) faces is also designated as an underflow cell. This simplifies the computation for two fronts that are propagating in opposite directions and meet in a single ambient grid cell.\nAs pointed out by Bradford and Katapodes (1999) there are a number of possibilities for the frontal velocities \\(U_f\\) and \\(V_f\\). We follow their approach wherein the frontal velocity is based on the computed values of \\(U\\) and \\(V\\) in the frontal cells. We add the effect of the ambient flow on front propagation by computing the frontal velocities as\n\\[\nU_{f} =U+U_{amb}\n\\tag{9.20}\\]\nThis formulation provides a simple and robust first-order approximation for calculating the frontal propagation. Due to the explicit nature of the front-tracking scheme, the front must not propagate further than one grid cell in any timestep. If this condition is violated, the underflow model timestep is automatically halved and the underflow is recomputed. This acts recursively so that the underflow solution will always be stable. Note the timestep for the ambient 3D flow solver is not affected by the change in timestep of the underflow model.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html#coupling-the-model-to-elcom",
    "href": "sci-underflow.html#coupling-the-model-to-elcom",
    "title": "9  Underflow Model",
    "section": "9.5 Coupling the Model to ELCOM",
    "text": "9.5 Coupling the Model to ELCOM\nThis section discusses the coupling of the 2D underflow model with the 3D solver ELCOM. As an underflow travels along the bottom boundary of a water body it has two effects on the ambient water. Firstly it entrains ambient water into itself and secondly it displaces ambient fluid away from the bottom boundary. The proposed coupling scheme attempts to model these effects via the use of inflows and outflows across the bottom boundary of the 3D domain. The fundamental idea behind the scheme is to insert the net change in the underflow volume during each timestep through the bottom boundary of the 3D domain over the appropriate cells while still tracking the salinity of the underflow with the 2D model. In effect the water that is inserted into the 3D domain is designed to act as a ‘place holder’ that will be replaced with the underflow water once the underflow reaches its insertion level. A schematic of the coupling procedure is shown for a homogeneous ambient water body in Figure 9.1. The three basic steps of the scheme are:\n\nRemoval of the entrained water from the 3D domain (Figure 9.1 a)\nInsertion of the net volume increase in each underflow cell into the corresponding ELCOM bottom boundary cell (Figure 9.1 b)\nInsertion of salinity once the plume has reached its level of neutral buoyancy (Figure 9.1 c and d)\n\nStep one and two are implemented every timestep, step three only occurs once the underflow reaches the insertion level.\n\n\n\n\n\n\nFigure 9.1: Profiles showing coupling of the 2D underflow model to the 3D solver. The net volume for each underflow cell is calculated for each timestep (a). This volume is inserted as an inflow across the bottom boundary of the 3D domain (b). Once the underflow reaches its insertion level the salinity within a volume at the bottom of each column in the 3D domain is replaced with the salinity of the underflow. (d) shows the representation of the underflow within the 3D domain after insertion.\n\n\n\nBoth the entrainment and the net change in volume of an underflow cell (Figure 9.1 a) are easily calculated from the underflow model. After each underflow timestep is completed the entrained volume is removed from the appropriate cell on the bottom boundary of the 3D domain. The net change in volume of the underflow cell is then inserted into the 3D domain as an inflow across the bottom boundary of the corresponding 3D column. So as not to introduce any unwanted currents in the 3D domain this inflow is given a salinity equal to the salinity at the bottom of the ELCOM column. The idea is to insert the underflow volume over the appropriate cells while having the minimal effect on the ambient motions. In practice, because the entrained and the insertion fluid both have a salinity given by the salinity at the bottom of the 3D domain, step 1 and 2 are combined to form a single inflow for each column. The volume of the inflow is given by the change in volume of the cell minus the volume entrained into the cell and is equal to the net volume flux into the cell given by the modeled Riemann fluxes. If the net volume flux into the underflow cell is negative (e.g. at the tail of the underflow) then the appropriate volume is removed from the ELCOM cell as an outflow.\nIt can easily be shown that the sum of the net volume fluxes into all underflow cells, and hence the total volume flux into ELCOM, is equal to the specified inflow flux at the side boundary. This ensures that conservation of volume is maintained in the 3D solver and that the modeled free surface height in ELCOM accurately represents the supplied inflows.\nOnce the underflow reaches its insertion level the salinity in the 3D domain is altered to reflect the salinity of the underflow. The criteria for insertion are defined as when any underflow body cell is less dense than the ambient ELCOM cell ‘above it’ or when the height of the underflow is greater than 5 times ELCOM’s vertical grid size.\nThe idea behind the salinity insertion subroutine is to replace the salinity within a certain volume at the bottom of each column (\\(i,j\\)) in the 3D domain such that after the insertion the salinity in the 3D domain represents the height and salinity predicted by the underflow model at each cell (\\(i,j\\)). If the 3D domain has a uniform salinity before the underflow event occurs then the insertion is trivial. For this case both the volume input at the bottom boundary of the ELCOM domain and the entrained water into the underflow have a salinity equal to the uniform ambient salinity. It can be shown that for this scenario conservation of salinity is achieved by replacing the ambient salinity at the bottom of each column (\\(i,j\\)) up to a height equal to the underflow height at cell (\\(i,j\\)) with the underflow salinity (\\(S_{i,j}\\)). The replacement of salinity is achieved using the following formulae:\n\\[\nS^{ELCOM} =\n\\begin{cases}\nS & z_{top}&lt;H \\\\\n\\frac{S(H-z_{bot})}{dz} +\\frac{S^{ELCOM}(z_{top}-H)}{dz} & z_{bot}&lt;H \\le z_{top} \\\\\nS^{ELCOM} & z_{bot}&gt;H\n\\end{cases}\n\\tag{9.21}\\]\nwhere \\(S^{ELCOM}\\) is the salinity in the ELCOM cell, \\(dz\\) is the vertical grid size and \\(z_{top}\\) and \\(z_{bot}\\) are the height above the bottom of the top and bottom faces of the ELCOM cell. The representation of the underflow salinity in the 3D solver after insertion is shown in Figure 9.1(d).\nWhen the ambient salinity is not uniform the above scheme is not conservative for salinity. The problem is the total amount of salinity being replaced is not necessarily equal to the salinity that was input into the 3D domain before the time of insertion. There are two possible solutions to this; either the volume of water being replaced or the underflow salinity can be altered to arbitrarily balance salinity. In ELCOM the former was chosen for two reasons. Firstly, if the underflow salinity is changed there is the possibility that the new salinity will be unrealistically high. Secondly, because the height of the underflow in ELCOM must be an integer number of cells high a small change in the volume of water replaced in the ELCOM domain will have a small effect on the representation of the underflow within ELCOM. The height over which salinity is replaced in a column is given by\n\\[\nH_{insert}=H+\\frac{S_{removed}-S_{added}}{S\\Delta x\\Delta y}\n\\tag{9.22}\\]\nwhere \\(S_{removed}\\) is the total salinity replaced in the ELCOM column, \\(S_{added}\\) is the salinity that has been added through the bottom of the ELCOM column and \\(H\\) and \\(S\\) are the predicted height and salinity of the underflow. Once \\(H_{insert}\\) has been calculated the salinity within the 3D domain can be modified according to Equation 9.21 above with \\(H\\) replaced by \\(H_{insert}\\). Note that if \\(S_{removed} = S_{added}\\), as in the ambient uniform case, Equation 9.22 predicts an insertion height equal to the height of the underflow.\nThe two major parts of the insertion routine can be summarised as:\n\nAt each time step a volume is inserted through the bottom boundary of each column in the 3D domain. This volume is equal to the net volume flux into the corresponding underflow cell. The salinity of the inserted water is given by the salinity in the bottom cell of the ELCOM column.\nOnce the underflow has reached its level of insertion then the salinity in a certain volume at the base of every column in the 3D domain is replaced by the salinity of the corresponding underflow cell. The volume of water replaced is chosen to ensure conservation of salinity.\n\nIt should be noted that once the insertion of salinity has taken place and the tracking of the underflow has essentially been handed over to ELCOM that numerical convective entrainment will still occur. Two scenarios lead to the insertion of salinity. The first is when the height of the underflow is large compared to the vertical grid size in which case the effect of numerical mixing is small compared to the volume of the flow. The second scenario is when the underflow reaches neutral buoyancy. For this scenario the effect of convective entrainment is reduced because as water flows over a step in the bathymetry the water below it will have a similar salinity.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-underflow.html#plunge-point-analysis",
    "href": "sci-underflow.html#plunge-point-analysis",
    "title": "9  Underflow Model",
    "section": "9.6 Plunge Point Analysis",
    "text": "9.6 Plunge Point Analysis\nIn order to model the plunging region of an inflow event a simple first-order approximation was made to the underflow model to account for the error in the momentum equation. This modification deals with the symptoms of the momentum error rather than addressing the error directly. Once the underflow volume fluxes are calculated the underflow height for each underflow cell at timestep \\(n+1\\) is first estimated by neglecting the entrainment into the flow such that\n\\[\n\\Delta x\\Delta y \\frac{H^{n+1}-H^{n}}{dt}=F_F^{n+1/2}\\Delta y+F_B^{n+1/2}\\Delta y+F_R^{n+1/2}\\Delta x+F_L^{n+1/2}\\Delta x\n\\tag{9.23}\\]\nThe predicted underflow height for each cell is then compared to the corresponding depth of the reservoir in the 3D domain. If the underflow height is greater than the water depth then the volume fluxes are manipulated so that the \\(H^{n+1}\\) is equal to the depth of the reservoir. More specifically the volume flux through the face in the direction of the underflow front is increased to provide the necessary change. Scalar fluxes are altered to reflect the change in volume flux. In order to ensure that no mixing takes place before the plunge point of the underflow the entrainment coefficient for these cells is set to zero. Rather than altering the momentum equation to deal with a plunging flow, the conservation of volume equation is utilised to give\n\\[\nU^{n+1}=\\frac{F_F^{n+1/2}+F_B^{n+1/2}}{H^{n+1/2}}\n\\tag{9.24}\\]\n\\[\nV^{n+1}=\\frac{F_R^{n+1/2}+F_L^{n+1/2}}{H^{n+1/2}}\n\\tag{9.25}\\]\nA further complication can arise during the solution of the conservation equations. The predicted height at time \\(t = t+\\Delta t\\) is given by the conservation of volume equation\n\\[\n\\Delta x\\Delta y \\frac{H^{n+1}-H^{n}}{dt}=F_F^{n+1/2}\\Delta y+F_B^{n+1/2}\\Delta y+F_R^{n+1/2}\\Delta x+F_L^{n+1/2}\\Delta x+E\\sqrt{U^{(n+1/2)^2}+V^{(n+1/2)^2}}\n\\tag{9.26}\\]\nIf the entrainment term is large it is still possible for \\(H^{n+1}\\) to be greater than the depth of the water column. This is easily dealt with by modifying the entrainment coefficient, \\(E\\), where the underflow height is greater than the water depth to ensure \\(H^{n+1}\\) is equal to the depth.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Underflow Model</span>"
    ]
  },
  {
    "objectID": "sci-destrat.html",
    "href": "sci-destrat.html",
    "title": "10  Artificial Destratification",
    "section": "",
    "text": "10.1 Introduction\nELCOM provides algorithms for two types of destratification devices: Bubble plumes and jets. Both devices act vertically on a column of water and work by calculating the entrainment of water from each cell into the jet or plume.\nWater insertion and entrainment is carried out by creating a temporary column of water with \\(nz + nn\\) layers. The layers consist of the original \\(nz\\) layers each slightly smaller than its usual \\(dz\\) due to entrainment into the plume and 1 inserted layer for a jet or one inserted layer for each time the bubble plume detrains. The \\(dz\\) of the inserted layer is given by the insertion volume divided by the column area. Once the plume calculations have been carried out the standard z layer configuration is enforced onto the temporary column. This leads to some numerical diffusion (Figure 10.1).",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Artificial Destratification</span>"
    ]
  },
  {
    "objectID": "sci-destrat.html#sec-destrat-intro",
    "href": "sci-destrat.html#sec-destrat-intro",
    "title": "10  Artificial Destratification",
    "section": "",
    "text": "Figure 10.1: Schematic of bubble plume or jet entrainment and insertion.",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Artificial Destratification</span>"
    ]
  },
  {
    "objectID": "sci-destrat.html#bubble-plumes",
    "href": "sci-destrat.html#bubble-plumes",
    "title": "10  Artificial Destratification",
    "section": "10.2 Bubble Plumes",
    "text": "10.2 Bubble Plumes\nThe bubble plume destratification in ELCOM is based on the routine in DYRESM. The model uses the simple buoyant plume equations, and assumes the plumes are circular and multiple plumes in any grid cell are non-interacting. Air is pumped to depth, and released into the water column via a diffuser. The bubbles rise, entraining ambient water. When the upwards buoyancy flux due to the air bubbles is equal to the downwards force (due to gravity) of the entrained ambient water, the bubble plume sheds the entrained water. This water is immediately routed to its neutrally buoyant level, without entrainment.\nThe bubble plume then begins to entrain ambient water again, until it reaches the surface where any entrained water is shed, and again routed to its neutrally buoyant level.\n\n10.2.1 Initialisation\nThe bubbler is initialised by first computing the upwards buoyancy flux due to the air, as (Fischer et al. 1979, eqn 9.7)\n\\[\nB_{air}=gQ_{diff}\n\\tag{10.1}\\]\nNote that the air flow rate MUST be that at the level of the diffuser, not the free-air flow rate of the compressor. The correction can be made by assuming that air is an ideal gas and is adiabatically compressed according to (Wallace and Hobbs 1977, p89)\n\\[\nQ_{diff}=Q_{air}\\left(\\frac{P_{air}}{P_{diff}} \\right)^{0.71}\n\\tag{10.2}\\]\nwhere \\(Q_{air}\\) is the free air flow rate of the compressor, \\(P_{air}\\) is the air pressure (usually taken as 101.3 kPa), \\(P_{diff}\\) the pressure at the level of the diffuser due to both the atmosphere and the depth of water, and \\(Q_{diff}\\) the diffuser air flow rate.\nOnce the value of \\(Q_{diff}\\) is passed into the model, it is divided by the number of ports (or clusters) to determine the flow rate per port. All subsequent calculations are done on a per port basis, then multiplied by the total number of ports to get the total effect of the destratification system.\nThe flow rate of entrained water is computed as (Fischer et al. 1979, eqns 9.28, 9.30, 9.107)\n\\[\nQ_{P}=\\alpha\\frac{6\\pi}{5}b_{1}L_{R}B^{1/3}z^{5/3}\n\\tag{10.3}\\]\nwhere \\(B\\) is the buoyancy flux [m\\(^4\\)/s\\(^3\\)], \\(z\\) is the bottom layer thickness [m], \\(b_1\\) is a constant (\\(=4.7\\), Fischer et al. (1979) p329), \\(L_R\\) is the plume aspect ratio (plume radius to plume length, assumed to be a constant of 0.1), and \\(\\alpha\\) is an entrainment coefficient.\n\n\n10.2.2 Subsequent entrainment\nThe first step is to compute the flow rate of air, which will increase due to decreasing pressure leading to adiabatic expansion of the bubbles. The new flow rate (due to adiabatic expansion) in layer \\(k\\) can be calculated as\n\\[\nQ_{i}=Q_{i-1}\\left(\\frac{P_{i-1}}{P_i} \\right)^{0.71}\n\\tag{10.4}\\]\nwhere layer (\\(k-1\\)) refers to the layer below, and pressure \\(P\\) has units of Pascals.\nThe combined buoyancy flux of the air bubbles and entrained water is calculated as\n\\[\nB_{i}=gQ_{i}-g\\left(\\frac{\\rho_{i}-\\rho_P}{\\rho_{i}} \\right)Q_P\n\\tag{10.5}\\]\nwhere \\(\\rho_{i}\\) is the density of the current layer, and \\(Q_P\\) is the flow rate of the entrained volume. The second term is the reduction in buoyancy flux due to the entrained water the plume is dragging with it.\nThe flow rate of the entrained volume in layer \\(i\\) is calculated as\n\\[\nQ_{P}=\\alpha\\frac{6\\pi}{5}b_{1}L_{R}B^{1/3}\\left(z_i^{5/3}-z_{i-1}^{5/3}\\right)\n\\tag{10.6}\\]\n\n\n10.2.3 Detrainment\nWhen the combined buoyancy flux becomes negative, the entrained water detrains from the air plume. It is then routed to its neutrally buoyant level instantaneously.\nThe plume characteristics are then reset, and the air continues to rise and begins entraining water again.\nWater insertion and entrainment is carried out as described above (Section 10.1).",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Artificial Destratification</span>"
    ]
  },
  {
    "objectID": "sci-destrat.html#pumpsjets",
    "href": "sci-destrat.html#pumpsjets",
    "title": "10  Artificial Destratification",
    "section": "10.3 Pumps/Jets",
    "text": "10.3 Pumps/Jets\nThe jet model uses the simple jet equations, and assumes the plumes are circular and multiple plumes in any grid cell are non-interacting. Unlike bubble plumes pumps may act up or down the water column. As the jet moves away from the pump it entrains ambient water. When the momentum flux of the jet reaches zero the entrained water is immediately routed to its neutrally buoyant level, without entrainment.\n\n10.3.1 Initialisation\nThe jet is initialised by first computing the momentum flux exiting the pump. The vertical velocity at the pump is given by\n\\[\nw_0=\\frac{2J}{\\pi \\rho_0 R}\n\\tag{10.7}\\]\nwhere \\(J\\) is the thrust of the pump in Newtons and \\(R\\) is the radius of the pump. The initial radius of the jet, \\(b_0\\), is set to the radius of the pump. The initial volume flux is therefore\n\\[\nQ_{0}=\\pi b_0^2 w_0\n\\tag{10.8}\\]\nThe water for this volume flux is removed from cells above the pump if the pump is pumping down and below the pump if it is pumping up. The water is removed equally from all cells a distance equal to \\(R\\).\n\n\n10.3.2 Subsequent entrainment\nThe entrainment into the jet is calculated by explicitly solving the conservation of volume equation\n\\[\n\\frac{\\partial (\\pi b^2 w)}{\\partial z}=2\\pi b w\n\\tag{10.9}\\]\nThe conservation of momentum equation is then solved to calculate the vertical velocity\n\\[\n\\frac{\\partial \\left(\\frac{\\pi}{2} b^2 w^2\\right)}{\\partial z}=\\pi b g\\frac{\\rho_j-\\rho_{amb}}{\\rho_0}\n\\tag{10.10}\\]\nwhere \\(\\rho_j\\) is the density of the water in the jet and \\(\\rho_{amb}\\) is the density of the cell.\n\n\n10.3.3 Detrainment\nWhen the momentum flux becomes negative, the entrained water detrains from the jet. It is then routed to its neutrally buoyant level instantaneously. Water insertion and entrainment is carried out as described above (Section 10.1).",
    "crumbs": [
      "Science Description",
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Artificial Destratification</span>"
    ]
  },
  {
    "objectID": "02-pre.html",
    "href": "02-pre.html",
    "title": "11  Pre-Processor",
    "section": "",
    "text": "11.1 Introduction\nThe ELCOM pre-processor is used to convert the user’s three-dimensional data of lake bathymetry, boundary forcing sections, and grid structure into one-dimensional vectors used by ELCOM. Configuration for running the pre-processor comes from a run_pre.dat file. The run_pre.dat file is a text file that contains the names and locations of user-supplied input files and pre-processor output files. The pre-processor requires two or three user-supplied text files: bathymetry.dat, bc.dat and optionally levee.dat and update.dat.\nThe pre-processor outputs two Fortran unformatted (binary) files: sparsedata.unf and usedata.unf. These may be renamed, but the user must track which are sparsedata and which are usedata.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#introduction",
    "href": "02-pre.html#introduction",
    "title": "11  Pre-Processor",
    "section": "",
    "text": "bathymetry.dat describes the bathymetry of the lake and grid configuration.\nbc.dat defines sets of boundary cells.\nlevee.dat allows the specification of levee cells — solid walls between two adjacent ELCOM cells.\nupdate.dat allows the specification of update cells — to modify values of various scalars arbitrarily.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#sec-bathFile",
    "href": "02-pre.html#sec-bathFile",
    "title": "11  Pre-Processor",
    "section": "11.2 Setting up the bathymetry file (bathymetry.dat)",
    "text": "11.2 Setting up the bathymetry file (bathymetry.dat)\nELCOM uses Fortran 90 (with F95 extensions) to map 3D space into a single vector for fast operation. Only computational cells containing water are represented in the vector, minimizing memory usage. This enables parallelization/vectorization without platform-specific modifications. Future ELCOM versions may include dynamic pressure effects to handle nonlinear internal wave dynamics.\n\n11.2.1 Introduction\nThe bathymetry file allows the user to input the simulation domain geometry at the target resolution1.\nThe format is strict with respect to data amount and order. All items must be present. Comment lines can be added before bathymetry values, with each line containing at least two items. An item may be an integer, real number, or character string. Comments must begin with an exclamation point (!) and include at least two items. A common crash involves a Fortran error due to missing non-optional items or insufficient items per line.\nBelow are valid formats:\nkeyword data data keyword ! comment keyword keyword data(j=1 to y_columns)\nThe keywords are ELCOM-defined words that indicate the type of user-provided data presented: (1) before the keyword, (2) after the keyword, or (3) on succeeding lines of the file.\nAdditional comments may be provided after the keywords to help the user remember the keyword purpose (the code only reads the first two items on a line). Detailed information on the keywords and the format of the file are presented in the following sections.\n\n\n11.2.2 Physical and computational space coordinates\nIn the literature, bathymetry is generally presented as the vertical distance from some horizontal baseline (often a mean water height) and may be either positive downward or positive upward. The convention used in ELCOM is an \\(({x,y,z})\\) space that follows the right-hand rule and has \\(z\\) positive in the upward direction (Figure 11.1).\nThe user is free to choose any suitable \\(z=0\\) baseline for the bathymetry as long as positive \\(z\\) upward is maintained as the convention for measurement. The pre-processor will adjust the user-defined \\(z=0\\) baseline to an internal code baseline that is suitable for the ELCOM simulation.\nFor the most part, the user does not need to know or consider this internal baseline adjustment. However, some debugging or monitoring output is presented in terms of the code coordinate system rather than the user coordinate system, so care must be taken in interpreting debugging output that is intended for use by code developers.\nThe position of the physical space origin \\((x=0, y=0)\\) is set implicitly by the user through the layout of the bathymetry data in the file bathymetry.dat. This will be covered in more detail below. Physical space \\(x\\) and \\(y\\) values may not be negative (i.e., the \\(x,y\\) origin must be in a corner of the domain).\n\n\n\n\n\n\n\n\nFigure 11.1: Schematic of coordinate system\n\n\n\n\n\nELCOM performs its simulation on computational cells of a three-dimensional Cartesian mesh. The user needs to understand the layout of the mesh so that boundary condition cells can be properly identified. ELCOM allows non-uniform spacing in each of the horizontal dimensions (\\(x\\) and \\(y\\)) and allows non-uniform spacing in the vertical (\\(z\\)) direction. (Although non-uniform \\(x\\) and \\(y\\) grid spacings are now allowed, users must be aware that timestep limitations are set by the smallest grid size.)\nFigure 11.2 shows a plan view (\\(x\\)-\\(y\\) plane) of a lake with a discrete (uniform) Cartesian mesh overlay. The computational domain is divided into “cells” whose centers are represented in Figure 11.2 by solid dots. Dashed lines represent the faces between the cells. Each cell center has an \\((i,j,k)\\) coordinate that designates its location in discrete computational space. The \\(i,j,k\\) values are the integer indices of a three-dimensional array.\nThe right-hand rule is used, with \\((i,j,k)\\) being non-zero, positive integer values; \\(k = 1\\) is associated with the lowermost cell layer in the domain. The \\((i,j)\\) pairs of a horizontal plane represent a matrix, so that by conventional mathematical notation the \\((1,1)\\) position is always in the upper left corner. The \\(i\\) index is the row index and increases down the page. The \\(j\\) index is the column index and increases across the page. The \\((i,j)\\) indices for corner cells are shown in Figure 11.2.\nFor convenience and consistency, the origin \\((0,0)\\) of the \\(x,y\\) (physical space) coordinates is taken to be at the \\((1,1)\\) location in the computational space \\(i,j\\) indices.\n\n\n\n\n\n\n\n\nFigure 11.2: Plan view of Cartesian mesh\n\n\n\n\n\nUsing the upper left corner as the origin may initially be confusing to users familiar with mirror-image storage (used by many graphics programs) where the lower left corner is stored in position \\(i=1,j=1\\). The problem with mirror-image storage is that a simple printout of bathymetry data always appears as an upside-down mirror image of the real world when viewed with a text processor or spreadsheet.\nThe present convention gives the user a What You See Is What You Get view of the bathymetry simply by opening the file with a word processor or importing into a spreadsheet. This convention has been found to be intuitive for users who are not graphics experts. However, caution needs to be taken when converting raw bathymetry data from graphics programs that use a mirror-image standard. Likewise, the direction of the positive \\(u\\) (\\(x\\) direction) velocity is confusing, as it is positive down the page.\nFigure 11.3 shows the physical space outline of the lake as the border of the shaded area. The discrete outline of a lake is shown with a heavy solid line. In developing a bathymetry.dat file for an ELCOM simulation, the user is required to provide bathymetry values (i.e., vertical distance measured from the user’s \\(z=0\\) baseline) for each of the cells within the discrete boundary of the lake. The region outside the lake boundary is defined as the “land” region.\nIn Figure 11.3, the cell center dots have been replaced with numbers that represent the distance from the user’s \\(z=0\\) baseline to the bottom of the lake. In this case, all of the “land” regions have been given a value of 99. Note that the boundary of the bathymetry data set shown in Figure 11.3 has land values around the entire boundary.\nIn general, it is required that either a land cell or open boundary cell surrounds the bathymetry data. For the purposes of the bathymetry.dat file, the user must provide bathymetry values for all cells in a rectangular array, including those cells that only contain land. ELCOM will only reserve computational memory for:\n\nThe cells which may contain water, and\nThe first layer of land cells surrounding the water cells.\n\n\n\n\n\n\n\n\n\nFigure 11.3: Plan view of bathymetry data\n\n\n\n\n\nFigure 11.4 shows an elevation view (in the \\(x\\text{-}z\\) plane) of a lake with a Cartesian overlay. A continuous, physical-space lake bottom is shown as a dashed line, with the resulting discrete lake bottom shown as a solid line.\nELCOM computes the bathymetry on the face of each cell (the dashed lines) from user-supplied bathymetry data at the cell centers (on the solid dots). In this figure, the user \\(z=0\\) baseline is chosen as the top of the domain, so that all the bathymetry values should be negative. Note that the \\(k=1\\) index of \\(i,j,k\\) space corresponds with the lowermost layer, regardless of the user z=0 baseline position.\n\n\n\n\n\n\n\n\nFigure 11.4: Elevation view of bathymetry data\n\n\n\n\n\nAn up-to-date copy of bathymetry.dat is included in the examples. This file can be used as a template for creating your own bathymetry.dat file. The judicious use of extra comment lines and comments after the keywords leads to a file that is much more readable. The bathymetry.dat file can be renamed, but the corresponding name in the run_pre.dat must also be changed.\nThe remainder of this section will detail the use of each keyword in the bathymetry.dat file.\n\n\n11.2.3 File header\nkeyword = FILE\nThe first non-comment line of the bathymetry.dat file must begin with the keyword FILE. Thus, the first non-comment line must appear as shown:\n \n\n\n\nKeyword\nValue\n\n\n\n\nFILE\nbathymetry.dat\n\n\n\n\n11.2.3.1 Description lines\nkeywords = TITLE, ANALYST, ORGANIZATION, COMMENT\nSeveral keywords are provided to allow the user to put identifying information at the top of the bathymetry file. This information is printed to the standard output at the start of the run to provide identification of the debugging output data. The format for the header lines is 'string'; keyword, where the string must be a non-null character array enclosed in single quotation marks. If the string is left blank or not enclosed in quotes, the pre-processor will crash with a Fortran read error. The user must have only one COMMENT line. A typical set of header keywords is shown below.\n \n\n\n\nValue\nKeyword\n\n\n\n\n'Lake Nowhere'\nTITLE\n\n\n'J. Citizen'\nANALYST\n\n\n'A Company'\nORGANIZATION\n\n\n'test run number 1'\nCOMMENT\n\n\n\n\n\n\n11.2.4 Size of input bathymetry data\nkeywords = x_rows, y_columns, z_layers, n_max, n_maxBC\nIn order to correctly read the bathymetry data from file bathymetry.dat, the user must tell the pre-processor the size of grid to expect. The value for x_rows is the number of rows in a two dimensional plan view of the bathymetry. The y_columns is the number of columns in the two-dimensional plan view. The number of layers in the vertical direction is identified with the keyword z_layers. The keyword n_max is used to set an estimate of the number of grid cells in the domain that are required for simulation (i.e. interior points plus the land points in one layer surrounding the interior). For most simulations, n_max can be set to 0, and the code will start with an estimate of x_rows × y_columns × z_layers. However, in some cases, this may create a temporary data array larger than can be processed using the available memory and the pre-processor will crash. The crash may produce a machine error message stating “out of memory,” or a more enigmatic “segmentation fault”. If insufficient memory is available, the user can estimate the actual number of grid points required for the simulation and rerun the preprocessor. Further reduction of the amount of memory used can be achieved by using the keyword n_maxBC. n_maxBC sets the maximum number of cells in any one boundary condition set. If n_maxBC is not specified or is set to 0 then the calculated n_max value is used.\n\n\n\nValue\nKeyword\n\n\n\n\n102\nx_rows\n\n\n84\ny_columns\n\n\n22\nz_layers\n\n\n0\nn_max\n\n\n\n\n\n\n11.2.5 Land cells\nkeyword = land_value\nThe land region is designated by a unique bathymetry value (defined using the keyword land_value) that is greater than any value found within the lake. The user is free to choose the land_value as any convenient number that meets this criterion. Thus, if the user chooses a z=0 baseline at the very top of the domain, the land_value may be set to zero (and all the bathymetry values should be negative numbers). If the user chooses the bottom of the domain as the z=0 baseline, then the land_value may be any positive number that is greater than the largest number appearing within the lake boundary (it is usually convenient to use 9999). In this latter case, all the bathymetry values will be positive numbers. Note that any cell whose bathymetry is not equal to the land_value is considered a cell within the domain; thus typographical errors can produce spurious interior cells of the domain. The user is not required to have a z=0 baseline within the domain: it may be convenient to use an external reference such as sea level. This may result in the lowest point in the domain having a positive non-zero bathymetry value.\n\n\n\nValue\nKeyword\n\n\n\n\n9999\nland_value\n\n\n\n\n\n\n11.2.6 Open boundary cells\nkeyword = open_value\nOpen boundary cells are boundaries with tidal forcing from an adjacent body of water that is not in the simulation domain. The user-defined bathymetry value that indicates an open boundary cell is defined with the keyword open_value.\n\n\n\nValue\nKeyword\n\n\n\n\n8888\nopen_value\n\n\n\n\n\n\n11.2.7 North vector\nkeywords = north_x, north_y\nThe user may create a bathymetry data file with any orientation (i.e., there is no requirement that north be at the top of the page). Since wind forcing on the free surface requires a direction, the user must designate the north direction. The north vector is determined as shown in Figure 11.5. Note that the north vector is given in terms of a vector in physical (\\(x,y,z\\)) space, not the discrete (\\(i,j,k\\)) space. Because the origin is in the upper left corner, a standard “north up” data set has a north vector of (-1, 0).\n\n\n\nValue\nKeyword\n\n\n\n\n-1.0\nnorth_x\n\n\n0.5\nnorth_y\n\n\n\n\n\n\n\n\n\nFigure 11.5: Calculation of the north vector\n\n\n\n\n\n\n11.2.8 Geographic position\nkeywords = latitude, longitude, altitude\nThe user provides the geographic position of the simulation domain using the keywords latitude, longitude and altitude. Longitude and altitude have no effect on the simulation but longitude is used to geo-reference output data. The latitude is used to provide appropriate Coriolis forcing in the ELCOM simulation. North latitudes are entered as positive numbers while south latitudes are entered as negative numbers. Latitude and longitude refer to the top,left corner of the bathymetry file.\n\n\n\nValue\nKeyword\n\n\n\n\n-32.0\nlatitude\n\n\n9.46\nlongitude\n\n\n0.0\naltitude\n\n\n\n\n\n\n11.2.9 Horizontal grid spacing\nkeywords = x_grid, y_grid\nThe present version of ELCOM allows uniform or stretched grid spacing in the \\(x\\) and \\(y\\) direction. Separate grid spacings are implemented in each horizontal dimension so that \\(dx \\neq dy\\) is valid. However, the user should be careful in implementing a solution grid with different \\(dx\\) and \\(dy\\) grid spacings since this can affect the solution accuracy. For uniform grids the \\(x\\) and \\(y\\) grid spacings are designated with the keywords x_grid and y_grid. If a non-uniform (stretched) horizontal grid is used, a default value for x_grid and y_grid must still be defined.\n\n\n\nValue\nKeyword\n\n\n\n\n100.0\nx_grid\n\n\n100.0\ny_grid\n\n\n\n\n\n11.2.10 Non uniform horizontal grid spacing\nkeywords = dx, dy (optional)\nIn the horizontal direction, ELCOM version 2.0.0 allows the user to design a grid whose dimension varies in space (i.e. \\(dx = f[x]\\) and \\(dy = f[y]\\)). Note that the \\(dx\\) may not vary with \\(y\\) or \\(z\\) coordinates and \\(dy\\) may not vary with \\(x\\) or \\(z\\) coordinates. In the bathymetry.dat file, stretched horizontal grid spacings are designated by the keywords dx and dy. dx and dy are defined in the bathymetry.dat in the order of increasing coordinate (i.e. from \\(x=1\\) to \\(x = x\\_rows\\)).\nWhile the user is free to set the \\(dx\\) and \\(dy\\) values in an arbitrary manner, the accuracy and stability of the simulation method may be affected by the degree of non-uniformity of the grid. In general, the simulation method will perform best (i.e. with greatest accuracy) using a uniform grid. For non-uniform grids, the degradation of accuracy is a function of the rate at which the grid changes (see below for \\(dz\\)).\n\n\n\nValue\nKeyword\n\n\n\n\n100\ndx\n\n\n100\ndx\n\n\n120\ndx\n\n\n132\ndx\n\n\n145\ndx\n\n\n150\ndx\n\n\n165\ndx\n\n\n171\ndx\n\n\n188\ndx\n\n\n205\ndx\n\n\n205\ndx\n\n\n205\ndx\n\n\n205\ndx\n\n\n205\ndx\n\n\n\n\n\n\nValue\nKeyword\n\n\n\n\n100\ndy\n\n\n100\ndy\n\n\n120\ndy\n\n\n132\ndy\n\n\n145\ndy\n\n\n150\ndy\n\n\n165\ndy\n\n\n171\ndy\n\n\n188\ndy\n\n\n205\ndy\n\n\n205\ndy\n\n\n205\ndy\n\n\n205\ndy\n\n\n205\ndy\n\n\n\n\n\n\n11.2.11 Layer thickness\nkeyword = dz\nIn the vertical direction, ELCOM allows the user to design a structure of horizontal layers whose thickness varies with depth (i.e. \\(dz = f[z]\\)). Note that the layer thickness may not vary with \\(x\\) or \\(y\\) coordinates. In the bathymetry.dat file, the successive layer thicknesses (in descending order from the top of the domain) are designated by the keyword dz. While the user is free to set the \\(dz\\) values in an arbitrary manner, the accuracy and stability of the simulation method may be affected by the degree of non-uniformity of the layers. In general, the simulation method will perform best (i.e. with greatest accuracy) using a grid with uniform \\(dz\\). For non-uniform \\(dz\\), the degradation of accuracy is a function of the rate at which the \\(dz\\) changes. Thus, a grid that has a \\(dz\\) that varies slowly will perform very well, while a grid with abrupt changes in grid size will be less accurate. For example, Figure 11.6 shows two possible configurations which provide vertical resolution of 0.5 metres in the upper portion of a lake and 2.0 metre resolution in the lower portion. Both use the same number of grid cells, but the \\(dz\\) distribution on the left of Figure 11.6 will show better performance.\n\n\n\nValue\nKeyword\n\n\n\n\n0.5\ndz\n\n\n0.5\ndz\n\n\n0.5\ndz\n\n\n0.51\ndz\n\n\n0.54\ndz\n\n\n0.58\ndz\n\n\n0.65\ndz\n\n\n0.75\ndz\n\n\n0.90\ndz\n\n\n1.13\ndz\n\n\n1.41\ndz\n\n\n1.65\ndz\n\n\n1.88\ndz\n\n\n2.0\ndz\n\n\n\n\n\n\n\n\n\n\nFigure 11.6: Vertical grid spacings\n\n\n\n\n\n11.2.12 Bathymetry values\nkeywords = BATHYMETRY DATA\nThe bathymetry values must be presented in the file bathymetry.dat following a line with the two keywords BATHYMETRY DATA. Each line of bathymetry values must contain exactly y_columns of data and there must be exactly x_rows of data lines following BATHYMETRY DATA. Each value on the line may be separated from the next by one or more spaces or tabs.\nThus, for a domain with x_rows = 8 and y_columns = 13, and land_value = 99 (i.e., similar to Figure 11.2), the bathymetry values would be entered into the bathymetry.dat file as shown:\nBATHYMETRY DATA\n99  99  99   99   99   99   99   99   99   99   99   99   99\n99  99  -0.7 -0.5 99   99   99   99   99   99   99   99   99\n99  -0.4 -1.2 -1.3 -1.1 -1.4 -2.5 -2.7 -3.3 -0.7 99   99   99\n99  -1.1 -1.6 -2.2 -3.2 -3.8 -3.9 -4.1 -5.3 -5.7 -5.2 -2.4 99\n99  -0.5 -0.8 -1.2 -2.1 -2.2 -2.4 -3.2 -3.3 -4.1 -5.0 -1.8 99\n99  99  99   99   99   99   99   99   99   -1.7 -1.2 -0.7 99\n99  99  99   99   99   99   99   99   99   -0.7 -0.9 -0.3 99\n99  99  99   99   99   99   99   99   99   99   99   99   99\n\n\n11.2.13 Bottom drag values (optional)\nKeywords: BTM_CD DATA\nVersion 2.0.0 allows a variable bottom drag coefficient to be specified in the bathymetry.dat file. Each line of values must contain exactly y_columns of data and there must be exactly x_rows of data lines following BTM_CD DATA. Each value on the line may be separated from the next by one or more spaces.\nThus, for the domain with x_rows = 8 and y_columns = 13, the values would be entered into the bathymetry.dat file as shown:\nBTM_CD DATA\n8 13 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16 1e+16 0.002 0.002 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16 0.002 0.002 0.002 0.002 0.002 0.002 0.002 0.002 0.002 1e+16 1e+16 1e+16\n1e+16 0.003 0.003 0.003 0.003 0.003 0.003 0.003 0.003 0.003 0.003 0.003 1e+16\n1e+16 0.004 0.004 0.004 0.004 0.004 0.004 0.004 0.004 0.004 0.004 0.004 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 0.004 0.004 0.004 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 0.004 0.004 0.004 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n\n\n11.2.14 Bottom Slope Values (Optional)\nKeywords: SLOPE_X DATA, SLOPE_Y DATA\nTo enable the 2D underflow model, bottom slope values must be included in the bathymetry.dat file. These values should follow a line containing either of the keywords SLOPE_X DATA or SLOPE_Y DATA.\nEach line of slope values must contain exactly y_columns entries, and there must be exactly x_rows lines of data following the keyword. Values on a line can be separated by one or more spaces or tabs.\nFor instance, if the domain is defined with x_rows = 8 and y_columns = 13 (as shown earlier), the slope values would appear in the bathymetry.dat file as follows:\n\nExample SLOPE_X DATA Format\nSLOPE_X DATA\n8 13 1e+16\n\n1e+16  1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16  1e+16 -0.006 -0.008 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16 -0.007 -0.004 -0.008 -0.021 -0.024 -0.019 -0.020 -0.026 -0.05 1e+16 1e+16 1e+16\n1e+16 -0.000 0.002 0.000 -0.005 -0.004 0.000 -0.002 0.000 -0.017 -0.025 -0.009 1e+16\n1e+16  0.005 0.008 0.011 0.016 0.019 0.0195 0.020 0.026 0.02 0.02 0.008 1e+16\n1e+16  1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 0.017 0.020 0.007 1e+16\n1e+16  1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 0.008 0.006 0.003 1e+16\n1e+16  1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n\n\nExample SLOPE_Y DATA Format\nSLOPE_Y DATA\n8 13 1e+16\n\n1e+16  1e+16  1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16\n1e+16  1e+16 -0.002   0.003   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16\n1e+16 -0.008 -0.004   0.000  -0.000  -0.007  -0.006  -0.004   0.01    0.016   1e+16   1e+16   1e+16\n1e+16 -0.008 -0.005  -0.008  -0.008  -0.003  -0.001  -0.007  -0.008   0.000   0.016   0.026   1e+16\n1e+16  1e+16  1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   0.017   0.005   0.006   1e+16\n1e+16  1e+16  1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16  -0.004   0.002   0.004   1e+16\n1e+16  1e+16  1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16   1e+16",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#sec-bcFile",
    "href": "02-pre.html#sec-bcFile",
    "title": "11  Pre-Processor",
    "section": "11.3 Setting up the boundary cell set file (bc.dat)",
    "text": "11.3 Setting up the boundary cell set file (bc.dat)\nAn up-to-date copy of bc.dat is included in the examples.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#introduction-2",
    "href": "02-pre.html#introduction-2",
    "title": "11  Pre-Processor",
    "section": "11.4 Introduction",
    "text": "11.4 Introduction\nThe boundary cell set file designates logical grouping of grid cells over which boundary conditions are enforced in ELCOM. One set of points may have a river inflow, another set may have a dam offtake, another set may represent groundwater inflows, etc. Each set of boundary points is defined by a unique reference number (used also by ELCOM temporal boundary condition files), type (one of several keywords), title (user reference only), and a series of cell i, j, k coordinates. This file gives the user complete flexibility in the assignment of diverse and complex boundary conditions around a three-dimensional topography.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#boundary-cell-set-categories",
    "href": "02-pre.html#boundary-cell-set-categories",
    "title": "11  Pre-Processor",
    "section": "11.5 Boundary cell set categories",
    "text": "11.5 Boundary cell set categories\nThe keywords for the boundary cell sets fall into seven categories, defined as follows:\n\n\n\n\n\n\n\nKeyword\nDescription\n\n\n\n\nland\nCell boundary which is considered to be land, on which a Dirichlet no-slip condition is imposed on all components of the velocity, and a Neumann zero-gradient condition is imposed on transported scalars.\n\n\nslip\nCell boundary which is considered to be land, but on which the velocity components tangential to the boundary have a Neumann free-slip condition applied, while the normal component of the velocity is a Dirichlet no-flux condition (this may be thought of more precisely as normal Dirichlet, tangential Neumann, or NDTN). A Neumann zero-gradient condition is imposed on transported scalars.\n\n\nflow\nCell boundary through which an inflow or outflow will be imposed as a Dirichlet fixed velocity condition. This also enforces a Dirichlet condition on transported scalars.\n\n\nsection\nCell boundary which is grouped into a set for application of an environmental forcing or scalar forcing boundary condition, but does not change the underlying form of the velocity boundary condition (e.g., the free surface may be divided into sections over which different wind conditions may be enforced - the type velocity boundary condition is not changed, but its magnitude is adjusted on different sections).\n\n\nopen\nCell boundary which is open to inflows and outflows from another body of water where the velocity is not fixed a priori (i.e., not a Dirichlet boundary) but is a function of the baroclinic and barotropic forcing near the boundary.\n\n\nbubbler\nAn interior cell on which a bubble plume destratification will be simulated.\n\n\nflow_*_dynamic\nCell boundary through which flow is determined dynamically according to the head difference between two locations in the domain (implemented for horizontal culverts). The flow will be imposed as a Dirichlet fixed velocity condition and also enforces a Dirichlet condition on transported scalars.\n\n\n\nA boundary cell set consists of a collection of cell faces that are the boundaries between interior cell and land cells. The land boundary condition is the default for all faces of cells identified by the land_value in the bathymetry.dat file and for all boundary cell faces below the bathymetry data. As such, the user will rarely need to use a land boundary condition in the bc.dat file. For a lake without any inflows, outflows or special boundary conditions, the bc.dat file need not be present.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#boundary-cell-set-face-direction",
    "href": "02-pre.html#boundary-cell-set-face-direction",
    "title": "11  Pre-Processor",
    "section": "11.6 Boundary cell set face direction",
    "text": "11.6 Boundary cell set face direction\nThe cell faces of the boundaries are identified by the (i, j, k) coordinates of the interior cell and the direction from the cell center to the boundary. The conventions used are as follows:\n\n\n\n\n\n\n\nFace code\nDescription\n\n\n\n\nxp\nthe y-z cell face in the positive x direction from the cell center\n\n\nyp\nthe x-z cell face in the positive y direction from the cell center\n\n\nxm\nthe y-z cell face in the negative x direction from the cell center\n\n\nym\nthe x-z cell face in the negative y direction from the cell center\n\n\ntop\nthe x-y cell face above the cell\n\n\nall_sides\nall possible side boundary faces (i.e., all y-z and x-z faces)\n\n\nall\nall possible side boundary faces plus the bottom boundary",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#boundary-cell-set-keywords",
    "href": "02-pre.html#boundary-cell-set-keywords",
    "title": "11  Pre-Processor",
    "section": "11.7 Boundary cell set keywords",
    "text": "11.7 Boundary cell set keywords\nThe keywords used to identify boundary cell sets are a concatenation of the categories and the face direction. The valid keywords are listed below:\n\n\n\n\n\n\n\n\n\nland_xp\nflow_xp\nslip_xp\nsection_xp\n\n\n\n\nland_xm\nflow_xm\nslip_xm\nsection_xm\n\n\nland_yp\nflow_yp\nslip_yp\nsection_yp\n\n\nland_ym\nflow_ym\nslip_ym\nsection_ym\n\n\nland_bottom\nflow_bottom\nslip_bottom\nsection_bottom\n\n\nland_all_sides\nflow_all_sides\nslip_all_sides\nsection_all_sides\n\n\nland_all\nflow_all\nslip_all\nsection_all\n\n\n\n\n\nsection_top\n\n\n\n\n\n\n\n\n\n\n\n\n\nbubbler\nbubbler_zbot\nbubbler_kbot\n\n\n\n\n\nopen_cell\n\n\n\n\n\nflow_multi_sides\n\n\n\n\n\nflow_xp_dynamic\nflow_xm_dynamic\nflow_yp_dynamic\nflow_ym_dynamic\n\n\n\nNOTE: bubbler_zbot and bubbler_kbot allow the user to specify the height of a bubble plume diffuser as either some height in metres (zbot) or number of cells from the bottom.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#sec-bcdat",
    "href": "02-pre.html#sec-bcdat",
    "title": "11  Pre-Processor",
    "section": "11.8 Organization of the boundary cell set file (bc.dat)",
    "text": "11.8 Organization of the boundary cell set file (bc.dat)\nAt the top of the boundary cell set file (bc.dat), the user may put any number of comment lines. Each comment line must start with an exclamation point (!) and have at least 3 items on the line (i.e., two words or numbers separated from the exclamation point and each other by spaces or tabs). After the initial comments, the boundary cell set file consists of a series of definitions of boundary sets. Each set consists of a set identification line followed by one or more lines of cell definitions. Each line must have three items on it or the pre-processor will crash with a Fortran file read error. Blank lines are not allowed in the boundary cell set file.\nEach set identification line is of the form: integer  keyword  title\nThe first item, integer, is a reference number for the boundary cell set that is used in preparing temporal boundary condition data files for the ELCOM simulation run (see Section 12.8.2). Each boundary cell set must have a unique integer reference number. The keyword is one of the valid keywords listed in the boundary cell set keywords table above. The title is a user-designated name for the boundary condition set. The title may have more than one word, although only the first word will be used by the code.\nAfter the set identification line, there will be one or more lines of cell definitions. A cell definition consists of three sets of numbers in the general form: i_{start}:i_{end}  j_{start}:j_{end}  k_{start}:k_{end}. For all boundary condition types except bubbler_zbot and bubbler_kbot the i, j, and k are integer values of the cell positions in space for a rectangular box of cells on which the relevant boundary cell keyword will be applied. For bubbler_zbot the third column must be a single real which gives the height of the diffuser in metres above the lake bottom. For bubbler_kbot the third column must be a single integer which gives the number of cells the diffuser is above the lake bottom. An example of a simple boundary cell set definition might be\n  107  flow_xp  river_inflow\n   3:10  4:5  10:14\nThe preprocessor would designate as a single set, all positive x boundaries in the range \\(3 \\leq i \\leq 10\\) and \\(4 \\leq j \\leq 5\\) and \\(10 \\leq k \\leq 14\\). A boundary cell set may have multiple lines of cell definitions:\n  13  flow_bottom  groundwater_inflow\n    5:10   1:5    10:14\n    5:10   7:11   10:14\n    3:8   12:17   1:5\nNote that each number pair in a cell definition must be in increasing order.\nThere are two simpler cases for implementing boundary cell sets (1) where \\(i, j\\) or \\(k\\) is a single value rather than a range, (2) where all possible values in \\(i, j\\) or \\(k\\) are to be included. In the former case, only a single number needs to be provided (rather than a pair), in the latter case, only the colon (:) needs to be listed. For example, the cell set for an inflow boundary along a flat side where \\(j = 2\\) might be written as:\n  214  slip_all  freeslip_domain\n    :  :  :\nwhich enforces a free-slip boundary condition on all boundary faces (sides and bottom) of the domain.\nThere is no error cross-checking within the pre-processor for cell faces which have been defined as belonging to more than one boundary cell set. In some cases, multiple definitions may be desirable. For example, one might define a river inflow which covers the entire depth of the river for purposes of the velocity boundary condition; and then define a separate section at the bottom of the river that is used to place a tracer. The bc.dat file might then contain\n  2791  flow_ym     river_inflow\n    3:15    2    :\n  73    section_ym  tracer_inflow\n    3:15    2    1:5\nIn other cases, multiple set definitions for a particular face can produce unintended results. For example, if we define an inflow boundary and a global definition of free-slip boundaries on all the cells:\n2791    flow_ym river_inflow\n    3:15    2   :\n214 slip_all    freeslip_domain\n    :   :   :\nWe then find that the cells (3:15, 2, : ) get defined both with imposed velocity (Dirichlet) boundary conditions and free-slip (normal-Dirichlet, tangential-Neumann) boundary conditions. Obviously this is inconsistent and the flow simulation cannot enforce both boundary conditions. Checking for which combinations of multiple definitions are consistent and which are not is an error capturing routine that is not yet implemented. Thus, the above boundary cell sets would be processed and provided to ELCOM. Within ELCOM, only one of the two boundary conditions will actually be enforced, but one cannot tell a priori which boundary condition it will be without detailed examination of source code. Note that the order the items are defined may affect the operation of an inconsistent definition. Thus if the above inconsistent definition were reversed and written as:\n214 slip_all    freeslip_domain\n    :   :   :\n2791    flow_ym river_inflow\n    3:15    2   :\nThe results in ELCOM may be different than the previous implementation — they would be wrong in a different manner. As a general rule, the user should not provide multiple definitions of velocity boundary conditions on a single cell face. The land, flow and slip keywords all affect the type of velocity boundary condition; it is incumbent on the user to be sure that the cell faces defined with these types do not have multiple definitions.\nThe following table illustrates a bc.dat file with a few subtle uses of the boundary cell set definitions. A flow boundary has been declared on the x-minus faces of cells with \\(i=2\\). Thus, to get free-slip boundary conditions on all the other faces, we use the keyword slip_all for cells with \\(i&gt;2\\). Then to get free slip on the y-minus and y-plus faces at \\(i=2\\) requires two more definitions (These are not inconsistent with the flow_xm definition since they are on different faces of the same cell). This file also shows the use of the section_top to segregate the free surface into different sets onto which different wind data can be enforced.\n! - - - -\n! - bc.dat file\n! - comment lines need three items\n34  flow_xm   outflow_number_1\n    2       :       :\n75  section_top  wind_region_a\n    :       1:10    :\n118 section_top  wind_region_b\n    :       11:21   :\n25  slip_all_sides  free_slip_section\n    3:34    :       :\n26  slip_ym free_slip_near_inflow_1\n    2:      :       :\n27  slip_yp free_slip_near_inflow_2\n    2:      :       :",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#flow_multi_sides",
    "href": "02-pre.html#flow_multi_sides",
    "title": "11  Pre-Processor",
    "section": "11.9 flow_multi_sides",
    "text": "11.9 flow_multi_sides\nIn ELCOM version 2.1.1 a further bc set type was introduced (flow_multi_sides) which allows the user to specify one inflow which enters from multiple cells on multiple faces. This was primarily introduced to allow a meandering river channel to be specified as one boundary set and will be particularly useful when coupled with INFLOW_DEPTH boundary condition data. The format of flow_multi_sides in the boundary cell set file (bc.dat) is slightly different from other set types.\nEach flow_multi_sides set consists of a set identification line followed by one or more subsets of cell and face type definitions. Each line must have three items on it or the pre-processor will crash with a Fortran file read error. Blank lines are not allowed in the boundary cell set file.\nEach flow_multi_sides set identification line is the same as for all other set types, i.e.:\nreference number keyword title\nWhere keyword must be flow_multi_sides. After the set identification line, there will be one or more subset definitions. Each subset consists of a subset set identification line followed by one or more lines of cell definitions.\nEach subset identification line is of the form: reference number flow_multi_sides keyword. The subset reference number for each subset must be the same as the reference number from the set identification line. The keyword. must be one of flow_xp, flow_xm, flow_yp, or flow_y and defines the inflow face or the subset of cells.\nFollowing each subset identification line are one or more lines of cell definitions. These cell definitions are the same as for an ordinary set type—i.e., of the general form $i_{start}:i_{end} j_{start}:j_{end} k_{start}:k_{end}$.\nAn example of a flow_multi_sides boundary cell set definition might be:\n  111 flow_multi_sides    river_inflow\n  111 flow_multi_sides    flow_xm\n      2   3   10\n      3   3   9\n      4   3   8\n  111 flow_multi_sides    flow_ym\n      4   3   8\n      4   4   7\n      4   5   6\n  111 flow_multi_sides    flow_xm\n      4   5   6\n      5   5   5\n      6   5   4",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#flow_dynamic",
    "href": "02-pre.html#flow_dynamic",
    "title": "11  Pre-Processor",
    "section": "11.10 flow_dynamic",
    "text": "11.10 flow_dynamic\nDynamic boundary condition sets (flow*_dynamic) allow the user to specify the connection of two parts of the domain with a (horizontal) culvert. This functionality was recently introduced in ELCOM. A boundary condition set pair related to each of the ends of the culvert must be defined.\nThe definition of a dynamic boundary condition pair set comprises four lines. The first and third lines have the same structure as the boundary condition identification line: a set reference number, one of the keywords (flow_xm_dynamic, flow_xp_dynamic, flow_ym_dynamic, or flow_yp_dynamic), and a user identifier. Each of these lines refers to one end of the culvert.\nThe second and fourth lines follow the same structure as the cell definition lines of an ordinary set type. Each line refers to one end of the culvert. Only one i and one j value can be specified. Although multiple k values may be included, both ends must have the same k specification.\nAn example of a flow*_dynamic boundary cell set definition might be:\n500     flow_xp_dynamic pipe_east_end\n        2   3   10\n600     flow_ym_dynamic pipe_north_end\n        4   3   10",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#sec-leveeFile",
    "href": "02-pre.html#sec-leveeFile",
    "title": "11  Pre-Processor",
    "section": "11.11 Setting up the levee file (levee.dat) (Optional)",
    "text": "11.11 Setting up the levee file (levee.dat) (Optional)\n\n11.11.1 Introduction\nThe levee set file designates any levees in the domain. Levees are solid boundaries between two adjacent cells. Pre-ELCOM implements levees by adding additional ghost cells adjacent to the levee. These ghost cells are colocated with the wet cells.\nThe format of the levee set file is essentially the same as the bc.dat file. Each set of levee points is defined by a unique reference number, type (one of several keywords), title (user reference only), and a series of cell (i, j, k) coordinates.\n\n\n11.11.2 Levee set categories\nThe cell faces of the levees are identified by the (i, j, k) coordinates of the interior cell and the direction from the cell center to the levee. The four valid keywords for the levee sets are as follows:\n\n\n\n\n\n\n\nKeyword\nDescription\n\n\n\n\nlevee_xp\nLevee on the y-z cell face in the positive x direction from the cell center\n\n\nlevee_yp\nLevee on the x-z cell face in the positive y direction from the cell center\n\n\nlevee_xm\nLevee on the y-z cell face in the negative x direction from the cell center\n\n\nlevee_ym\nLevee on the x-z cell face in the negative y direction from the cell center\n\n\n\n\n\n11.11.3 Organization of the levee set file (levee.dat)\nAt the top of the levee.dat file, the user may include any number of comment lines. Each comment line must begin with an exclamation point ! and contain at least three items (i.e., two words or numbers separated from the ! and from each other by spaces).\nAfter the initial comments, the file contains a series of levee set definitions. Each set consists of a set identification line followed by one or more cell definition lines. Each line must have three items; otherwise, the pre-processor will fail with a Fortran file read error. Blank lines are not allowed.\nEach set identification line is of the form: integer keyword title.\n\ninteger: a reference number unique to each levee set\nkeyword: one of the valid keywords listed above\ntitle: a user-designated name for the levee set (only the first word is used by the code)\n\nEach cell definition consists of three fields in the form: i_start:i_end j_start:j_end : Here, i and j are integer values specifying a rectangular box of cells. The third field must be a colon (:), indicating that the levee acts on all z values.\nAn example of a simple levee set definition might be:\n107  levee_xp  levee_bank\n     3  4:15  :",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#sec-updateFile",
    "href": "02-pre.html#sec-updateFile",
    "title": "11  Pre-Processor",
    "section": "11.12 Setting up the update file (update.dat) (Optional)",
    "text": "11.12 Setting up the update file (update.dat) (Optional)\n\n11.12.1 Introduction\nThe update set file defines update cells in the domain. These cells allow scalar values to be modified arbitrarily at run-time using Update boundary condition files (see Section 12.8.4). The format of this file is essentially the same as the bc.dat file.\nEach set is defined by a unique reference number, type (keyword), title (user reference), and a series of (i, j, k) cell coordinates.\n\n\n11.12.2 Update set categories\nUpdate cells are identified by their (i, j, k) coordinates. The valid keywords for update sets are:\n\n\n\n\n\n\n\nKeyword\nDescription\n\n\n\n\nupdate\nScalar values are set to those in the Update boundary condition files\n\n\nupdate_add\nScalar values are increased by the values in the Update boundary files\n\n\nupdate_max\nScalar values are set to the maximum of current and file value\n\n\nupdate_scale\nScalar values are multiplied by the file value\n\n\n\n\n\n11.12.3 Organization of the update set file (update.dat)\nComment lines may appear at the top of the file. Each comment must begin with ! and include at least three items. No blank lines are allowed in the file.\nEach update set includes a set identification line followed by one or more cell definition lines. Each line must have exactly three items to avoid pre-processor errors.\nEach set identification line is of the form: integer keyword title.\n\ninteger: a unique reference number\nkeyword: one of the valid update keywords\ntitle: a user-designated name (only the first word is used by the code)\n\nEach cell definition is of the form: i_start:i_end j_start:j_end k_start:k_end Here, i, j, and k define a rectangular box of update cells.\nAn example of a simple update set definition might be:\n12  update  tracer_release\n  3  4:15  2:4",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#running-the-pre-processor-with-run_pre.dat",
    "href": "02-pre.html#running-the-pre-processor-with-run_pre.dat",
    "title": "11  Pre-Processor",
    "section": "11.13 Running the pre-processor with run_pre.dat",
    "text": "11.13 Running the pre-processor with run_pre.dat\nAn up-to-date copy of run_pre.dat is included in the examples.\nThe run_pre.dat file is a text file that contains the names and paths of the user-supplied input files and the pre-processor output files. The required input files are:\n\nbathymetry.dat: describes lake bathymetry and grid configuration\nbc.dat: defines boundary cell sets\n\nOptionally, it may also include:\n\nupdate.dat\nlevee.dat\n\nThe pre-processor outputs two unformatted Fortran binary files:\n\nsparsedata.unf\nusedata.unf\n\nThese files may be renamed by the user, but they must be tracked carefully to distinguish between sparsedata and usedata.\nOnce the run_pre.dat file is in place with correct file paths and names, the pre-processor is executed with:\npre_elcom.exe",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "02-pre.html#footnotes",
    "href": "02-pre.html#footnotes",
    "title": "11  Pre-Processor",
    "section": "",
    "text": "The pre-processor cannot interpolate between coarse/fine grids — this must be done manually beforehand.↩︎",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Pre-Processor</span>"
    ]
  },
  {
    "objectID": "03-elcom.html",
    "href": "03-elcom.html",
    "title": "12  ELCOM Operation",
    "section": "",
    "text": "12.1 Introduction\nRunning an ELCOM simulation requires the user to provide several types of data:\nELCOM obtains this data from the user through user-prepared input files and pre-processor prepared input files.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#introduction",
    "href": "03-elcom.html#introduction",
    "title": "12  ELCOM Operation",
    "section": "",
    "text": "Initial conditions\nTemporal boundary conditions\nConfiguration parameters\nOutput control",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#files-for-elcom",
    "href": "03-elcom.html#files-for-elcom",
    "title": "12  ELCOM Operation",
    "section": "12.2 Files for ELCOM",
    "text": "12.2 Files for ELCOM\nELCOM is a command-line executable that communicates with the user through files. Table 12.1 provides a summary of file types, whether their presence is required or optional, the purpose of the file, and responsibility for preparation of the file.\n\nFile names in courier bold font without brackets are fixed named files (i.e., the file must be present with exactly that name).\nFile names such as [data_name].unf use square brackets to indicate that ELCOM may substitute various names in the bracketed section (see following sections).\nFile names such as .db use angle brackets to indicate sections of file names that the user can customize at the command line.\n\n\n\n\n\nTable 12.1: Files for ELCOM.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFile.Name\nPresence\nUsage\nPreparation\nNumber\n\n\n\n\nrun_elcom.dat\nrequired\nconfiguration control\nuser\n1\n\n\n.db\noptional\noutput control\nuser\n1\n\n\n.dat\noptional\nboundary control\nuser\n10\n\n\n.dat\noptional\ninitial condition\nuser\n10\n\n\n.dat\noptional\nscalar updates\nuser\n10\n\n\n.dat\noptional\ndrifter properties\nuser\n10\n\n\n.dat\noptional\ndrifter initial conditions\nuser\n10\n\n\n.dat\noptional\ndrifter updates\nuser\n10\n\n\n.dat\noptional\njet/pump file\nuser\n100\n\n\n.dat\noptional\ndrafttube file\nuser\n100\n\n\n.dat\noptional\ntemporal filter constants\nuser\n10\n\n\n.unf\nrequired\ngeometry data\npre-processor\n1\n\n\n.unf\nrequired\ngeometry data\npre-processor\n1\n\n\n.unf\noutput\ndatablock output\nELCOM\nno limit\n\n\n[data_name].unf\noutput\n3D data type output\nELCOM\nno limit\n\n\n[time_].unf\noutput\nsimulation space output\nELCOM\nno limit\n\n\n.unf\noutput\nrestart file\nELCOM\n1\n\n\nelcom.exe\nrequired\nexecutable\nmake\n1",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#simulation-modules",
    "href": "03-elcom.html#simulation-modules",
    "title": "12  ELCOM Operation",
    "section": "12.3 Simulation modules",
    "text": "12.3 Simulation modules\nELCOM is organized into simulation modules that can be turned off/on depending on the type of simulation that is desired. A module is turned off/on by setting the value of control keywords. This is done within the run_elcom.dat file. These controls provide a simple method for modifying the simulation.\nFor example: a boundary condition file can be set up to include both meteorological data and inflow data. As a simple test, the user decides to turn off the inflow. One approach would be to return to the pre-processor, eliminate the inflow boundary cell set, re-run the pre-processor, then modify the temporal boundary condition file to remove the inflow data. As a simpler approach, the user need only set iflow = 0, and the inflow data and boundary cell sets will be ignored.\nThis section provides a brief overview of the modules within ELCOM and their corresponding keywords set within the run_elcom.dat file.\n\n12.3.1 Stratification\nDensity stratification in ELCOM can be through temperature, salinity, or both by using the controls itemperature and isalinity in combination with idensity = 1. If desired, temperature and salinity can be treated as passive tracers by setting idensity = 0. If temperature and/or salinity are turned on, they must be initialized throughout the simulation domain using the default_*** controls, initial condition files, or associated subroutines in elcom_user.f90.\n\n\n12.3.2 Tracers\nUp to 10 passive tracers may be transported in a simulation. They may be initialized in the domain using initial condition files or may flow into the domain through an inflow boundary using keywords TRACER_** in a temporal boundary condition file.\n\n\n12.3.3 Surface thermodynamics\nThis module controls the heat transfer across the free surface. Required inputs (in temporal boundary condition files) include: solar radiation, wind speed, air temperature, and relative humidity.\n\n\n12.3.4 Rain\nThe rain module controls rain input into the free surface. Rain data in m/day must be provided in a temporal boundary condition file.\n\n\n12.3.5 Wind\nWind affects ELCOM simulations in three ways:\n\nEvaporative cooling in the surface thermodynamics module\nWind stress on the free surface\nWind-induced momentum source in the wind-mixed layer\n\nUse WIND_SPEED and WIND_DIR (linked to boundary cell set 0 for uniform application) or define multiple sections via section_top in bc.dat. ELCOM interpolates wind speed and direction in time. Vector interpolation isn’t supported, so consistent time intervals are recommended. Alternatively, use WIND_U and WIND_V.\n\n\n12.3.6 Inflow/Outflow\nInflow/outflow boundaries must be defined in bc.dat. Temporal boundary conditions for flow rate must be provided. Inflow conditions must also include scalar values.\n\n\n12.3.7 Conservation of Background Potential Energy\nNumerical diffusion can destratify the domain, increasing background potential energy. A vertical sharpening filter can conserve energy but not mass. The filter applies to salinity (IFILTER = 2) or temperature (IFILTER = 3). Alternatively, use FILTER_&lt;SCALAR&gt; in run_elcom.dat with IFILTER = 1. Temporally varying filters are also supported.\n\n\n12.3.8 Bubble Plume Destratification\nTo simulate bubble destratification, define outlet locations in bc.dat. Temporal boundary conditions must specify airflow rates and the number of ports.\n\n\n12.3.9 Underflow\nTo simulate dense inflow using Dallimore et al. (2001)’s 2D model, define inflow boundaries and temporal conditions, including INFLOW_HEIGHT. Set IUNDERFLOW in run_elcom.dat. Note: Not compatible with CAEDYM.\n\n\n12.3.10 Water Age Modelling\nEnable using IRETENTION in run_elcom.dat. Water age starts at zero and increments by del_t each timestep. Transported as a scalar.\n\n\n12.3.11 Drifters / Particles\nSimulate Lagrangian or semi-Lagrangian particles using NDRIFTERS in run_elcom.dat. Define properties in drifter_properties_file and drifter_in_file. Updates via update_drifter_file.\n\n\n12.3.12 Jets/Pumps\nTo simulate jet/pump destratification, provide thrust, radius, and depth data in jet files. Controlled via IJET in run_elcom.dat.\n\n\n12.3.13 Drafttubes\nFor destratification impellors with draft tubes, specify thrust, radius, depth, and tube length in drafttube files. Controlled via ITUBE in run_elcom.dat.\n\n\n12.3.14 Non-hydrostatic code\nTo simulate non-hydrostatic pressure effects (as in Bothel et al.), note that finer horizontal resolution (~10m) is required and simulation runtime increases significantly.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#sec-initfiles",
    "href": "03-elcom.html#sec-initfiles",
    "title": "12  ELCOM Operation",
    "section": "12.4 Initialization",
    "text": "12.4 Initialization\n\n12.4.1 Uniform initial conditions\nFor simple initial conditions (e.g., distributing a scalar or setting a flat surface), use DEFAULT_**** keywords in run_elcom.dat. Default values can be overwritten by profile or horizontal files or initialization subroutines.\n\n\n12.4.2 Vertical Profile\nVertical scalar variation is defined using initial_profile_file (in the infiles directory). Format:\n\nFour header lines:\n\nNumber of datasets (excluding depth)\nNumber of depths (first column is DEPTH)\ni and j coordinates\nColumn keywords (first must be DEPTH, rest valid scalar keywords)\n\nData rows: Depth (in meters) and scalar values.\nDepths must start at zero and increase monotonically.\nLinear interpolation is used during simulation.\n\n\nComments (!) can appear at the top of the file but not within the data block. Comment rows in headers must match column count.\n\n! Example: ic.dat\n2   data sets\n4   number of depths\n15 20   i,j\nDEPTH   WTR_TEMP    SALINITY\n0.0     25.0        0.0\n5.1     23.1        15.1\n6.2     20.2        35.0\n10.4    18.3        35.2\n\n\n12.4.3 Multiple Vertical Profiles\nTo increase the flexibility of initialization, ELCOM Version 2 allows for multiple profile initial condition files. If more than one initial condition file is specified for any scalar, then ELCOM interpolates between files to initialize the domain. Each profile is first linearly interpolated onto the vertical layers, and then each point is horizontally interpolated using the inverse distance weighting method such that\n\\[\nS_{i,j,k} = \\sum_{n=1}^N \\frac{S_{n,k}r_{n}^\\alpha}{r_{n}^\\alpha}\n\\]\nwhere \\(\\alpha\\) is the distance weighting specified by the flag IC_DIST_WEIGHTING in run_elcom.dat (default = 2.0), \\(r\\) is the distance between the column and profile \\(n\\), and \\(N\\) is the number of profiles.\n\n\n12.4.4 Horizontal Variation\nA horizontal variation in the initial conditions for any valid transportable scalar can be defined using an input file (keyword = initial_horiz_file). The input file may have any name but must be located in the infiles directory.\nThese files require a format that consists of three header lines followed by a value for each (i,j) column of the domain. The file may have as many comment lines (preceded by !) at the top of the file as desired. Comment lines within the header data must have as many items as there are columns (i.e., if there are 3 columns, a valid comment line is !  - -). No comment lines are allowed within the columns of data. The columns must be completely dense with data (i.e., there may not be “missing” data such that a row has fewer items than the number of columns).\nThe first header line contains two numbers: the number of x rows and the number of y columns. These must match the number of rows and columns in the bathymetry file.\nThe second line gives a land value for land cells.\nThe third line in the header contains the keyword that describes the scalar to be initialized. This keyword should be a valid transportable scalar given in the Valid Scalars table in Section 12.13.\nThe remaining lines in the file contain the data. The matrix should be the same size as the bathymetry data in your bathymetry file.\n! Example:  ic.dat\n8 13    xrows   yrows\n1e+16   land    val\nSALINITY\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16 1e+16   9.0   9.5 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n1e+16   8.1   8.5   9.3   9.5  10.0  10.2  11.0  11.6  11.8 1e+16 1e+16 1e+16\n1e+16   8.0   8.5   9.2   9.5  10.0  10.3  10.6  11.3  11.6  11.8  12.0 1e+16\n1e+16   8.0   8.5   9.1   9.3   9.5   9.5   9.7   9.8  10.0  10.2  11.2 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16  10.0  10.0  10.5 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16   9.1   9.2   9.5 1e+16\n1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16\n\n\n12.4.5 User subroutines\nFor ELCOM users who are willing to modify and compile source code, the ability to set up complex initial conditions is available through the addition of code to subroutines in the elcom_user.f90 file. The subroutines in this file are only called if the appropriate user_init_*** control in the run_elcom.dat file is non-zero.\nThe stub routines supplied with ELCOM are designed to be executed with the user_init_*** controls set to 1. However, this can be modified by the user so that different initializations are performed for different values of user_init_***.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#configuration-controls",
    "href": "03-elcom.html#configuration-controls",
    "title": "12  ELCOM Operation",
    "section": "12.5 Configuration controls",
    "text": "12.5 Configuration controls\n\n12.5.1 Time step\nThe time step (keyword = del_t) is the number of seconds that the simulation advances in time for each simulation step.\n\n\n12.5.2 Number of steps\nThe total number of time steps to be computed in the present simulation run is set using the keyword iter_max in the run_elcom.dat file.\n\n\n12.5.3 Start date\nThe start date is entered in CWR Julian Day format, which specifies the year and day using a real number with 7 digits to the left of the decimal place as yyyyddd.ddd. The first 4 digits are the year and the subsequent 3 digits are the Julian Day (days since January 1st). Hours, minutes, and seconds are represented as fractions of a day (e.g., 1 AM on January 1st, 2000 is represented as 2000001.041667).\n\n\n12.5.4 CGM tolerance\nThe CGM_TOL is the residual at which iteration of the conjugate gradient method (used for the free-surface solution) is stopped.\n\n\n12.5.5 Turbulence\nFor stratified flow, the base closure scheme can be supplemented by unstable mixing (iclosure = 1) algorithms. The unstable mixing algorithm mixes momentum and transported scalars in vertical cells where an unstable gradient of potential density exists (i.e., Ri &lt; 0.0).\nFor stratified flows driven by surface wind, the wind-mixed-layer closure scheme with energy transport (iclosure = 6) is recommended. This approach computes the turbulent kinetic energy due to wind stirring, convective overturns, and wind shear, then uses this to compute vertical mixing.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#output-frequency",
    "href": "03-elcom.html#output-frequency",
    "title": "12  ELCOM Operation",
    "section": "12.6 Output frequency",
    "text": "12.6 Output frequency\nOutputs of data that are not controlled by the datablock file are set through the iter_out_*** and start_output_*** keywords. The former controls the time step interval for providing output, while the latter controls the first step on which output will be provided.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#sec-runelcom",
    "href": "03-elcom.html#sec-runelcom",
    "title": "12  ELCOM Operation",
    "section": "12.7 Configuration using file run_elcom.dat",
    "text": "12.7 Configuration using file run_elcom.dat\nAn up-to-date copy of run_elcom.dat is included in the examples.\nELCOM looks for the file run_elcom.dat in the local directory to set the configuration of the simulation run. The run_elcom.dat configuration file controls execution of optional modules and models within ELCOM, allowing the user to set the parameters that govern the physical and numerical simulation.\nThe format of the file is flexible: lines may occur in any order, and not all items must be present. Comment lines (preceded by !) may occur anywhere in the file. Blank lines are not allowed in the file (the code stops reading at a blank line). Each line (including comment lines) must have at least two items separated by a blank space.\nThe comment marker ! counts as an item, so a valid line is !  ! or ! -, while !! (no space between) is not valid.\nThe general format for the file is a series of lines, with each line listing a user setting followed by a keyword that defines the parameter. The individual keywords and settings are explained briefly below:\n\n12.7.1 File headers\n\nFILE: file name for this file (must be run_elcom.dat)\nANALYST: user name (must be inside single quotes ' ')\nORGANIZATION: user company name (must be inside single quotes ' ')\nCOMMENT: user comment (must be inside single quotes ' ')\nCASE_KEYWORD: allows user to add code to be executed for a particular simulation case. Must be a string without blank spaces enclosed in single quotes.\n\n\n\n12.7.2 Simulation module controls\n\niheat_input: controls surface thermodynamics\n\n0 = no surface thermodynamics\n1 = surface thermodynamics model (input solar radiation is measured; longwave model determined by input keywords)\n\niatmstability: controls atmospheric stability correction in thermodynamics\n\n0 = no correction\n1 = apply correction\n\nirain: controls rainfall input\n\n0 = no rain\n1 = rain enabled\n\niflow: controls inflow/outflow (Dirichlet boundaries); overrides boundary condition files\n\n0 = no inflow/outflow\n1 = inflow/outflow model 1\n\niunderflow: controls 2D underflow model; overrides boundary condition files\n\n0 = standard inflow modelling\n1 = use underflow model where INFLOW_HEIGHT is specified\n\nibubbler: controls bubble plume destratification\n\n0 = no bubble plume\n1 = enable destratification model\n\nitemperature: controls whether temperature is transported\n\n0 = no temperature\n1 = temperature as scalar\n\nisalinity: controls whether salinity is transported\n\n0 = no salinity\n1 = salinity as scalar\n\nidensity: controls inclusion of buoyancy (density) in simulation\n\n0 = no buoyancy\n1 = use UNESCO equation of state for buoyancy\n\nntracer: number of passive tracers\n\n0 = none\n1 to 10 = number of tracers initialized or supplied via inflow\n\nndrifters: number of drifters or particles\n\n0 = none\n\n=1 = number of drifters\n\n\nijet: include jets/pumps\n\n0 = no jets\n1 = simulate jets\n\nitube: include drafttube pump destratification\n\n0 = no drafttubes\n1 = simulate drafttubes\n\nICAEDYM: enable CAEDYM water quality module\n\n0 = off\n1 = on\n\nicoriolis: include Coriolis force from bathymetry.dat latitude\n\n0 = off\n1 = on\n\ninonhydrostatic: use non-hydrostatic approximations of Botelho et al.\n\n0 = hydrostatic\n1 = non-hydrostatic\n\n\n\n\n12.7.3 Initialization and update options\n\nirestart: use restart file for initial conditions\n\n0 = do not use\n1 = use file specified by restart_in_file\n\nuser_init_u_vel: user subroutine for x velocity\n\n0 = ignore\n1 = call user_u_init with USER_START_U = 1\n\nuser_init_v_vel: user subroutine for y velocity\n\n0 = ignore\n1 = call user_v_init with USER_START_V = 1\n\nuser_init_w_vel: user subroutine for z velocity\n\n0 = ignore\n1 = call user_w_init with USER_START_W = 1\n\nuser_init_temperature: user subroutine for temperature\n\n0 = ignore\n1 = call user_temperature_init with USER_START_TEMPERATURE = 1\n\nuser_init_salinity: user subroutine for salinity\n\n0 = ignore\n1 = call user_salinity_init with USER_START_SALINITY = 1\n\nuser_init_tracer: user subroutine for tracer\n\n0 = ignore\n1 = call user_tracer_init with USER_START_TRACER = 1\n\nuser_init_height: user subroutine for surface height\n\n0 = ignore\n1 = call user_height_init with USER_START_HEIGHT = 1\n\nuser_init_extinction: user subroutine for light extinction coefficient\n\n0 = ignore\n1 = call user_extinction_init with USER_START_EXTINCTION = 1\n\nlatitude: optional simulation latitude (overrides value in bathymetry.dat)\n\n\n\n12.7.4 Turbulence modeling\n\niclosure: controls the type of closure scheme used\n\n0 = constant eddy viscosity\n1 = closure model 1 (includes mixing of unstable stratification)\n6 = wind-mixed layer model with energy transport — RECOMMENDED\n\nDIFFUSIVITY&lt;SCALAR&gt;: horizontal diffusivity for a scalar in X and Y (same). &lt;SCALAR&gt; must be uppercase and valid.\nDIFFUSIVITY_X_&lt;SCALAR&gt;, DIFFUSIVITY_Y_&lt;SCALAR&gt;: horizontal diffusivities in X and Y directions separately.\nDEFAULT_DIFFUSIVITY: default horizontal diffusivity for scalars; overridden by scalar-specific settings.\n\n\n\n12.7.5 Meteorological Sensor Heights\n\nWIND_SPEED_HEIGHT: height (m) of wind speed measurements. Default is 10 m.\nSCALAR_HEIGHT: height (m) for air temperature and humidity data. Default is 10 m.\n\n\n\n12.7.6 Model Settings and Controls\n\nmean_albedo: mean albedo of water\ndrag_btm_cd: bottom drag coefficient\nmodel_grav_damp_x: damping for x-baroclinic term\nmodel_grav_damp_y: damping for y-baroclinic term\n\n\n\n12.7.7 Scalar Maximum and Minimum for Debugging\n\nmin_&lt;SCALAR&gt; and max_&lt;SCALAR&gt;: bounds for debugging. &lt;SCALAR&gt; must be uppercase.\nihardlimit:\n\n0 = no limits\n1 = apply scalar bounds\n\n\n\n\n12.7.8 Debugging controls\n\ndebug_check:\n\n0 = off\n1 = stop on fatal\n2 = high check, stop on fatal\n3 = high check, stop on warning\n\ndebug_print:\n\n0 = none\n1 = minimal\n2 = moderate\n10 = extensive\n\ndebug_point: sparse data index point for debug output\ndebug_baroclinic_x, debug_baroclinic_y:\n\n0 = off\n1 = on\n\n\n\n\n12.7.9 Output Frequency\n\niter_out_monitor: output interval for monitoring\niter_out_save: output interval for saved simulation\niter_out_restart: output interval for restart files\n\n\n\n12.7.10 Output Start Time\n\nstart_output_monitor: time step to start monitoring output\nstart_output_save: time step to start save files\nstart_output_restart: time step to start restart files\n\n\n\n12.7.11 Time Controls\n\nstart_date_CWR: start in Julian format yyyyddd.ddd\ndel_t: time step (seconds)\niter_max: max time steps\n\n\n\n12.7.12 Iterative Solver Controls\n\nCGM_TOL: tolerance for conjugate gradient method\nCGM_MIN: minimum iterations\nCGM_MAX: maximum iterations\n\n\n\n12.7.13 Scalar Filtering\n\nIFILTER:\n\n1 = off (default)\n2 = BPE filter for salinity\n3 = BPE filter for temperature\n\nfilter_bPE_threshold: max BPE change (e.g., 1e-9 for Lake Kinneret)\nfilter_mass_threshold: max mass change (e.g., 1e-7 for Lake Kinneret)\nFILTER&lt;SCALAR&gt;: constant filter value for scalar\nDEFAULT_FILTER: default filter value for all scalars\n\n\n\n12.7.14 Default Values\n\nDEFAULT_HEIGHT: default water height (m)\nDEFAULT_WIND_SPEED: default wind speed (m/s)\nDEFAULT_WIND_DIR: wind direction (degrees from North)\nDEFAULT_&lt;SCALAR&gt;: default scalar value\nDEFAULT_PAR_EXTINCTION, DEFAULT_NIR_EXTINCTION, DEFAULT_UVA_EXTINCTION, DEFAULT_UVB_EXTINCTION: extinction coefficients\nDEFAULT_BC: boundary condition preset (1-9)\n\n\n\n12.7.15 Input File Names\n\n3D_data_file, preprocessor_file: grid and map files\ninitial_profile_file, initial_horiz_file: initial condition files\nboundary_condition_file, profile_boundary_condition_file: boundary files\nupdate_file, filter_file: updates and filter files\ndrifter_properties_file, drifter_in_file, update_drifter_file: drifter config\njet_file, drafttube_file: destratification devices\ndatablock_file: output configuration\n\n\n\n12.7.16 File Directories\n\ninfile_dir: directory of input files\noutfile_unf_dir: binary output directory\noutfile_txt_dir: text output directory\n\n\n\n12.7.17 Output File Names\n\nrestart_save_file: base name for save files\nrestart_out_file: base name for restart output",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#input-files",
    "href": "03-elcom.html#input-files",
    "title": "12  ELCOM Operation",
    "section": "12.8 Input files",
    "text": "12.8 Input files\n\n12.8.1 sparsedata.unf and usedata.unf\nThe files sparsedata.unf and usedata.unf are required files for ELCOM. These are the Fortran unformatted (binary) files produced by the pre-processor. The user may rename these files, but must keep track of which file is the sparsedata file (3D_data_file) and which is the usedata file (preprocessor_file). ELCOM will look for the files specified in the run_elcom.dat file. If the incorrect files are used, the simulation will crash.\n\n\n12.8.2 Temporal boundary condition (1D) files\nThe one-dimensional temporal boundary condition files (boundary_condition_file) are created by the user to provide environmental forcing information that varies with time. These files must follow a specific format:\n\nFour header lines followed by data columns.\nFirst column = time in CWR format (yyyyddd.dd).\nEach row represents data for a specific time.\nComment lines (starting with !) may appear at the top.\nHeader comment lines must have the same number of items as data columns.\nNo comments allowed within the data block.\nAll columns must be fully populated (no missing values).\n\n\n12.8.2.1 Header line meanings:\n\nNumber of data columns (excluding the time column).\n0 indicating CWR time format (first data column should be TIME).\nBoundary cell set reference numbers (from bc.dat).\nKeywords describing the type of data in each column.\n\nInterpolation: ELCOM linearly interpolates between provided time values to match simulation time steps (del_t).\n\n\n12.8.2.2 Table: Temporal Boundary Condition Data-types\n\n\n\n\n\n\n\n\nKeyword\nUnits\nDescription\n\n\n\n\nHEIGHT\nm\nWater height for open boundary condition\n\n\nINFLOW\nm3/s\nInflow volume\n\n\nINFLOW_MAXDEPTH\nm\nMax depth for inflow\n\n\nINFLOW_MINDEPTH\nm\nMin depth for inflow\n\n\nINFLOW_HEIGHT\nm\nInflow height for underflow model\n\n\nOUTFLOW\nm3/s\nOutflow volume\n\n\nGATE_&lt;n&gt;_TOP\nm\nTop of an inflow/outflow gate\n\n\nGATE_&lt;n&gt;_BOTTOM\nm\nBottom of an inflow/outflow gate\n\n\nGATE_&lt;n&gt;_OPEN\n-\nStatus of gate (1=open, 0=closed)\n\n\nAIRFLOW\nm3/s\nAirflow rate for bubble destratification\n\n\nN_PORTS\n\nNumber of ports in destratification device\n\n\nRAIN\nm/day\nRainfall rate\n\n\nWIND_SPEED\nm/s\nWind speed\n\n\nWIND_DIR\ndeg\nWind direction (deg clockwise from north)\n\n\nSOLAR_RAD\nW/m2\nSolar radiation at water surface\n\n\nLW_RAD_IN\nW/m2\nIncoming longwave radiation\n\n\nLW_RAD_NET\nW/m2\nNet longwave radiation (positive incoming)\n\n\nATM_PRESS\nPascals\nAtmospheric pressure\n\n\nCLOUDS\n\nFractional cloud cover (0 to 1)\n\n\nREL_HUM\n\nRelative humidity (0 to 1)\n\n\nAIR_TEMP\ndeg C\nAir temperature\n\n\n&lt;SCALAR&gt;\n-\nValid transportable scalar\n\n\n\n\n\n12.8.2.3 Notes:\n\nINFLOW_MAXDEPTH and INFLOW_MINDEPTH: allow control of inflow depths, enabling inflow at the surface of a thalweg cell even as surface level varies.\nGATE_&lt;n&gt;_TOP, GATE_&lt;n&gt;_BOTTOM, GATE_&lt;n&gt;_OPEN: specify selective withdrawal gates. n is the gate number (e.g. GATE_1_TOP), with OPEN = 1 (open) or 0 (closed). Flow is distributed among open gates based on area.\n\nThese features allow for more realistic simulation of systems like reservoirs with variable surface height or dam withdrawal structures.\n\n\n\n12.8.3 Temporal profile boundary condition (2D) files\nThe two-dimensional temporal profile boundary condition files (profile_boundary_condition_file) are used to provide scalar boundary information that varies with both time and depth. These files consist of:\n\nFour header lines\nSections of data, each representing a profile at a specific time\n\n\n12.8.3.1 Header lines:\n\nNumber of data sets per section (including DEPTH, excluding the TIME row)\nMust contain 0 to indicate CWR time format; data section starts with TIME\nBoundary cell set reference numbers (including TIME and DEPTH) — each file may apply to only one boundary set\nKeywords for each column (TIME, DEPTH, and valid scalar keywords)\n\n\n\n12.8.3.2 Data section:\nEach section contains:\n\nOne header row: the profile time (yyyyddd.dd) and number of depths\nOne row for DEPTH values (depths in meters below the surface)\nSubsequent rows: one per scalar, with values at each depth\n\nAll sections must:\n\nContain the same number of data rows (one per scalar)\nMaintain the same order of keywords per section\n\n\n\n\n\n12.8.4 Update boundary condition files\nThe update boundary condition files (update_file) are used to update scalar values on boundaries during specified time intervals (e.g., tracer releases). Format is the same as 1D temporal boundary condition files, except:\n\nTwo TIME columns per row are provided\nScalar values are applied during timesteps between the first and second time column\n\nIf a timestep doesn’t fall within any of these intervals, no update is applied.\n\n\n\n12.8.5 Temporal filter constant files\nTemporal filter constant files (filter_file) provide time-varying filter constants for scalars. They follow the same format as the 1D temporal boundary condition files.\n\nThird header line still includes boundary cell set reference, but it is ignored\nAll keywords must be valid transportable scalars\n\n\n\n\n12.8.6 Drifter files\n\n12.8.6.1 Drifter Properties Files\nThe drifter properties file (drifter_properties_file) provides physical properties of semi-Lagrangian drifters. If only Lagrangian particles are simulated, this file can be blank.\nEach line contains four columns:\n\nValue\nTarget drifters (e.g., :, or n1:n2)\nTarget components (e.g., :, or n1:n2)\nProperty keyword\n\n\n\n12.8.6.2 Valid property keywords:\n\nmass: mass of the component (kg)\narea: cross-sectional area (m2)\nlength: vertical length (m)\ndrag_cd: drag coefficient\ndistance: vertical distance from probe base to component base (m)\n\n\n\n12.8.6.3 shape keyword values:\n\n1 = sphere\n2 = cylinder\n3 = rectangle\n\n\n\n12.8.6.4 type keyword values:\n\n1 = submerged — forced by modeled water velocities\n2 = subsurface — forced by surface wind shear velocity\n3 = surface — forced by wind\n\nTherefore an example file for drifters consisting of five components (antenna, surface buoy, subsurface buoy, pole connecting the drogue to the subsurface buoy and the drifter sails) may look something like:\n! - - - -\n! ! Example Drifter Properties File\n! ! NB each comment line should have 4 words\n! - - - -\n! Component 1 sail\n26.0   :    1    mass\n1.5    :    1    area\n1.0    :    1    length\n0.3    :    1    drag_cd\n0.0    :    1    distance\n3      :    1    shape\n1      :    1    type\n! Component 2 Pole\n3.0    :    2    mass\n0.001  :    2    area\n1.0    :    2    length\n0.3    :    2    drag_cd\n1.0    :    2    distance\n2      :    2    shape\n1      :    2    type\n! Component 3 sub-surface float\n0.2    :    3    mass\n0.2    :    3    area\n0.2    :    3    length\n0.3    :    3    drag_cd\n2.3    :    3    distance\n3      :    3    shape\n2      :    3    type\n! Component 4 surface float\n0.1    :    4    mass\n0.01   :    4    area\n0.1    :    4    length\n0.3    :    4    drag_cd\n2.5    :    4    distance\n3      :    4    shape\n3      :    4    type\n! Component 5 antennea\n1.0    :    5    mass\n0.01   :    5    area\n0.3    :    5    length\n0.3    :    5    drag_cd\n2.6    :    5    distance\n2      :    5    shape\n3      :    5    type\n\n\n\n12.8.7 Drifter Initial Files\nThe drifter initial files (drifter_in_file) are used to provide initial conditions and simulation properties for drifters and particles.\nEach line of the drifter_in_file should contain three columns: 1. A value 2. Target drifters (: for all, or n1:n2 for a range) 3. A keyword that specifies the property to set\n\n\n12.8.8 Valid keywords:\n\nstart_t: starting timestep for the drifter\nend_t: ending timestep for the drifter\nsolution_method: type of drifter\n\n1 = Drifter with constant elevation\n2 = Drifter with constant depth\n3 = Drifter with constant density\n4 = Lagrangian Particle with constant elevation\n5 = Lagrangian Particle with constant depth\n6 = Lagrangian Particle with constant density\n7 = 3D Lagrangian Particle\n\nbeach_method:\n\n1 = Remove drifter when it hits land\n2 = Drifter continues if it hits land &gt; Note: Drifters are always removed if they cross an open boundary.\n\ncfl_max: maximum timestep for drifter (sub-timestepped if CFL &gt; cfl_max)\ndrogue_density: density of drogue/particle (used for constant density solutions)\ncentre_of_mass: distance of centre of mass from bottom of drogue (used for constant density solutions)\ndepth: depth of bottom of drogue/particle (used for constant depth solutions)\nstart_i, start_j, start_k: starting position in i, j, k grid coordinates\n\nExample: start_i = 8.5, start_j = 8.5, start_k = 5.5 places the drifter in the center of cell (i = 8, j = 8, k = 5)\n\nstart_x, start_y, start_z: starting position in physical x, y, z coordinates\nstart_cell: starting cell number (in 1D sparse array)\n\n\nAn example file may look something like:\n! - - - -\n! ! Example Drifter Initial File\n! ! NB each comment line should have 3 words\n! - - - -\n8.5    :    start_i\n14.5   :    start_j\n6.7    :    start_k\n2      :    solution_method\n2      :    beach_method\n1.5    :    depth\n\n\n12.8.9 Drifter Update Files\nThe drifter update files (update_drifter_file) are used to update drifter positions or solution methods during a simulation. These files are primarily designed to incorporate real-time position updates from measurements.\nThe format is the same as standard update boundary condition files, except:\n\nThe third header line contains a drifter number instead of a boundary condition set number.\nThe update is applied to the specified drifter for all timesteps between the two time values on each row.\n\nIf the current timestep is not between the two specified time values of a row, no update is made.\n\n\n12.8.10 Valid keywords for updates:\n\nsolution_method: (see earlier for method options)\nbeach_method: (see earlier for options)\ncfl_max: maximum timestep (drifter is sub-timestepped if CFL &gt; cfl_max)\ndrogue_density: density of drogue/particle (for constant density mode)\ncentre_of_mass: vertical offset from bottom of drogue to its center of mass\ndepth: depth of drogue/particle (for constant depth solutions)\ni, j, k: updated grid coordinates for drifter position\nx, y, z: updated physical coordinates\ncell: updated cell index in 1D sparse array\n\n\nAn example file may look something like:\n! - - - -\n! ! Example Drifter Update File\n! ! NB each comment line  should have 3 words\n! - - - -\n2 data sets\n0 seconds between data\n0          0          1   1\nTIME       TIME       i   j\n2005001.50 2005001.60 6.7 7.2\n\n\n12.8.11 Jet Files\nThe jet files (jet_file) are used to define the properties of a jet or pump employed for artificial destratification.\nThese files must follow a specific format:\n\nThree header lines\nFour columns of data\nData corresponds to specific instants of time and applies to a particular jet\nComments (!) are allowed at the top of the file\nAll data rows must be fully populated — no missing values allowed\n\n\n12.8.11.1 Header line definitions:\n\nJet reference number (used for debugging purposes only)\ni and j location of the jet (two integers)\nColumn headers for the data that follows\n\n\nNote: The expected structure of the third header line and the data columns can include variables like time, thrust, radius, and depth or height depending on the configuration, although this was not specified completely in the original text.\n\n TIME THRUST RADIUS DEPTH\n TIME THRUST RADIUS HEIGHT\nThe four data columns are\n\n\n12.8.11.2 Data Column Descriptions (Jet Files)\n\nTIME: The date in CWR Julian Day format (yyyyddd.ddd)\nTHRUST: Force of the pump in Newtons\nRADIUS: Radius of the pump in metres\nDEPTH or HEIGHT: Either the depth of the pump from the surface level or the height from the bottom (in metres)\n\n! - - - -\n! Example Jet File\n! - - - -\n1 jet ID number\n6 12 i,j location of jet data\nTIME      THRUST RADIUS DEPTH\n2005001.0 3000   2.0    2.2\n2005011.0 3000   2.0    2.2\n\n\n\n12.8.12 Drafttube Files\nThe drafttube files (drafttube_file) are used to define the properties of a pump with a drafttube used for artificial destratification.\nThese files must follow this structure:\n\nThree header lines\nFive columns of data\nEach row provides values at specific time instances for a single device\nComment lines (starting with !) may appear at the top of the file\nAll data columns must be complete — no missing values in any row\n\n\n12.8.12.1 Header line definitions:\n\nA drafttube reference number (used for debugging only)\nTwo integers indicating the i and j location of the device\nA line containing the column headers for the data that follows\n\n\nNote: The exact headers for the data columns (e.g., TIME, THRUST, RADIUS, DEPTH, LENGTH) should follow this third line, depending on what is specified for each simulation setup.\n\n TIME FLOW RADIUS DEPTH LENGTH\nThe four data columns are\n\n\n12.8.12.2 Data Column Descriptions (Drafttube Files)\n\nTIME: The date in CWR Julian Day format (yyyyddd.ddd)\nFLOW: Flow rate through the pump in m3/s Note: This value should be negative (i.e., pumping downward through the tube).\nRADIUS: Radius of the pump and tube in metres\nDEPTH: Depth of the pump from the surface level (in metres)\nLENGTH: Length of the draft tube in metres\n\n! - - - -\n! Example drafttube File\n! - - - -\n1 drafttube ID number\n6 12 i,j location of jet data\nTIME      FLOW RADIUS DEPTH  LENGTH\n2005001.0 -5   2.0    2.2    5.0\n2005011.0 -5   2.0    2.2    5.0",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#definition-of-culvert-characteristics-dynamic-boundary-conditions",
    "href": "03-elcom.html#definition-of-culvert-characteristics-dynamic-boundary-conditions",
    "title": "12  ELCOM Operation",
    "section": "12.9 Definition of Culvert Characteristics – Dynamic Boundary Conditions",
    "text": "12.9 Definition of Culvert Characteristics – Dynamic Boundary Conditions\nWhen dynamic boundary conditions are defined in pre_elcom, the characteristics of the culvert connecting the pair of boundary conditions must be provided. These characteristics are supplied in a file specified in run_elcom.dat using the keyword dynamic_boundary_condition_file.\nThese files require:\n\nThree header lines\nOne line listing culvert characteristics to be defined\nOne or more data rows for each culvert\n\nHeader Format:\n\nTwo values – boundary condition reference numbers (as defined in pre_elcom)\nOne value – number of characteristics being specified (between 3 and 12)\nOne value – number of pipes in the set (only circular pipes supported)\nOne line – column headers for culvert characteristics\n\n\n12.9.1 Supported Culvert Keywords and Defaults\n\n\n\n\n\n\n\n\nKEYWORD\nDefault\nDescription\n\n\n\n\nPIPE_K\n0.098\nInlet control factor K – unsubmerged pipe\n\n\nPIPE_M\n2.000\nInlet control exponent M – unsubmerged pipe\n\n\nPIPE_C\n0.398\nInlet control factor C – submerged pipe\n\n\nPIPE_Y\n0.670\nInlet control term Y – submerged pipe\n\n\nEPS_ENTRY\n0.500\nHead loss at pipe inlet\n\n\nEPS_EXIT\n1.000\nHead loss at pipe outlet\n\n\nEPS_FLAP_IN\n0.000\nHead loss for flapped gate at first boundary\n\n\nEPS_FLAP_OUT\n0.000\nHead loss for flapped gate at second boundary\n\n\nPIPE_MAN\n0.015\nManning’s coefficient\n\n\nPIPE_PHI\nrequired\nPipe diameter\n\n\nPIPE_LEN\nrequired\nPipe length\n\n\nPIPE_HEIGHT\nrequired\nPipe bottom height (relative to domain reference level)\n\n\n\n\n\n12.9.2 Example File\n! Boundary Condition file for Culverts\n2 1 ! Pair of dynamic sets\n7   ! data sets\n10  ! number of pipes\nEPS_ENTRY  EPS_EXIT EPS_FLAP_IN  PIPE_PHI  PIPE_LEN  PIPE_MAN  PIPE_HEIGHT\n0.500      1.000      0.100      0.500     15.0       0.015       2.750\n\n\n12.9.3 Output definition file (Datablock.db)\nThe file datablock.db is a text file produced by the user, and contains the configuration data used to set up the users output. The name for this file is specified by the user.\nA datablock.db file is structured as a series of blocks of instructions. Each block requires an exact number of lines, with specific instructions on each line. Each line contains a single instruction followed by a comment. The comment must begin with a “!” character. In manually editing datablock.db files, it is important to keep in mind that while blocks of instructions may be added or removed, lines within a block can only be modified, but not removed. The following will discuss the structure of each block of instructions.\n\n12.9.3.1 Datablock Description\nThe first 4 lines of a datablock.db are the datablock description. In order, they are the block descriptor, the current datablock version number, the number of output groups, and the number of output sets. Output groups and sets are described below.\n\n\n12.9.3.2 Group Description\nFollowing the datablock description are the group description blocks. A group represents a group of data to be output. A data group is defined as an output filename, datatypes to be output (i.e. TEMPERATURE, SALINITY, etc…), the location within the simulation domain of the points at which data is to be output, and the time at which data is to be output. If several groups are desired, the group descriptions must follow each other without breaks between them.\nA group description block contains 11 lines, which are as follows:\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nBEGIN GROUP_DESCRIPTION — begin block statement\n\n\n2\nGroup reference number — an integer labelling the group, this can have any value\n\n\n3\nUser label — a name containing no blank spaces labelling the group\n\n\n4\nOutput filename — should include .unf suffix\n\n\n5\nSet reference number — an integer corresponding to a description of a set of points at which the data are to be output (sets will be described after groups)\n\n\n6\nNumber of datatypes in group — an integer indicating the desired number of datatypes to be output (i.e. TEMPERATURE, SALINITY, etc…)\n\n\n7\nShould read .TRUE., do not modify\n\n\n8\nOutput interval — an integer indicating the desired number of timesteps between outputs\n\n\n9\nOutput start time — an integer indicating which time step to begin outputting data\n\n\n10\nOutput end time — an integer indicating which time step to stop outputting data, 0 indicates entire run\n\n\n11\nShould read 0, do not modify\n\n\n\n\n\n12.9.3.3 Set Description\nA set is a set of points at which data are to be output. This can include a vertical column of points, a contiguous series of columns of points (curtain), a horizontal sheet of points, a collection of drifters, a collection of outflows, or any group of points in the three-dimensional domain. The valid set types are:\nPROFILE_1D\nCURTAIN_2D\nSHEET_2D\nDRIFTER\nOUTFLOW\nALL_3D\nGENERAL_3D\nProfiles and curtains require only the (x, y) locations of the base of each column to describe their location. Sheets can be referenced to a layer, a height above user datum, a height above bottom, or a height below the free-surface. Drifters are referenced by their drifter number from 1 to n_drifters. OUTFLOW outputs total flow and average scalar concentrations for flow out of the domain. Outflows are referred to by their bc reference number in bc.dat. ALL_3D simply outputs all points in the domain, and GENERAL_3D at points whose coordinates are individually specified.\nA set description block contains 16 lines, which are as follows:\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nBEGIN SET_DESCRIPTION — begin set statement\n\n\n2\nSet reference number — an integer labelling the set, this can have any value\n\n\n3\nUser label — a name containing no blank spaces labelling the set\n\n\n4\nType of set — one of the 7 valid set type names described above\n\n\n5\nNumber of cells in set — varies by set type: PROFILE: number of vertical columns; CURTAIN2D: number of columns making up the curtain; DRIFTER: number of drifters to output; OUTFLOW: number of outflow bc sets to output; SHEET_2D, ALL_3D: use 0\n\n\n6\nSheet type — only for SHEET_2D. Valid keywords: LAYER: referenced as layer number up from bottom; HEIGHT: height in meters above datum; BOTTOM: meters above bottom; SURFACE: meters below free-surface (evolves in time); FLAT: flat calculation layer\n\n\n7\nSheet calc — only for SHEET_2D. Valid options: NEAREST: nearest vertical grid point; MAX: maximum in column (only with FLAT); MIN: minimum in column (only with FLAT); AVG: average in column (only with FLAT); TOTAL: integrated column value (only with FLAT)\n\n\n8\nSheet value — LAYER: layer number; HEIGHT, BOTTOM, SURFACE: vertical distance in meters; FLAT: use 0\n\n\n9–16\nNot implemented, do not modify\n\n\n\n\n\n12.9.3.4 Group data types\nThis block begins with the desired number of data types, followed by a listing of the desired data types.\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nBEGIN GROUP_DATA_TYPES — Begin data type description\n\n\n2\nGroup reference number — An integer referencing the group number defined in the group description\n\n\n3–n\nData types — One data type descriptor per line. The possible data type descriptors are:\n\n\n\n&lt;TEMPERATURE&gt;\n&lt;SALINITY&gt;\nU_VELOCITY\nV_VELOCITY\nW_VELOCITY\nDENSITY\nEXTINCTION\nF_PRESSURE\nT_PRESSURE\nRI\nSHEAR\nMIX_ENERGY\nMIX_FRACTION\nMIX_REGIME\nSHEAR_ENERGY\nWIND_ENERGY\nBBL_ENERGY\nDISSIPATION\nRETENTION_T\nHEIGHT\nSLOPE_X\nSLOPE_Y\nWIND_SPEED\nWIND_DIR\nWIND_U\nWIND_V\nRAIN\nREL_HUM\nLW_RAD_IN\nLW_RAD_NET\nSOLAR_RAD\nATM_PRESS\nCLOUDS\nAIR_TEMP\nAUX_1\nAUX_2\nAUX_3\nAUX_4\nAUX_5\nEVAP_VOL_FLUX\nEVAP_MASS_FLUX\nEVAP_HEAT_FLUX\nSENS_HEAT_FLUX\nHUMIDITY_ALT\nHUMIDITY_SURF\nC_WIND\nC_HEAT\nUnderflow Variables:\n&lt;SCALAR&gt;_UND\nH_UND\nU_UND\nV_UND\nDENSITY_UND\nPRESSURE_UND\nE_COEFF_UND\nRI_UND\nE_VOLUME_UND\nE_VEL_XS_UND\nXP_F_UND_INDEX\nYP_F_UND_INDEX\nXN_F_UND_INDEX\nYN_F_UND_INDEX\nFor DRIFTER set types the value output is the value at the location of the bottom of the drifter.\nFor OUTFLOW set types the scalar value output is the average value for the total flow out. Note: Scalar is actually estimated using a first-order upwind scheme rather than the actual ULTIMATE-QUICKEST flux values.\n\n\n\n12.9.4 Group Time List\nThis block is required to initialize a time stamp for each group. It requires only two lines as follows:\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nBEGIN GROUP_TIME_LIST — Begin group time list\n\n\n2\nGroup reference number — An integer referencing the group number defined in the group description\n\n\n\n\n\n\n12.9.5 Set Cell Data\nThis block describes the spatial location of each datablock set. The locations are described as row, column, and/or layer number.\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nBEGIN SET_CELL_DATA — Begin set cell data\n\n\n2\nSet reference number — An integer referencing the set number defined in the set description\n\n\n3–n\nCell locations — This input varies for different set types as follows:\n\n\n\nSet type-specific input formats:\n\nPROFILE: Each profile requires a row of input. Each row requires 4 integers: x-row, y-column, 0, 0\nCURTAIN_2D: Each profile making up the curtain requires a row of input. Each row requires 4 integers: x-row, y-column, 0, 0\nSHEET_2D: No input required.\nDRIFTER: The drifters to be output. Each row requires 4 integers: drifter number, 0, 0, 0\nOUTFLOW: The bc sets to be output. Each row requires 4 integers: bcset number (from bc.dat), 0, 0, 0\nALL_3D: No input required.\nGENERAL_3D: Each point requires a row of input. Each row requires 3 integers: x-row, y-column, z-layer",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#sec-runexe",
    "href": "03-elcom.html#sec-runexe",
    "title": "12  ELCOM Operation",
    "section": "12.10 Running ELCOM",
    "text": "12.10 Running ELCOM\nELCOM is executed at the command line by typing elcom.exe within the directory where the run_elcom.dat and all the appropriate input data files are located. The monitoring/debugging output is sent to the standard output of the computer (the display terminal on most computers). Unless the simulation run is very short, it is recommended that the user redirect the output to a file with a execution redirection such as:\nelcom.exe &gt;& run_output.txt\n\n12.10.1 Post-Processing\n\n12.10.1.1 Conversion of datablock file to NETCDF\nThe datablock output files are named and configured through the datablock.db file. ELCOM produces Fortran unformatted (binary) files as specified by the datablock output configuration. In general, one datablock output file contains one or more data types (e.g. velocity, temperature) applied to a set of points at a specified time interval. These files can be reprocessed into NETCDF files using the command-line program dbconv.exe.\nThe program dbconv.exe is used for converting datablock unformatted binary files created by ELCOM to NETCDF files which can then be processed and viewed in a program such as Matlab. The dbconv.exe executable should be placed either in the working directory or as recommended in the /bin directory which is in the operating system’s search path. dbconv is run through a configuration file called run_dbconv.dat.\nThe run_dbconv.dat file contains 9 lines as follows:\n Comment line, up to 64 characters\n .unf file name and path\n sparsedata.unf file name and path\n .nc netcdf output file name and path\n Start time step, -1 for beginning\n End time step, -1 for end of file\n Overwriting of .nc file? -  clobber for overwriting, no_clobber for no overwriting\n Output mapping info to text file? -  map for writing, no_map for no overwriting\n Output diagnosics to monitor?  -  echo to output to monitor, no_echo to not output to monitor\nAn example run_dbconv.dat file would be:\n Example dbconv\n unfiles/curtain.unf\n infiles/sparsedata.unf\n ncfiles/curtain.nc\n -1\n -1\n clobber\n no_map\n no_echo\nOnce the run_dbconv.dat file is correctly configured, dbconv can be executed at the command line by typing:\ndbconv.exe run_dbconv.dat\nNotes:\n\nrun_dbconv.dat can have any file name, however the correct file name must be invoked at run time.\nThe run_dbconv.dat can only be configured for one file at a time.\n\nFor batch processing of several .unf files, it is recommended that a run_dbconv.dat file be created for each .unf to be converted and dbconv.exe be invoked for each run_dbconv.dat using a batch file.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#save-and-restart-output-files",
    "href": "03-elcom.html#save-and-restart-output-files",
    "title": "12  ELCOM Operation",
    "section": "12.11 Save and Restart output files",
    "text": "12.11 Save and Restart output files\nSave and Restart output files are Fortran unformatted (binary) files that contain run configuration information used to allow the user to restart ELCOM runs from a certain point. As described in the run_elcom.dat section, the kernel name and output frequency of save and restart files are defined in the run_elcom.dat file.\nThe save files are created starting at the time step specified by the value assigned to the run_elcom.dat keyword start_output_save, and subsequently at intervals defined by iter_out_save. The file name of the save files begins with the user-specified kernel, given by restart_save_file, appended by a time stamp, and appended by .unf.\nThe restart files are created at intervals defined by iter_out_restart, starting from the first time step. Subsequent restart files overwrite existing restart files. The file name of the restart files begins with the user-specified kernel, given by restart_out_file, appended by .unf. All start and restart files are written in the outfiles directory specified in the run_elcom.dat file.\nTo restart an ELCOM simulation using a save or restart file, the user must place a copy of the desired save or restart file in the infiles directory as specified in the run_elcom.dat file. In the run_elcom.dat file the name of the desired save or restart file must be assigned to the restart_infile keyword, and keyword irestart must be assigned the value 1.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#culvert-outputs---dynamic-boundary-conditions",
    "href": "03-elcom.html#culvert-outputs---dynamic-boundary-conditions",
    "title": "12  ELCOM Operation",
    "section": "12.12 Culvert Outputs - Dynamic Boundary Conditions",
    "text": "12.12 Culvert Outputs - Dynamic Boundary Conditions\nIn the current implementation, the flow rates and scalars calculated for each pipe in each of the pairs of dynamic boundary condition sets are output to an ASCII file located in the outfile_txt_dir directory.\nThe output files are named culvert_bcset_[$set$].out, where $set$ is each of the dynamic boundary condition sets present in the simulation.\nThe format of the files is as follows. 16 header lines explain the format of the file.\n % number of pipes in set = n (repeats n times)\n % set ref 1 (repeats n times)\n % set ref 2 (repeats n times)\n % pipe heights 1 to n\n % pipe diameters 1 to n\n % number of scalars (repeats n times)\n % names of scalars (repeats n times)\n % Then, for each time step\n % time step (repeats n times)\n % height set upstream\n % height set downstream (repeats n times)\n % total flow (repeats n times)\n % shift in set (repeats n times)\n % regime pipe 1 to n\n % flow pipe 1 to n\n % each scalars flowing through the culverts (repeats n times)\nThe percentage symbols at the beginning of each text line were used to make it easier to load the numeric data into a Matlab environment.\nThe next 7 lines give the set and pipe information.\n\nFirst line gives the number of pipes (n) in the dynamic boundary condition output set. The information repeats n times for easier loading into Matlab.\nSecond line gives the first defined set reference number in the dynamic boundary condition output set ref 1. The information repeats n times.\nThird line gives the second defined set reference number in the dynamic boundary condition output set ref 2. The information repeats n times.\nFourth line gives the bottom height for each of the pipes in the boundary condition set.\nFifth line gives the pipe diameter for each of the pipes in the dynamic boundary condition output set.\nSixth line gives the number of transportable scalars used in the simulation. The information repeats n times.\nSeventh line gives the names of transportable scalars used in the simulation. The information repeats n times and the line is preceded by a percentage symbol.\n\nThen, for each time step in the simulation, 7 + number of scalars lines are output.\n\nFirst line gives the time step of the output t. The information repeats n times.\n\n % flow pipe 1 to n\n % each scalar flowing through the culverts (repeats n times)\n\nSecond line gives the water height in the upstream cell of the dynamic boundary condition set at time step t. Repeats n times.\nThird line gives the water height in the downstream cell of the dynamic boundary condition set at time step t. Repeats n times.\nFourth line gives the sum of the flow in all the pipes in the dynamic boundary condition set at time step t. Repeats n times.\nFifth line tells if there was a shift in the direction of the flow. A value 1 means there was a shift (flow is from cells defined in reference set ref 2 to ref 1), and a value 0 means no shift. Repeats n times.\nSixth line gives the flow regime in each of the pipes (see the science manual for a description of flow regimes).\nSeventh line gives the flow in each of the pipes.\n\nThen, number of scalars lines are output for each of the transportable scalars defined in the header.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "03-elcom.html#sec-validScalars",
    "href": "03-elcom.html#sec-validScalars",
    "title": "12  ELCOM Operation",
    "section": "12.13 ELCOM Valid Scalars",
    "text": "12.13 ELCOM Valid Scalars\n\n\n\n\n\n\n\n\nScalar Keyword\nUnits\nDescription\n\n\n\n\nSALINITY\nPSU\nsalinity (practical salinity units which can be treated as parts per thousand within the numerical resolution of the model)\n\n\nWTR_TEMP\ndegC\nwater temperature for inflowing water\n\n\nTRACER_1 - TRACER_10\nconcentration\ntracer input\n\n\n&lt;CAEDYM&gt;\nconcentration\nCAEDYM Scalars",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>ELCOM Operation</span>"
    ]
  },
  {
    "objectID": "04-notation.html",
    "href": "04-notation.html",
    "title": "13  Notation",
    "section": "",
    "text": "Table ?tbl-var-notation shows the variable notation used throughout.",
    "crumbs": [
      "Using ELCOM",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Notation</span>"
    ]
  },
  {
    "objectID": "05-application.html",
    "href": "05-application.html",
    "title": "14  Applications",
    "section": "",
    "text": "14.1 Example one\nSome significant applications are demonstrated in this chapter.",
    "crumbs": [
      "Examples",
      "<span class='chapter-number'>14</span>  <span class='chapter-title'>Applications</span>"
    ]
  },
  {
    "objectID": "05-application.html#example-two",
    "href": "05-application.html#example-two",
    "title": "14  Applications",
    "section": "14.2 Example two",
    "text": "14.2 Example two",
    "crumbs": [
      "Examples",
      "<span class='chapter-number'>14</span>  <span class='chapter-title'>Applications</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Al-Khafaji, A. W., and J. R. Tooley. 1986. Numerical Methods in\nEngineering Practice. Holt, Reinhart; Winston, Inc.\n\n\nAmorocho, J., and J. J. Devries. 1980. “A New Evaluation of the\nWind Stress Coefficient over Water Surfaces.” J. Geophys.\nRes. 85: 433–42.\n\n\nBradford, S. F., and N. D. Katapodes. 1999. “Hydrodynamics of\nTurbid Underflows. I: Formulation and Numerical\nAnalysis.” J. Hydraul. Eng. 125 (10): 1006–15.\n\n\nCasulli, V., and F. C. Cattani. 1994. “Stability, Accuracy and\nEfficiency of a Semi-Implicit Method for Three-Dimensional Shallow Water\nFlow.” Comput. Math. Applic. 27: 99–112.\n\n\nCasulli, V., and R. T. Cheng. 1992. “Semi-Implicit Finite\nDifference Methods for Three-Dimensional Shallow Water Flow.”\nInt. J. Numer. Methods Fluids 15: 629–48.\n\n\nDallimore, C. J., J. Imberger, and T. Ishikawa. 2001. “Entrainment\nand Turbulence in Saline Underflow in Lake Ogawara.”\nJ. Hydraul. Eng. 127 (11): 937–48.\n\n\nEllison, T. H., and J. S. Turner. 1959. “Turbulent Entrainment in\nStratified Flows.” J. Fluid Mech. 6: 423–48.\n\n\nFischer, H. B., E. G. List, R. C. Y. Koh, J. Imberger, and N. H. Brooks.\n1979. Mixing in Inland and Coastal Waters. Academic Press.\n\n\nFozdar, F. M., G. J. Parker, and J. Imberger. 1985. “Matching\nTemperature and Conductivity Sensor Response Characteristics.”\nJ. Phys. Oceanogr. 15 (11): 1157–1569.\n\n\nGlorioso, P. D., and A. M. Davies. 1995. “The Influence of Eddy\nViscosity Formulation, Bottom Topography and Wind Wave Effects Upon the\nCirculation of a Shallow Bay.” J. Phys. Oceanogr. 25:\n1243–64.\n\n\nGross, E. S., V. Casulli, L. Bonaventura, and J. R. Koseff. 1998.\n“A Semi-Implicit Method for Vertical Transport in\nMulti-Dimensional Models.” Numer. Methods Fluids 28:\n157–86.\n\n\nHenderson-Sellers, B. 1986. “Calculating the Surface Energy\nBalance for Lake and Reservoir Modelling: A Review.” Reviews\nof Geophysics 24 (3): 625–49.\n\n\nHicks, B. B. 1975. “A Procedure for the Formulation of Bulk\nTransfer Coefficients over Water.” Boundary Layer\nMeteorology 8: 315–24.\n\n\nHodges, B. R., and R. L. Street. 1999. “On Simulation of Turbulent\nNonlinear Free-Surface Flows.” J. Comp. Phys. 151:\n425–57.\n\n\nImberger, J., and J. C. Patterson. 1981. “A Dynamic Reservoir\nSimulation Model – DYRESM 5.” In Transport\nModels for Inland and Coastal Waters, edited by H. Fischer, 310–61.\nAcademic Press.\n\n\n———. 1990. “Physical Limnology.” In Adv. Appl.\nMech., 27:303–475.\n\n\nIserles, A. 1996. “Biorthogonal Polynomials: Recent\nDevelopments.” Numerical Algorithms 11: 215–28.\n\n\nJacquet, J. 1983. “Simulation of the Thermal Regime of\nRivers.” In Mathematical Modeling of Water Quality: Streams,\nLakes and Reservoirs, edited by G. T. Orlob. Wiley-Interscience.\n\n\nKowalik, Z., and T. S. Murty. 1993. Numerical Modeling of Ocean\nDynamics. World Scientific.\n\n\nLeonard, B. P. 1991. “The ULTIMATE Conservative\nDifference Scheme Applied to Unsteady One-Dimensional Advection.”\nComp. Meth. In Applied Mech. And Eng. 88: 17–74.\n\n\nLin, B., and R. A. Falconer. 1997. “Tidal Flow and Transport\nModeling Using ULTIMATE QUICKEST Scheme.” J.\nHydraul. Eng. 123 (4): 303–14.\n\n\nMartin, P. J. 1985. “Simulation of the Mixed Layer at\nOWS November and Papa with Several Models.” J.\nGeophys. Res. 90: 903–16.\n\n\nRoe, P. L. 1981. “Approximate Riemann Solvers,\nParameter Vectors, and Difference Schemes.” J. Computat.\nPhys. 43: 357–72.\n\n\nSmolarkiewicz, P. K., and J. A. Pudykiewicz. 1992. “A Class of\nSemi-Lagrangian Approximations for Fluids.” J.\nAtmos. Sci. 49: 2082–96.\n\n\nSpigel, R. H., J. Imberger, and K. N. Rayner. 1986. “Modeling the\nDiurnal Mixed Layer.” Limnol. Oceanogr. 31: 533–56.\n\n\nStaniforth, A., and J. Cote. 1991. “Semi-Lagrangian\nIntegration Schemes for Atmospheric Models – a Review.”\nMonthly Weather Review 119 (9): 2206–23.\n\n\nSwinbank, W. C. 1963. “Longwave Radiation from Clear\nSkies.” Quarterly Journal of the Royal Meteorological\nSociety 89: 339–48.\n\n\nTennessee Valley Authority. 1972. “Heat and Mass Transfer Between\na Water Surface and the Atmosphere.” Report 14, Report No.\n0-6803. Water Resources Research Laboratory.\n\n\nWallace, J. M., and P. V. Hobbs. 1977. Atmospheric Science: An\nIntroductory Survey. Academic Press.\n\n\nWinters, K. B., P. N. Lombard, J. J. Riley, and E. D’Asaro. 1995.\n“Available Potential Energy and Mixing in Density-Stratified\nFluids.” J. Fluid Mech. 289: 115–28.",
    "crumbs": [
      "References"
    ]
  }
]