<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This is a draft of the ELCOM manual.">

<title>8&nbsp; Vertical Mixing – ELCOM Manual</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-sci-underflow.html" rel="next">
<link href="./07-sci-thermo.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-sci-intro.html">Science Description</a></li><li class="breadcrumb-item"><a href="./08-sci-mixing.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vertical Mixing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">ELCOM Manual</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Notation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Science Description</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-sci-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sci-goveqns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Governing Hydrodynamic Equations and Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-sci-timestep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Timestep limitations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-sci-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Numerical Method</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-sci-thermo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Surface Thermodynamics and Mass Fluxes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-sci-mixing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vertical Mixing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-sci-underflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Underflow Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-sci-destrat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Artificial Destratification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Using ELCOM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-pre.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Domain Pre-processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-elcom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Configuring a Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-running.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Running a Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Output File Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-developer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Developer Information</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-application.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Applications</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-publications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Publications</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">8.1</span> Overview</a></li>
  <li><a href="#energy-terms-in-the-mixed-layer-model" id="toc-energy-terms-in-the-mixed-layer-model" class="nav-link" data-scroll-target="#energy-terms-in-the-mixed-layer-model"><span class="header-section-number">8.2</span> Energy Terms in the Mixed Layer Model</a></li>
  <li><a href="#a-mixing-timestep" id="toc-a-mixing-timestep" class="nav-link" data-scroll-target="#a-mixing-timestep"><span class="header-section-number">8.3</span> A Mixing Timestep</a>
  <ul class="collapse">
  <li><a href="#sec-wind-energy" id="toc-sec-wind-energy" class="nav-link" data-scroll-target="#sec-wind-energy"><span class="header-section-number">8.3.1</span> Wind Energy</a></li>
  <li><a href="#sec-bottom-energy" id="toc-sec-bottom-energy" class="nav-link" data-scroll-target="#sec-bottom-energy"><span class="header-section-number">8.3.2</span> Bottom Energy</a></li>
  <li><a href="#sec-cycle" id="toc-sec-cycle" class="nav-link" data-scroll-target="#sec-cycle"><span class="header-section-number">8.3.3</span> Begin Cycle from Surface to Bottom</a></li>
  <li><a href="#sec-shear-energy" id="toc-sec-shear-energy" class="nav-link" data-scroll-target="#sec-shear-energy"><span class="header-section-number">8.3.4</span> Shear Energy</a></li>
  <li><a href="#sec-potential-energy" id="toc-sec-potential-energy" class="nav-link" data-scroll-target="#sec-potential-energy"><span class="header-section-number">8.3.5</span> Potential Energy</a></li>
  <li><a href="#sec-total-tke" id="toc-sec-total-tke" class="nav-link" data-scroll-target="#sec-total-tke"><span class="header-section-number">8.3.6</span> Total Available TKE Energy</a></li>
  <li><a href="#sec-timescale-turb" id="toc-sec-timescale-turb" class="nav-link" data-scroll-target="#sec-timescale-turb"><span class="header-section-number">8.3.7</span> Timescale for Mixing due to Turbulence</a></li>
  <li><a href="#sec-timescale-conv" id="toc-sec-timescale-conv" class="nav-link" data-scroll-target="#sec-timescale-conv"><span class="header-section-number">8.3.8</span> Timescale for Mixing due to Convective Overturn</a></li>
  <li><a href="#sec-mixing-fraction" id="toc-sec-mixing-fraction" class="nav-link" data-scroll-target="#sec-mixing-fraction"><span class="header-section-number">8.3.9</span> Calculate Mixing Fraction</a></li>
  <li><a href="#sec-energy-budget" id="toc-sec-energy-budget" class="nav-link" data-scroll-target="#sec-energy-budget"><span class="header-section-number">8.3.10</span> Energy Budget</a></li>
  <li><a href="#sec-cell-mixing" id="toc-sec-cell-mixing" class="nav-link" data-scroll-target="#sec-cell-mixing"><span class="header-section-number">8.3.11</span> Mixing of Cell into Mixed Layer</a></li>
  <li><a href="#end-of-cycle" id="toc-end-of-cycle" class="nav-link" data-scroll-target="#end-of-cycle"><span class="header-section-number">8.3.12</span> End of Cycle</a></li>
  <li><a href="#sec-dissipation" id="toc-sec-dissipation" class="nav-link" data-scroll-target="#sec-dissipation"><span class="header-section-number">8.3.13</span> Dissipation of Energy</a></li>
  </ul></li>
  <li><a href="#ri-derivation" id="toc-ri-derivation" class="nav-link" data-scroll-target="#ri-derivation"><span class="header-section-number">8.4</span> Ri Derivation</a></li>
  <li><a href="#sec-filter" id="toc-sec-filter" class="nav-link" data-scroll-target="#sec-filter"><span class="header-section-number">8.5</span> Numerical Diffusion Filter</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-sci-intro.html">Science Description</a></li><li class="breadcrumb-item"><a href="./08-sci-mixing.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vertical Mixing</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-mixing" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vertical Mixing</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">8.1</span> Overview</h2>
<p>ELCOM models the vertical Reynolds stress terms (and thus the turbulent fluxes) in momentum and transport equations with a 3D mixed-layer approach derived from the mixing energy budgets developed for 1D lake modeling <span class="citation" data-cites="Imbe81 Spig86 Imbe90">(Imberger and Patterson 1981, 1990; Spigel, Imberger, and Rayner 1986)</span>. Whereas 1D mixed-layer models are typically Lagrangian, regridding the vertical domain to match the number of mixed regions in the water column, the present 3D method uses an Eulerian fixed-grid framework as Lagrangian 3D methods typically obtain highly skewed grid cells when horizontal gradients in mixing occur. The present model applies a separate 1D mixed-layer model to each water column to provide vertical turbulent transport, whereas 3D transport of TKE is used to provide the dynamic effect of 3D motions on the TKE available for vertical mixing.</p>
</section>
<section id="energy-terms-in-the-mixed-layer-model" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="energy-terms-in-the-mixed-layer-model"><span class="header-section-number">8.2</span> Energy Terms in the Mixed Layer Model</h2>
<p>To understand the present mixed-layer approach, it is useful to qualitatively define some of the energy fluxes. First, we can characterize four energy terms:</p>
<ol type="1">
<li>The TKE available for mixing, <span class="math inline">\(TKE_A\)</span></li>
<li>The TKE required for mixing, <span class="math inline">\(E_{req}\)</span></li>
<li>The TKE dissipated, <span class="math inline">\(E_{\epsilon}\)</span> and</li>
<li>The residual mixing energy, <span class="math inline">\(E_M\)</span>.</li>
</ol>
<p>Of these, only the last, which is effectively the sum of the others at the end of the mixing algorithm, is considered a transported variable. Second, it is useful to characterize two types of mixing events in a stratified fluid:</p>
<ol type="1">
<li>Convective mixing of unstable density gradients that decreases the potential energy of the fluid and releases TKE</li>
<li>Mixing of stable density gradients that dissipates TKE and increases potential energy.</li>
</ol>
<p>The former is one of the TKE sources for mixing (<span class="math inline">\(TKE_A\)</span>), whereas the latter is exactly the local energy required to mix (<span class="math inline">\(E_{req}\)</span>). These two density gradient terms are computed from the vertical buoyancy scale, with the magnitude of a negative value providing the convective contribution to <span class="math inline">\(TKE_A\)</span> and a positive value providing <span class="math inline">\(E_{req}\)</span>. The distinction between the positive and negative forms of the buoyancy scale is critical to the model, as an unstable density gradient will always create <span class="math inline">\(TKE_A\)</span>, whereas a stable gradient (<span class="math inline">\(E_{req} &gt; 0\)</span>) will consume <span class="math inline">\(TKE_A\)</span> only when <span class="math inline">\(TKE_A \ge E_{req}\)</span>. Finally, we need a definition for a ‘mixed layer’; this is taken to be a set of vertically contiguous grid cells that share the same density, scalar concentrations, and grid-scale velocity. According to this definition, the discrete version of a linear stratification with seven grid cells shown in <a href="#fig-unstable" class="quarto-xref">Figure&nbsp;<span>8.1</span></a>(a) is a system with seven mixed layers, whereas the system in <a href="#fig-unstable" class="quarto-xref">Figure&nbsp;<span>8.1</span></a>(c) has the same number of vertical grid cells but only four mixed layers. Note that in this mixed-layer model, the layers do not have a dynamical existence outside the mixing algorithm and do not carry forward from time step to time step. That is, when the mixing routine is called, the layers are computed from the present density structure and mixing energy without explicit reference to any prior layer structure.</p>
<div id="fig-unstable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-unstable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<embed src="images/unstableMixing.pdf" class="img-fluid">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-unstable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1: Development of a mixed layer due to surface cooling and unstable stratification. (a) Stable stratification at start of time step; (b) surface cooling creates unstable density profile; (c) unstable grid cells have been mixed.
</figcaption>
</figure>
</div>
<p>The present approach is considerably simpler than many 1D models <span class="citation" data-cites="Spig86">(e.g. Spigel, Imberger, and Rayner 1986)</span> in that differential equations coupling layer thickness, entrainment rates, and heat transfer through the surface are not used. The fundamental presumption of our modeling approach is that the vertical grid resolution for practical 3D lake models is too coarse to adequately compute the solution of differential equations for mixed-layer evolution or heat transfer with gradient boundary conditions. Indeed, the need to model with coarse vertical grid resolution was the impetus for abandoning the vertical eddy-diffusion differential equations generally used for mixing. The surface thermodynamics in ELCOM enter the system as discrete changes to the temperature structure in the upper grid cells rather than as boundary conditions on transport or mixing equations. At the beginning of a time step, nonpenetrative heat flux (e.g., long-wave radiation, convective heat transfer) is added to the uppermost grid cell while solar radiation is added to the water column using exponential decay over depth. The heat transfer changes the density stratification, either providing <span class="math inline">\(TKE_A\)</span> (unstable density gradients produced by net cooling) or increasing <span class="math inline">\(E_{req}\)</span> (stable stratification produced by net warming). Once the new density field is calculated, the mixing process is modeled on a layer-by-layer basis through each <span class="math inline">\((i, j)\)</span> water column by comparing the available mixing energy (<span class="math inline">\(TKE_A\)</span>) from convective overturns, shear production, wind stirring, and TKE storage (<span class="math inline">\(E_{M}\)</span>) to the potential energy increase (<span class="math inline">\(E_{req}\)</span>) required to mix a grid cell up into the mixed layer above itself. This mixing process is explained in the following section.</p>
</section>
<section id="a-mixing-timestep" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="a-mixing-timestep"><span class="header-section-number">8.3</span> A Mixing Timestep</h2>
<p>A mixing model timestep for each column of water can be broken down into the following steps:</p>
<ol type="1">
<li>Calculate wind energy input, <span class="math inline">\(E_{wind}\)</span></li>
<li>If the TBBL boundary condition is being used calculate bottom energy input, <span class="math inline">\(E_{drag}\)</span></li>
<li>For each column cycle from surface cell to bottom cell</li>
<li>Calculate generation of TKE by shear, <span class="math inline">\(E_{shear}\)</span></li>
<li>Calculate energy required for mixing, <span class="math inline">\(E_{req}\)</span></li>
<li>Calculate total energy available if two cells were totally mixed, <span class="math inline">\(TKE_{mixed}\)</span></li>
<li>Calculate time estimate for total mixing <span class="math inline">\(T_{TKE}\)</span></li>
<li>If unstable calculate time estimate based on convective overturn <span class="math inline">\(T_{conv}\)</span></li>
<li>Calculate mixing fraction <span class="math inline">\(\eta_{f}\)</span></li>
<li>If there is enough energy then mix cells</li>
<li>End of cycle from surface cell to bottom cell</li>
<li>Dissipate excess mixing energy</li>
</ol>
<section id="sec-wind-energy" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="sec-wind-energy"><span class="header-section-number">8.3.1</span> Wind Energy</h3>
<p>Wind generation of TKE is parameterised as</p>
<p><span id="eq-wind-tke"><span class="math display">\[
E_{wind} =  \frac{1}{2} C_n^{3} \, dt \, u_{*}^{3}
\tag{8.1}\]</span></span></p>
<p>where <span class="math inline">\(u_{*}\)</span> is the wind shear velocity given by</p>
<p><span id="eq-ustar"><span class="math display">\[
u_{*} = \sqrt{\frac{C_D^{wind}\rho_{air}}{\rho_0}}U_{wind}
\tag{8.2}\]</span></span></p>
<p>and the mixing coefficient <span class="math inline">\(C_n\)</span> is set to 1.33. The wind energy for each column is added to the available TKE of the surface cell.</p>
<p><span id="eq-tke-surf"><span class="math display">\[
TKE_{surf}=TKE_{surf}+E_{wind}
\tag{8.3}\]</span></span></p>
</section>
<section id="sec-bottom-energy" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="sec-bottom-energy"><span class="header-section-number">8.3.2</span> Bottom Energy</h3>
<p>If the DEFAULT_BC is set to TBBL then TKE is also generated due to drag on the bottom. This energy is parameterised as</p>
<p><span id="eq-bottom-drag"><span class="math display">\[
E_{drag} = C_{b}(|u_{bot}|+|v_{bot}|)^{3/2} \, dt
\tag{8.4}\]</span></span></p>
<p>the mixing coefficient <span class="math inline">\(C_b\)</span> is set to 2.2. The bottom energy for each column is added to the available TKE of the bottom cell.</p>
<p><span id="eq-tke-bot"><span class="math display">\[
TKE_{bot}=TKE_{bot}+E_{drag}
\tag{8.5}\]</span></span></p>
</section>
<section id="sec-cycle" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="sec-cycle"><span class="header-section-number">8.3.3</span> Begin Cycle from Surface to Bottom</h3>
<p>Once the external energy sources have been added to the surface and bottom cells the main mixing routine is called. This routine loops from the surface cell to the bottom cell and generates the mixing layers for the column.</p>
<p>The loop first sets the surface cell (<span class="math inline">\(k_{surf}\)</span>) to a mixed layer and attempts to mix the cell <span class="math inline">\(k_{surf}-1\)</span> into this mixed layer. If there is enough energy to mix the cells and <span class="math inline">\(\Delta t\)</span> is large enough for the cell to be fully mixed (<span class="math inline">\(\eta_f = 1\)</span>) then the cells are mixed, <span class="math inline">\(k_{surf}-1\)</span> is added to the mixed layer and then we attempt to mix <span class="math inline">\(k_{surf}-2\)</span> with the mixed layer. If there is not enough energy for mixing to occur or <span class="math inline">\(\eta_f &lt; 1\)</span> then the mixed layer is closed, (<span class="math inline">\(k_{surf} - 1\)</span>) is set to a mixed layer and energy budgets are computed for <span class="math inline">\(k_{surf}-2\)</span>. If there is enough energy for mixing to occur but the mixing fraction is <span class="math inline">\(&lt;1\)</span> then partial mixing occurs.</p>
</section>
<section id="sec-shear-energy" class="level3" data-number="8.3.4">
<h3 data-number="8.3.4" class="anchored" data-anchor-id="sec-shear-energy"><span class="header-section-number">8.3.4</span> Shear Energy</h3>
<p>Shear generation of TKE is parameterised as</p>
<p><span id="eq-shear"><span class="math display">\[
E_{shear}=\frac{1}{2}C_{S}S^{2}dz_l
\tag{8.6}\]</span></span></p>
<p>the mixing coefficient <span class="math inline">\(C_s\)</span> is set to 0.15 and <span class="math inline">\(S\)</span> is the shear defined as</p>
<p><span id="eq-shear-def"><span class="math display">\[
S^{2}=(U_{ml}-U_{l})^{2}+(V_{ml}-V_{l})^{2}
\tag{8.7}\]</span></span></p>
<p>subscripts <span class="math inline">\(ml\)</span> refer to values in the mixed layer and subscripts <span class="math inline">\(l\)</span> refer to the cell directly below the mixed layer, i.e.&nbsp;the cell that we are checking to see if it will become part of the mixed layer. Shear energy is stored in the cell that is being mixed into the mixed layer.</p>
</section>
<section id="sec-potential-energy" class="level3" data-number="8.3.5">
<h3 data-number="8.3.5" class="anchored" data-anchor-id="sec-potential-energy"><span class="header-section-number">8.3.5</span> Potential Energy</h3>
<p>The energy required to mix the current cell into the mixed layer is given by</p>
<p><span id="eq-ereq"><span class="math display">\[
E_{req}=-g^\prime \, dz_{l} \, dz_{ml}
\tag{8.8}\]</span></span></p>
<p>where the reduced gravity term is given by</p>
<p><span id="eq-gprime"><span class="math display">\[
g^\prime=\frac{1}{2}g(\rho_{ml}-\rho_{l})\frac{(dz_{ml} \, dz_{l})}{\rho_{ml}(dz_{ml}+dz_{l})\rho_{l}}
\tag{8.9}\]</span></span></p>
<p><span class="math inline">\(dz_{ml}\)</span> is the mixed layer depth given by the sum of all the <span class="math inline">\(dz\)</span> of cells in the mixed layer.</p>
</section>
<section id="sec-total-tke" class="level3" data-number="8.3.6">
<h3 data-number="8.3.6" class="anchored" data-anchor-id="sec-total-tke"><span class="header-section-number">8.3.6</span> Total Available TKE Energy</h3>
<p>To determine a timescale for the mixing we first determine the total amount of energy if the cell of interest is completely mixed into the mixing layer. If the density profile is unstable then energy generated from convective overturns is added. The total <span class="math inline">\(TKE\)</span> is then</p>
<p><span id="eq-tke-mixed"><span class="math display">\[
TKE_{mixed}=
\begin{cases}
TKE_{ml}+TKE_{l}+E_{shear} &amp; \text{if } E_{req}\ge 0 \\
TKE_{ml}+TKE_{l}+E_{shear}-C_{C}E_{req} &amp; \text{if } E_{req}&lt; 0
\end{cases}
\tag{8.10}\]</span></span></p>
<p>the mixing coefficient <span class="math inline">\(C_c\)</span> is set to 0.2. The <span class="math inline">\(TKE\)</span> of the mixed layer (<span class="math inline">\(TKE_{ml}\)</span>) and the cell (<span class="math inline">\(TKE_{l}\)</span>) include energy from wind stirring and bottom drag as detailed above.</p>
</section>
<section id="sec-timescale-turb" class="level3" data-number="8.3.7">
<h3 data-number="8.3.7" class="anchored" data-anchor-id="sec-timescale-turb"><span class="header-section-number">8.3.7</span> Timescale for Mixing due to Turbulence</h3>
<p>To try and limit the time step dependence on mixing we introduce a timescale for the mixing to occur. If this timescale is larger than the timestep used then partial mixing occurs. The time scale due to turbulent mixing is given by</p>
<p><span id="eq-t-turb"><span class="math display">\[
T_{turb}=C_{TT} \, dz_{l}\sqrt{\frac{C_{s}(dz_{ml}+dz_{l})}{2 \, TKE_{mixed}}}
\tag{8.11}\]</span></span></p>
<p>the coefficient <span class="math inline">\(C_{TT}\)</span> is set to 50.0.</p>
</section>
<section id="sec-timescale-conv" class="level3" data-number="8.3.8">
<h3 data-number="8.3.8" class="anchored" data-anchor-id="sec-timescale-conv"><span class="header-section-number">8.3.8</span> Timescale for Mixing due to Convective Overturn</h3>
<p>If the density profile is unstable then we introduce a timescale for overturning.</p>
<p><span id="eq-t-conv"><span class="math display">\[
T_{conv}=C_{TC} \, dz_{l}\sqrt{\frac{dz_{l}}{g^\prime}}
\tag{8.12}\]</span></span></p>
<p>If the time scale for overturning is shorter than the timescale for mixing due to turbulence then we use this timescale to calculate our mixing fraction.</p>
</section>
<section id="sec-mixing-fraction" class="level3" data-number="8.3.9">
<h3 data-number="8.3.9" class="anchored" data-anchor-id="sec-mixing-fraction"><span class="header-section-number">8.3.9</span> Calculate Mixing Fraction</h3>
<p>The mixing fraction is simply the timestep <span class="math inline">\(\Delta t\)</span> divided by the shorter of the two timescales. The mixing fraction is limited to 1.0.</p>
<p><span id="eq-eta-f"><span class="math display">\[
\eta_{f}=\min\left(\frac{\Delta t}{\min(T_{TKE},T_{conv})},1.0 \right)
\tag{8.13}\]</span></span></p>
</section>
<section id="sec-energy-budget" class="level3" data-number="8.3.10">
<h3 data-number="8.3.10" class="anchored" data-anchor-id="sec-energy-budget"><span class="header-section-number">8.3.10</span> Energy Budget</h3>
<p>Before any mixing takes place the mixing routine checks to see if there is sufficient <span class="math inline">\(TKE\)</span> available to overcome the potential energy. If <span class="math inline">\(TKE_{mixed} \ge \eta_f E_{req}\)</span> the mixing takes place using the calculated mixing fraction. If <span class="math inline">\(TKE_{mixed}&lt;E_{req}\)</span> no mixing occurs, the available <span class="math inline">\(TKE\)</span> is dissipated completely and the mixed layer is closed. For complete mixing any excess <span class="math inline">\(TKE\)</span> (i.e.&nbsp;<span class="math inline">\(TKE_{mixed}-E_{req}\)</span>) is stored in the mixed layer and is included in the energy budget for the next layer. For partial mixing excess <span class="math inline">\(TKE\)</span> is stored proportionally by volume in the mixed layer and the cell being mixed.</p>
</section>
<section id="sec-cell-mixing" class="level3" data-number="8.3.11">
<h3 data-number="8.3.11" class="anchored" data-anchor-id="sec-cell-mixing"><span class="header-section-number">8.3.11</span> Mixing of Cell into Mixed Layer</h3>
<p>The mixing of cells depends on whether the cells are fully or partially mixed. If <span class="math inline">\(\eta_{f} = 1\)</span> all scalar and velocity values within the mixed layer are equal. Scalar concentrations are mixed by volume such that</p>
<p><span id="eq-scalar-mix"><span class="math display">\[
C_{ml}^{\prime}=\frac{C_{ml} \, dz_{ml}+C_l \, dz_l}{dz_{ml}+dz_l}
\tag{8.14}\]</span></span></p>
<p>where <span class="math inline">\(C_{ml}\)</span> is the scalar concentration of the mixed layer and <span class="math inline">\(C_l\)</span> is the scalar concentration of the cell being mixed. The prime indicates the value after mixing.</p>
<p>Velocities are mixed by mass such that</p>
<p><span id="eq-mixByMass"><span class="math display">\[
U_{ml}^{\prime}=\frac{\rho_{ml}U_{ml} \, dz_{ml}+\rho_{l}U_l \, dz_l}{\rho_{ml} \, dz_{ml}+\rho_{l} \, dz_l}
\tag{8.15}\]</span></span></p>
<p>For partial mixing only the cell being mixed and the cell at the bottom of the mixed layer are modified.</p>
<p><span id="eq-partial-mix"><span class="math display">\[
C_k=
\begin{cases}
C_{ml} &amp; k=k_l+2:k_{ml-top} \\
(1-\eta_f )C_{ml}+\eta_f \frac{C_{ml} \, dz_{k}+C_l \, dz_l}{dz_{k}+dz_l} &amp; k=k_l+1 \\
(1-\eta_f )C_{l}+\eta_f\frac{C_{ml} \, dz_{k+1}+C_l \, dz_l}{dz_{k+1}+dz_l} &amp; k=k_l
\end{cases}
\tag{8.16}\]</span></span></p>
<p>where <span class="math inline">\(C_k\)</span> is the concentration of layer <span class="math inline">\(k\)</span> in the column, <span class="math inline">\(k_l\)</span> refers to the layer of the cell being mixed and <span class="math inline">\(k_{ml-top}\)</span> is the layer of the top of the mixed layer. An analogous expression to <a href="#eq-mixByMass" class="quarto-xref">Equation&nbsp;<span>8.15</span></a> is used for partial mixing of velocity.</p>
</section>
<section id="end-of-cycle" class="level3" data-number="8.3.12">
<h3 data-number="8.3.12" class="anchored" data-anchor-id="end-of-cycle"><span class="header-section-number">8.3.12</span> End of Cycle</h3>
<p>Once the bottom cell is reached the cycle is concluded.</p>
</section>
<section id="sec-dissipation" class="level3" data-number="8.3.13">
<h3 data-number="8.3.13" class="anchored" data-anchor-id="sec-dissipation"><span class="header-section-number">8.3.13</span> Dissipation of Energy</h3>
<p>After the mixing of cells has concluded excess energy is dissipated according to</p>
<p><span id="eq-dissipation"><span class="math display">\[
TKE=TKE-\frac{1}{2}C_{\epsilon} \Delta t \left (\frac{TKE}{dz} \right )^{3/2}
\tag{8.17}\]</span></span></p>
<p>where the dissipation coefficient <span class="math inline">\(C_{\epsilon}\)</span> is set to 1.15. Any <span class="math inline">\(TKE\)</span> left after dissipation is then transported by the scalar transport routine before becoming available for mixing in the following timestep.</p>
</section>
</section>
<section id="ri-derivation" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="ri-derivation"><span class="header-section-number">8.4</span> Ri Derivation</h2>
<p>We are attempting to mix a cell below the mixed layer (of thickness <span class="math inline">\(\Delta z_l\)</span>) into the mixed layer (of thickness <span class="math inline">\(\Delta z_{ml}\)</span>).</p>
<p>Mixing fraction <span class="math inline">\(F_m\)</span> is defined as the fraction of the lower cell that is to be mixed into the mixed layer.</p>
<p>The combined potential energy of the mixed layer and the cell to be mixed before mixing is given by</p>
<p><span id="eq-PEbefore"><span class="math display">\[
PE=g\rho_l \Delta z_l \frac{\Delta z_l}{2}+g\rho_{ml} \Delta z_{ml} \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\tag{8.18}\]</span></span></p>
<p>The combined potential energy of the mixed layer and the cell to be mixed after mixing is given by</p>
<p><span class="math display">\[
PE^*=g\rho_l^* \Delta z_l \frac{\Delta z_l}{2}+g\rho_{ml}^* \Delta z_{ml} \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\]</span></p>
<p>where the <span class="math inline">\(*\)</span> superscripts indicate values after mixing. If we note that</p>
<p><span class="math display">\[
\rho_{ml}^*= \frac{\Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\rho_{l}}{\Delta z_{ml}+F_m\Delta z_{l}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\rho_{l}^*= (1-F_m)\rho_{l}+F_m\rho_{ml}^*
\]</span></p>
<p><span class="math display">\[
\rho_{l}^*= (1-F_m)\rho_{l}+\frac{F_m\Delta z_{ml}\rho_{ml}+F_m^2\Delta z_{l}\rho_{l}}{\Delta z_{ml}+F_m\Delta z_{l}}
\]</span></p>
<p>Then</p>
<p><span class="math display">\[
PE^*=g\left[ (1-F_m)\rho_{l}+\frac{F_m\Delta z_{ml}\rho_{ml}+F_m^2\Delta z_{l}\rho_{l}}{\Delta z_{ml}+F_m\Delta z_{l}} \right] \Delta z_l \frac{\Delta z_{l}}{2}+g\left[  \frac{\Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\rho_{l}}{\Delta z_{ml}+F_m\Delta z_{l}}\right] \Delta z_{ml} \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\left[ (1-F_m)\rho_{l}(\Delta z_{ml}+F_m\Delta z_{l})+F_m\Delta z_{ml}\rho_{ml}+F_m^2\Delta z_{l}\rho_{l} \right] \Delta z_l \frac{\Delta z_{l}}{2}
\\
+\left[  \Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\rho_{l}\right] \Delta z_{ml} \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\end{array}
\right]
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\left[ (\rho_{l}-F_m\rho_{l})(\Delta z_{ml}+F_m\Delta z_{l})+F_m\Delta z_{ml}\rho_{ml}+F_m^2\Delta z_{l}\rho_{l} \right] \Delta z_l \frac{\Delta z_{l}}{2}
\\
+\left[  \Delta z_{ml}\Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\Delta z_{ml}\rho_{l}\right]  \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\end{array}
\right]
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\left[ \rho_{l}\Delta z_{ml}-F_m\rho_{l}\Delta z_{ml}+\rho_{l}F_m\Delta z_{l}-F_m^2\rho_{l}\Delta z_{l}+F_m\Delta z_{ml}\rho_{ml}+F_m^2\Delta z_{l}\rho_{l} \right] \Delta z_l \frac{\Delta z_{l}}{2}
\\
+\left[  \Delta z_{ml}\Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\Delta z_{ml}\rho_{l}\right]  \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\end{array}
\right]
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\left[ \rho_{l}\Delta z_{ml}-F_m\rho_{l}\Delta z_{ml}+\rho_{l}F_m\Delta z_{l}+F_m\Delta z_{ml}\rho_{ml} \right] \Delta z_l \frac{\Delta z_{l}}{2}
\\
+\left[  \Delta z_{ml}\Delta z_{ml}\rho_{ml}+F_m\Delta z_{l}\Delta z_{ml}\rho_{l}\right]  \left ( \Delta z_l+\frac{\Delta z_{ml}}{2} \right )
\end{array}
\right]
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\frac{1}{2}\rho_{l}\Delta z_{l}^2\Delta z_{ml}
-\frac{1}{2}F_m\rho_{l}\Delta z_{l}^2\Delta z_{ml}
+\frac{1}{2}F_m\rho_{l}\Delta z_{l}^3
+\frac{1}{2}F_m\rho_{ml}\Delta z_{l}^2\Delta z_{ml}
\\
+\rho_{ml}\Delta z_l\Delta z_{ml}^2
+\frac{1}{2}\rho_{ml}\Delta z_{ml}^3
+F_m\rho_{l}\Delta z_{l}^2\Delta z_{ml}
+\frac{1}{2}F_m\rho_{l}\Delta z_{l}\Delta z_{ml}^2
\end{array}
\right]
\]</span></p>
<p><span class="math display">\[
PE^*=
\frac{g}{\Delta z_{ml}+F_m\Delta z_{l}}\left[
\begin{array}{l}
\frac{1}{2}\rho_{l}\Delta z_{l}^2\Delta z_{ml}
+\frac{1}{2}F_m\rho_{l}\Delta z_{l}^2\Delta z_{ml}
+\frac{1}{2}F_m\rho_{l}\Delta z_{l}^3
+\frac{1}{2}F_m\rho_{ml}\Delta z_{l}^2\Delta z_{ml}
\\
+\rho_{ml}\Delta z_l\Delta z_{ml}^2
+\frac{1}{2}\rho_{ml}\Delta z_{ml}^3
+\frac{1}{2}F_m\rho_{l}\Delta z_{l}\Delta z_{ml}^2
\end{array}
\right]
\]</span></p>
</section>
<section id="sec-filter" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="sec-filter"><span class="header-section-number">8.5</span> Numerical Diffusion Filter</h2>
<p>This section describes a technique for maintaining vertical density stratification over seasonal timescales. The technique involves estimating the numerical diffusion of mass occurring in each time-step and applying a compensating correction to the density field. Since advection does not change background potential energy, <span class="math inline">\(E_b\)</span> <span class="citation" data-cites="Wint95">(Winters et al. 1995)</span>, it follows that changes in <span class="math inline">\(E_b\)</span> during advection must be entirely due to numerical diffusion (in the absence of inflows/outflows). As ELCOM employs an operator splitting solution of the scalar transport equation, <span class="math inline">\(E_b\)</span> can be calculated before and after advection to quantify numerical diffusion of mass. This method has two shortcomings: 1) The measure is global, thus it does not provide a spatial distribution of diffusion. 2) The current implementation does not allow inflows/outflows that affect <span class="math inline">\(E_b\)</span>. The first drawback is inherent in the methodology and can only be addressed in an approximate manner, while the second drawback could be exactly removed by quantifying the buoyancy flux of inflows/outflows. In this section we concentrate on the first problem by developing a method to approximately redistribute <span class="math inline">\(E_b\)</span> for domains with no inflows/outflows. The problems associated with inflows/outflows remain a subject for further research. The contribution of this section is a methodology for using <span class="math inline">\(E_b\)</span> to reconstruct a density field that minimizes numerical diffusion. Mathematically, we desire a correction technique that satisfies:</p>
<p><span id="eq-eb-criterion"><span class="math display">\[
\frac{\{E_b^+\} - E_b^-}{E_b^-} &lt; \epsilon_B
\tag{8.19}\]</span></span></p>
<p>at each time-step. <span class="math inline">\(E_b^-\)</span> and <span class="math inline">\(E_b^+\)</span> are the background potential energy before and after the transport calculation respectively. The curly braces above and hereinafter represent the application of a correction technique. The threshold <span class="math inline">\(\epsilon_B\)</span> is based on the capabilities of the method and represents the minimum expected reduction in numerical diffusion. In a numerical simulation of a lake, density stratification varies smoothly and monotonically with depth and, to first order, can be characterized as two weakly stratified regions (an epilimnion and a hypolimnion), separated by a strongly stratified metalimnion. The observed effect of numerical diffusion is thickening of the metalimnion. Thus, the cumulative effect is similar to vertical diffusion from the metalimnion. To first order, mitigating numerical diffusion is achieved through an anti-diffusion vertical mass flux, which is applied herein using a sharpening filter acting vertically on the density profile in each water column.</p>
<p>The sharpening filter was previously developed to enhance field instrument response <span class="citation" data-cites="Fozd85">(Fozdar, Parker, and Imberger 1985)</span>. It is a three point recursive filter based on the inverse Z-transform of a linear response to a Heaviside step function, and is represented as follows:</p>
<p><span id="eq-sharpening"><span class="math display">\[
\{S_k\} = \frac{1-a^\prime}{1-a}(S_k-S_{k-1})+a^\prime \{S_{k-1}\}
\tag{8.20}\]</span></span></p>
<p>where <span class="math inline">\(a= e^{-\Delta z / l}\)</span>, <span class="math inline">\(a^\prime= e^{-\Delta z / l^\prime}\)</span>, <span class="math inline">\(\Delta z\)</span> is the vertical grid spacing, <span class="math inline">\(l\)</span> and <span class="math inline">\(l^\prime\)</span> are sharpening and smoothing length scales respectively, <span class="math inline">\(k\)</span> is a grid cell index, <span class="math inline">\(S_k\)</span> is a series value before application of the filter, <span class="math inline">\(\{S_k\}\)</span> is a series value after application of the filter. To simulate the bi-directionality of diffusion in one dimension the filter is applied both upwards and downwards.</p>
<p>One problem with the original sharpening filter is gradient amplification at boundaries, which creates artificial minima and maxima. Where such extrema are unstable density gradients, they must be mixed in a hydrostatic model. Where such extrema are stable density gradients, they increase the TKE required for mixing. The cumulative effects are maximum and minimum values of density beyond the original values, and distortion of mixing dynamics. To correct this effect, an endpoint limiter and gradient preservation are applied after filtering. The gradient before filtering is calculated for both the top and bottom of each water column. After filtering, top and bottom gradients are restored to pre-filter values. After gradient correction any new extrema are restored to pre-filtering values. Applying this endpoint gradient preservation and extrema limiter adversely affects mass conservation and raises the minimum practical threshold, <span class="math inline">\(\epsilon_B\)</span>. Since changes per time-step are extremely small, a simple mass correction is applied to evenly remove the change in mass incurred by the filtering. The change in mass due to filtering is divided by the number of cells containing less than average mass. That change in mass per cell is then subtracted from cells containing less than average mass. By applying mass correction before the extrema limiting, no new extrema are created, and the mass redistribution has the effect of further sharpening the overall stratification.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07-sci-thermo.html" class="pagination-link" aria-label="Surface Thermodynamics and Mass Fluxes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Surface Thermodynamics and Mass Fluxes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-sci-underflow.html" class="pagination-link" aria-label="Underflow Model">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Underflow Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>